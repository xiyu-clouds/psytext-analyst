<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š</title>
    <style>
        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .subsection {
            margin-top: 15px;
            padding: 10px;
            background: #ffffff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        h2 {
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        h3 {
            color: #495057;
            margin-top: 20px;
        }
        ul, ol {
            padding-left: 20px;
            margin: 8px 0;
        }
        li {
            margin-bottom: 4px;
        }
        .field-label {
            font-weight: bold;
            color: #495057;
        }
        .empty-section {
            color: #6c757d;
            font-style: italic;
        }

        /* Share buttons */
        .share-options {
            margin: 30px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
        }
        .share-btn {
            margin: 5px 8px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .share-btn:hover {
            background: #0056b3;
        }
        .details-block {
            margin-top: 12px;
            border-left: 2px solid #e0e0e0;
            padding-left: 12px;
        }
        .details-block summary {
            cursor: pointer;
            color: #1a73e8;
            font-weight: 500;
        }
        .details-content {
            margin-top: 8px;
            padding: 8px 0;
            border-top: 1px dashed #ddd;
        }
        code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .suggestion-section {
          background-color: #f8f9fa;
          border-left: 4px solid #0d6efd;
          padding: 16px;
          margin: 24px 0;
        }
        .suggestion-content {
          white-space: pre-wrap;
          line-height: 1.6;
        }
        .suggestion-error {
          color: #dc3545;
          font-style: italic;
        }
        /* æ‰“å°æ—¶éšè—åˆ†äº«æ“ä½œæŒ‰é’® */
        @media print {
          #btn-export-md,
          #btn-generate-pdf,
          #btn-copy-text,
          .share-options > h3 {
            display: none !important;
          }
          #scroll-controls {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
          }
        }
        .watermark-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            pointer-events: none;        /* ç‚¹å‡»ç©¿é€ */
            user-select: none;           /* ç¦æ­¢é€‰ä¸­ */
            display: grid;
            grid-template-columns: repeat(5, 1fr);  /* 5åˆ— */
            grid-template-rows: repeat(8, 1fr);     /* 8è¡Œï¼Œé¿å…å¤ªå¯† */
            opacity: 0.12;               /* ä» 0.05 æé«˜åˆ° 0.12ï¼Œæ¸…æ™°ä½†ä¸åˆºçœ¼ */
            transform: rotate(-30deg);
            font-weight: bold;
            font-family: "Microsoft YaHei", sans-serif;
        }

        .watermark-grid span {
            padding: 30px;               /* å†…è¾¹è·åŠ å¤§ï¼Œé¿å…æ–‡å­—ç´§è´´ */
            font-size: 48px;             /* æ”¾å¤§ä¸‰å€ï¼å…³é”®æ”¹åŠ¨ */
            color: rgba(54, 52, 52, 0.9); /* çº¢è‰²ç”¨ rgba æ§åˆ¶ï¼Œä¿ç•™é€æ˜é€šé“ */
            font-weight: bold;
            white-space: nowrap;         /* é˜²æ­¢æ¢è¡Œ */
            text-align: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3); /* è½»å¾®é˜´å½±ï¼Œæå‡å¯è¯»æ€§ */
        }
    </style>
</head>
<body>
    <div class="watermark-grid">
        <span>å†…éƒ¨å®¡è®¡</span><span>ä¸¥ç¦å¤–ä¼ </span><span>å†…éƒ¨å®¡è®¡</span><span>ä¸¥ç¦å¤–ä¼ </span>
        <!-- æ›´å¤š... -->
    </div>

    <!-- æŠ¥å‘Šå†…å®¹ -->
    <div class="report">
        {% if data%}
        <h2>{{ data.meta.title or 'æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š' }}</h2>
        {% endif %}

        <!-- åˆ†æå…ƒä¿¡æ¯ -->
        {% if data%}
        <div class="section">
          <h3>åˆ†æå…ƒä¿¡æ¯</h3>
          <div class="subsection">
            <!-- åŸºç¡€æ ‡è¯† -->
            <p><span class="field-label">æŠ¥å‘ŠIDï¼š</span>{{ data.id or 'æœªçŸ¥' }}</p>
            {% if data.formatter_time %}
              <p><span class="field-label">ç”Ÿæˆæ—¶é—´ï¼š</span>{{ data.formatter_time | default('æœªçŸ¥') }}</p>
            {% endif %}
            <p><span class="field-label">æŠ¥å‘Šç±»å‹ï¼š</span>{{ data.type or 'æœªæŒ‡å®š' }}</p>

            <!-- åŸå§‹å†…å®¹ï¼ˆå»ºè®®ç”¨ <pre> æˆ–é™åˆ¶é«˜åº¦ï¼‰ -->
            {% if data.source and data.source.content %}
              <p><span class="field-label">åŸå§‹æ–‡æœ¬ï¼š</span></p>
              <div style="background:#f9f9f9; padding:8px; border-radius:4px; max-height:150px; overflow:auto; font-family:monospace; font-size:0.9em;">
                {{ data.source.content | e }}
              </div>
            {% endif %}

            <!-- AI ä¸æ¨¡å‹ä¿¡æ¯ -->
            <p><span class="field-label">AI ç”Ÿæˆï¼š</span>{{ 'æ˜¯' if data.meta.created_by_ai else 'å¦' }}</p>
            <p><span class="field-label">æ¨¡å‹ç‰ˆæœ¬ï¼š</span>{{ data.meta.llm_model or 'æœªçŸ¥' }}</p>
            <p><span class="field-label">åº“ç‰ˆæœ¬ï¼š</span>{{ data.meta.library_version or 'æœªçŸ¥' }}</p>
            <p><span class="field-label">å™äº‹å¢å¼ºï¼š</span>{{ 'å·²å¯ç”¨' if data.meta.narrative_enriched else 'æœªå¯ç”¨' }}</p>

            <!-- åç»­æ³¨å…¥å­—æ®µ -->
            {% if data.meta.validity_level %}
              <p><span class="field-label">æœ‰æ•ˆæ€§ç­‰çº§ï¼š</span>{{ data.meta.validity_level }}</p>
            {% endif %}
            {% if data.meta.privacy_scope and data.meta.privacy_scope.privacy_level is defined %}
              <p><span class="field-label">éšç§ç­‰çº§ï¼š</span>{{ "%.2f"|format(data.meta.privacy_scope.privacy_level) }}</p>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- 1. æºæ•°æ®æå–ï¼ˆå‚ä¸è€…ï¼‰ -->
        {% if data.get('participants') %}
        <div class="section">
            <h3>1. å‚ä¸è€…ä¿¡æ¯</h3>
            {% for p in data.participants %}
            <div class="subsection" style="margin-bottom: 24px; padding: 12px; border-left: 2px solid #4a90e2; background: #f9fbfd;">
                <!-- å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè°ƒè¯•ç”¨ï¼Œå¯é€‰æ˜¾ç¤ºï¼‰ -->
                {% if p.get('entity') %}
                <p><span class="field-label">IDï¼š</span><code>{{ p.entity_id }}</code></p>
                {% endif %}

                <!-- åŸºæœ¬èº«ä»½ -->
                {% if p.get('name') %}<p><span class="field-label">å§“å/ç§°å‘¼ï¼š</span>{{ p.name }}</p>{% endif %}
                {% if p.get('social_role') %}<p><span class="field-label">ç¤¾ä¼šè§’è‰²ï¼š</span>{{ p.social_role }}</p>{% endif %}
                {% if p.get('age_range') %}<p><span class="field-label">å¹´é¾„èŒƒå›´ï¼š</span>{{ p.age_range }}</p>{% endif %}
                {% if p.get('gender') %}<p><span class="field-label">æ€§åˆ«ï¼š</span>{{ p.gender }}</p>{% endif %}
                {% if p.get('ethnicity_or_origin') %}<p><span class="field-label">æ—ç¾¤/å‡ºèº«ï¼š</span>{{ p.ethnicity_or_origin }}</p>{% endif %}

                <!-- ç”Ÿç†ä¸æ„Ÿå®˜ç‰¹å¾ï¼ˆæŠ˜å ï¼‰ -->
                <details class="details-block" style="margin-top: 8px;">
                    <summary>ğŸ‘ï¸ ç”Ÿç†ä¸æ„Ÿå®˜ç‰¹å¾</summary>
                    <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                        {% if p.get('physical_traits') %}<p><span class="field-label">ç”Ÿç†ç‰¹å¾ï¼š</span>{{ p.physical_traits | join(', ') }}</p>{% endif %}
                        {% if p.get('appearance') %}<p><span class="field-label">å¤–è²Œç‰¹å¾ï¼š</span>{{ p.appearance | join(', ') }}</p>{% endif %}
                        {% if p.get('baseline_health') %}<p><span class="field-label">åŸºç¡€å¥åº·ï¼š</span>{{ p.baseline_health }}</p>{% endif %}
                        {% if p.get('inherent_odor') %}<p><span class="field-label">å›ºæœ‰æ°”å‘³ï¼š</span>{{ p.inherent_odor | join(', ') }}</p>{% endif %}
                        {% if p.get('voice_quality') %}<p><span class="field-label">å—“éŸ³ç‰¹è´¨ï¼š</span>{{ p.voice_quality }}</p>{% endif %}
                    </div>
                </details>

                <!-- å¿ƒç†ä¸è¡Œä¸ºç‰¹å¾ï¼ˆæŠ˜å ï¼‰ -->
                <details class="details-block" style="margin-top: 8px;">
                    <summary>ğŸ§  å¿ƒç†ä¸è¡Œä¸ºå€¾å‘</summary>
                    <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                        {% if p.get('affective_orientation') %}<p><span class="field-label">æƒ…æ„Ÿä¾æ‹é£æ ¼ï¼š</span>{{ p.affective_orientation | join(', ') }}</p>{% endif %}
                        {% if p.get('personality_traits') %}<p><span class="field-label">äººæ ¼ç‰¹è´¨ï¼š</span>{{ p.personality_traits | join(', ') }}</p>{% endif %}
                        {% if p.get('behavioral_tendencies') %}<p><span class="field-label">è¡Œä¸ºå€¾å‘ï¼š</span>{{ p.behavioral_tendencies | join(', ') }}</p>{% endif %}
                    </div>
                </details>

                <!-- ç¤¾ä¼šæ–‡åŒ–èƒŒæ™¯ï¼ˆæŠ˜å ï¼‰ -->
                <details class="details-block" style="margin-top: 8px;">
                    <summary>ğŸŒ ç¤¾ä¼šæ–‡åŒ–èƒŒæ™¯</summary>
                    <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                        {% if p.get('education_level') %}<p><span class="field-label">æ•™è‚²ç¨‹åº¦ï¼š</span>{{ p.education_level }}</p>{% endif %}
                        {% if p.get('occupation') %}<p><span class="field-label">èŒä¸šï¼š</span>{{ p.occupation }}</p>{% endif %}
                        {% if p.get('socioeconomic_status') %}<p><span class="field-label">ç¤¾ä¼šç»æµåœ°ä½ï¼š</span>{{ p.socioeconomic_status }}</p>{% endif %}
                        {% if p.get('cultural_identity') %}<p><span class="field-label">æ–‡åŒ–èº«ä»½ï¼š</span>{{ p.cultural_identity | join(', ') }}</p>{% endif %}
                        {% if p.get('primary_language') %}<p><span class="field-label">ä¸»è¦è¯­è¨€ï¼š</span>{{ p.primary_language }}</p>{% endif %}
                    </div>
                </details>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- 2. æ—¶é—´æ„ŸçŸ¥ -->
        {% if data.get('temporal') %}
        <div class="section">
            <h3>2. æ—¶é—´æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.temporal.get('summary') %}
                <p><span class="field-label">æ—¶é—´æ‘˜è¦ï¼š</span>{{ data.temporal.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ…ï¼ˆå«å…¨éƒ¨å­—æ®µ + evidence + semantic_notationï¼‰ -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ—¶é—´è§£æè¯¦æƒ…ï¼ˆå«åŸæ–‡è¯æ®ä¸è¯­ä¹‰æ ‡è¯†ï¼‰</summary>
                    <div class="details-content">

                        {% if data.temporal.get('exact_literals') %}
                        <p><span class="field-label">ç²¾ç¡®æ—¶é—´ï¼š</span>{{ data.temporal.exact_literals | join(', ') }}</p>
                        {% endif %}

                        {% if data.temporal.get('relative_expressions') %}
                        <p><span class="field-label">æ¨¡ç³Š/ç›¸å¯¹æ—¶é—´è¡¨è¾¾ï¼š</span>{{ data.temporal.relative_expressions | join(', ') }}</p>
                        {% endif %}

                        {% if data.temporal.get('reference_anchor') %}
                        <p><span class="field-label">æ—¶é—´é”šç‚¹ï¼š</span>{{ data.temporal.reference_anchor }}</p>
                        {% endif %}

                        {% if data.temporal.get('time_ranges') %}
                        <p><span class="field-label">æ—¶é—´åŒºé—´ï¼š</span>{{ data.temporal.time_ranges | join('; ') }}</p>
                        {% endif %}

                        {% if data.temporal.get('durations') %}
                        <p><span class="field-label">æŒç»­æ—¶é•¿ï¼š</span>{{ data.temporal.durations | join(', ') }}</p>
                        {% endif %}

                        {% if data.temporal.get('frequencies') %}
                        <p><span class="field-label">é¢‘ç‡/å‘¨æœŸæ€§ï¼š</span>{{ data.temporal.frequencies | join(', ') }}</p>
                        {% endif %}

                        {% if data.temporal.get('experiencer') %}
                        <p><span class="field-label">æ—¶é—´ä¸»ä½“ï¼š</span>{{ data.temporal.experiencer }}</p>
                        {% endif %}

                        <!-- æ–°å¢ï¼šè¯æ®ç‰‡æ®µ -->
                        {% if data.temporal.get('evidence') %}
                        <p><span class="field-label">åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.temporal.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æ–°å¢ï¼šè¯­ä¹‰æ ‡è¯† -->
                        {% if data.temporal.get('semantic_notation') %}
                        <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.temporal.semantic_notation }}</code></p>
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 3. ç©ºé—´æ„ŸçŸ¥ -->
        {% if data.get('spatial') %}
        <div class="section">
            <h3>3. ç©ºé—´æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.spatial.get('summary') %}
                <p><span class="field-label">ç©ºé—´æ‘˜è¦ï¼š</span>{{ data.spatial.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç©ºé—´è§£æè¯¦æƒ…ï¼ˆå«åŸæ–‡è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸å…³ç³»ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.spatial.get('places') %}
                        <p><span class="field-label">åœ°ç‚¹ï¼š</span>{{ data.spatial.places | join(', ') }}</p>
                        {% endif %}

                        {% if data.spatial.get('layout_descriptions') %}
                        <p><span class="field-label">ç©ºé—´å¸ƒå±€ï¼š</span>{{ data.spatial.layout_descriptions | join('; ') }}</p>
                        {% endif %}

                        {% if data.spatial.get('experiencer') %}
                        <p><span class="field-label">ç©ºé—´ä¸»ä½“ï¼š</span>{{ data.spatial.experiencer }}</p>
                        {% endif %}

                        <!-- æ–°å¢ï¼šå…¨å±€è¯æ®ä¸è¯­ä¹‰æ ‡è¯† -->
                        {% if data.spatial.get('evidence') %}
                        <p><span class="field-label">åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.spatial.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.spatial.get('semantic_notation') %}
                        <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.spatial.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- ç©ºé—´å…³ç³»åˆ—è¡¨ -->
                        {% if data.spatial.get('proximity_relations') and data.spatial.proximity_relations %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ç©ºé—´å…³ç³»è¯¦æƒ…</h4>
                        {% for rel in data.spatial.proximity_relations %}
                        <div class="relation-item" style="padding: 8px; background: #f9f9f9; border-radius: 6px; margin-bottom: 10px;">
                            {% if rel.get('actor') %}<p><span class="field-label">ä¸»åŠ¨æ–¹ï¼š</span>{{ rel.actor }}</p>{% endif %}
                            {% if rel.get('target') %}<p><span class="field-label">ç›®æ ‡æ–¹ï¼š</span>{{ rel.target }}</p>{% endif %}
                            {% if rel.get('distance_cm') is not none %}<p><span class="field-label">è·ç¦»ï¼ˆcmï¼‰ï¼š</span>{{ rel.distance_cm }}</p>{% endif %}
                            {% if rel.get('medium') %}<p><span class="field-label">åª’ä»‹ï¼š</span>{{ rel.medium | join(', ') }}</p>{% endif %}
                            {% if rel.get('channel') %}<p><span class="field-label">æ¸ é“ï¼š</span>{{ rel.channel | join(', ') }}</p>{% endif %}
                            {% if rel.get('barrier') %}<p><span class="field-label">éšœç¢ç‰©ï¼š</span>{{ rel.barrier | join(', ') }}</p>{% endif %}
                            {% if rel.get('relation_type') %}<p><span class="field-label">å…³ç³»ç±»å‹ï¼š</span>{{ rel.relation_type }}</p>{% endif %}
                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 4. è§†è§‰æ„ŸçŸ¥ -->
        {% if data.get('visual') %}
        <div class="section">
            <h3>4. è§†è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.visual.get('summary') %}
                <p><span class="field-label">è§†è§‰æ‘˜è¦ï¼š</span>{{ data.visual.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è§†è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.visual.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.visual.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.visual.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.visual.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- è§†è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.visual.get('events') and data.visual.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§†è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.visual.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.visual.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">è§‚å¯Ÿè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('observed_entity') %}<p><span class="field-label">è¢«è§‚å¯Ÿå¯¹è±¡ï¼š</span>{{ ev.observed_entity }}</p>{% endif %}
                            {% if ev.get('visual_objects') %}<p><span class="field-label">å¯è§ç‰©ä½“ï¼š</span>{{ ev.visual_objects | join(', ') }}</p>{% endif %}
                            {% if ev.get('visual_attributes') %}<p><span class="field-label">è§†è§‰å±æ€§ï¼š</span>{{ ev.visual_attributes | join(', ') }}</p>{% endif %}
                            {% if ev.get('visual_actions') %}<p><span class="field-label">å¯è§åŠ¨ä½œï¼š</span>{{ ev.visual_actions | join(', ') }}</p>{% endif %}
                            {% if ev.get('gaze_target') %}<p><span class="field-label">æ³¨è§†ç›®æ ‡ï¼š</span>{{ ev.gaze_target }}</p>{% endif %}
                            {% if ev.get('eye_contact') %}<p><span class="field-label">çœ¼ç¥äº¤äº’ï¼š</span>{{ ev.eye_contact | join(', ') }}</p>{% endif %}
                            {% if ev.get('facial_cues') %}<p><span class="field-label">é¢éƒ¨çº¿ç´¢ï¼š</span>{{ ev.facial_cues | join(', ') }}</p>{% endif %}
                            {% if ev.get('salience') is not none %}<p><span class="field-label">æ˜¾è‘—æ€§ï¼š</span>{{ "%.2f"|format(ev.salience) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 5. å¬è§‰æ„ŸçŸ¥ -->
        {% if data.get('auditory') %}
        <div class="section">
            <h3>5. å¬è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.auditory.get('summary') %}
                <p><span class="field-label">å¬è§‰æ‘˜è¦ï¼š</span>{{ data.auditory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ”Š å±•å¼€å¬è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.auditory.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.auditory.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.auditory.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.auditory.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- å¬è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.auditory.get('events') and data.auditory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å¬è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.auditory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.auditory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">å¬è€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('sound_source') %}<p><span class="field-label">å£°æºï¼š</span>{{ ev.sound_source }}</p>{% endif %}
                            {% if ev.get('auditory_content') %}<p><span class="field-label">å¬è§‰å†…å®¹ï¼š</span>{{ ev.auditory_content | join(', ') }}</p>{% endif %}
                            {% if ev.get('is_primary_focus') is not none %}
                                <p><span class="field-label">æ˜¯å¦ä¸ºå¬è§‰ç„¦ç‚¹ï¼š</span>
                                    {% if ev.is_primary_focus %}âœ… æ˜¯{% else %}âŒ å¦{% endif %}
                                </p>
                            {% endif %}
                            {% if ev.get('rhetorical_patterns') %}<p><span class="field-label">ä¿®è¾ç»“æ„ï¼š</span>{{ ev.rhetorical_patterns | join(', ') }}</p>{% endif %}
                            {% if ev.get('prosody_cues') %}<p><span class="field-label">è¯­è°ƒç‰¹å¾ï¼š</span>{{ ev.prosody_cues | join(', ') }}</p>{% endif %}
                            {% if ev.get('pause_description') %}<p><span class="field-label">åœé¡¿æè¿°ï¼š</span>{{ ev.pause_description }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}<p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 6. å—…è§‰æ„ŸçŸ¥ -->
        {% if data.get('olfactory') %}
        <div class="section">
            <h3>6. å—…è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.olfactory.get('summary') %}
                <p><span class="field-label">å—…è§‰æ‘˜è¦ï¼š</span>{{ data.olfactory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ‘ƒ å±•å¼€å—…è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.olfactory.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.olfactory.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.olfactory.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.olfactory.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- å—…è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.olfactory.get('events') and data.olfactory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å—…è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.olfactory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.olfactory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">ä½“éªŒè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('odor_source') %}<p><span class="field-label">æ°”å‘³æ¥æºï¼š</span>{{ ev.odor_source }}</p>{% endif %}
                            {% if ev.get('odor_descriptors') %}<p><span class="field-label">æ°”å‘³æè¿°è¯ï¼š</span>{{ ev.odor_descriptors | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}<p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 7. è§¦è§‰æ„ŸçŸ¥ -->
        {% if data.get('tactile') %}
        <div class="section">
            <h3>7. è§¦è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.tactile.get('summary') %}
                <p><span class="field-label">è§¦è§‰æ‘˜è¦ï¼š</span>{{ data.tactile.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>âœ‹ å±•å¼€è§¦è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.tactile.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.tactile.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.tactile.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.tactile.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- è§¦è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.tactile.get('events') and data.tactile.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§¦è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.tactile.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.tactile.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">ä½“éªŒè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('contact_target') %}<p><span class="field-label">æ¥è§¦å¯¹è±¡ï¼š</span>{{ ev.contact_target }}</p>{% endif %}
                            {% if ev.get('tactile_descriptors') %}<p><span class="field-label">è§¦è§‰æè¿°è¯ï¼š</span>{{ ev.tactile_descriptors | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}<p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 8. å‘³è§‰æ„ŸçŸ¥ -->
        {% if data.get('gustatory') %}
        <div class="section">
            <h3>8. å‘³è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.gustatory.get('summary') %}
                <p><span class="field-label">å‘³è§‰æ‘˜è¦ï¼š</span>{{ data.gustatory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ‘… å±•å¼€å‘³è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.gustatory.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.gustatory.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.gustatory.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.gustatory.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- å‘³è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.gustatory.get('events') and data.gustatory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å‘³è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.gustatory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.gustatory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">ä½“éªŒè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('taste_source') %}<p><span class="field-label">å‘³é“æ¥æºï¼š</span>{{ ev.taste_source }}</p>{% endif %}
                            {% if ev.get('taste_descriptors') %}<p><span class="field-label">å‘³è§‰æè¿°è¯ï¼š</span>{{ ev.taste_descriptors | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}<p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 9. å†…æ„Ÿå— -->
        {% if data.get('interoceptive') %}
        <div class="section">
            <h3>9. å†…æ„Ÿå—</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.interoceptive.get('summary') %}
                <p><span class="field-label">å†…æ„Ÿå—æ‘˜è¦ï¼š</span>{{ data.interoceptive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ’“ å±•å¼€å†…æ„Ÿå—è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.interoceptive.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.interoceptive.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.interoceptive.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.interoceptive.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- å†…æ„Ÿå—äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.interoceptive.get('events') and data.interoceptive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å†…æ„Ÿå—äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.interoceptive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.interoceptive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}<p><span class="field-label">ä½“éªŒè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('body_sensation') %}<p><span class="field-label">èº«ä½“æ„Ÿè§‰ï¼š</span>{{ ev.body_sensation | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}<p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>{% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 10. è®¤çŸ¥è¿‡ç¨‹ -->
        {% if data.get('cognitive') %}
        <div class="section">
            <h3>10. è®¤çŸ¥è¿‡ç¨‹</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.cognitive.get('summary') %}
                <p><span class="field-label">è®¤çŸ¥æ‘˜è¦ï¼š</span>{{ data.cognitive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ§  å±•å¼€è®¤çŸ¥è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.cognitive.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.cognitive.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.cognitive.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.cognitive.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- è®¤çŸ¥äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.cognitive.get('events') and data.cognitive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è®¤çŸ¥äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.cognitive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.cognitive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">è®¤çŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('explicit_thought') %}
                            <p><span class="field-label">æ˜¾æ€§æ€ç»´ï¼š</span>{{ ev.explicit_thought | join('; ') }}</p>
                            {% endif %}
                            {% if ev.get('intensity') is not none %}
                            <p><span class="field-label">è®¤çŸ¥å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 11. èº¯ä½“åŒ–è¡¨ç° -->
        {% if data.get('bodily') %}
        <div class="section">
            <h3>11. èº¯ä½“åŒ–è¡¨ç°</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.bodily.get('summary') %}
                <p><span class="field-label">èº¯ä½“åŒ–æ‘˜è¦ï¼š</span>{{ data.bodily.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ¦´ å±•å¼€èº¯ä½“åŒ–è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.bodily.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.bodily.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.bodily.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.bodily.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- èº¯ä½“åŒ–äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.bodily.get('events') and data.bodily.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">èº¯ä½“åŒ–äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.bodily.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.bodily.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('observable_behavior') %}
                            <p><span class="field-label">å¯è§‚æµ‹è¡Œä¸ºï¼š</span>{{ ev.observable_behavior | join(', ') }}</p>
                            {% endif %}
                            {% if ev.get('intensity') is not none %}
                            <p><span class="field-label">ç—‡çŠ¶å¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 12. æƒ…æ„ŸçŠ¶æ€ -->
        {% if data.get('emotional') %}
        <div class="section">
            <h3>12. æƒ…æ„ŸçŠ¶æ€</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.emotional.get('summary') %}
                <p><span class="field-label">æƒ…æ„Ÿæ‘˜è¦ï¼š</span>{{ data.emotional.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>â¤ï¸ å±•å¼€æƒ…æ„Ÿè§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.emotional.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.emotional.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.emotional.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.emotional.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- æƒ…æ„Ÿäº‹ä»¶åˆ—è¡¨ -->
                        {% if data.emotional.get('events') and data.emotional.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æƒ…æ„Ÿäº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.emotional.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.emotional.events %}
                        <div class="relation-item" style="padding: 10px; background: #fff8f8; border-radius: 6px; margin-bottom: 12px; border-left: 3px solid #e74c3c;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">æƒ…ç»ªä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('emotion_labels') %}
                            <p><span class="field-label">æƒ…ç»ªæ ‡ç­¾ï¼š</span>{{ ev.emotion_labels | join(', ') }}</p>
                            {% endif %}
                            {% if ev.get('valence') is not none %}
                            <p><span class="field-label">æ•ˆä»·ï¼ˆ-1~1ï¼‰ï¼š</span>{{ "%.2f"|format(ev.valence) }}</p>
                            {% endif %}
                            {% if ev.get('arousal') is not none %}
                            <p><span class="field-label">å”¤é†’åº¦ï¼ˆ0~1ï¼‰ï¼š</span>{{ "%.2f"|format(ev.arousal) }}</p>
                            {% endif %}
                            {% if ev.get('intensity') is not none %}
                            <p><span class="field-label">æƒ…æ„Ÿå¼ºåº¦ï¼š</span>{{ "%.2f"|format(ev.intensity) }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #fdf6f6; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 13. ç¤¾ä¼šå…³ç³» -->
        {% if data.get('social_relation') %}
        <div class="section">
            <h3>13. ç¤¾ä¼šå…³ç³»</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.social_relation.get('summary') %}
                <p><span class="field-label">å…³ç³»æ‘˜è¦ï¼š</span>{{ data.social_relation.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ‘¥ å±•å¼€ç¤¾ä¼šå…³ç³»è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.social_relation.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.social_relation.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.social_relation.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.social_relation.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- ç¤¾ä¼šå…³ç³»äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.social_relation.get('events') and data.social_relation.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å…³ç³»äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.social_relation.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.social_relation.events %}
                        <div class="relation-item" style="padding: 10px; background: #f0f7ff; border-radius: 6px; margin-bottom: 12px; border-left: 3px solid #3498db;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('participants') %}
                            <p><span class="field-label">å‚ä¸è€…ï¼š</span>{{ ev.participants | join(', ') }}</p>
                            {% endif %}
                            {% if ev.get('relation_type') %}
                            <p><span class="field-label">å…³ç³»ç±»å‹ï¼š</span>{{ ev.relation_type | join(', ') }}</p>
                            {% endif %}
                            {% if ev.get('explicit_relation_statement') %}
                            <p><span class="field-label">å…³ç³»é™ˆè¿°ï¼š</span>{{ ev.explicit_relation_statement | join('; ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #eef7ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">äº‹ä»¶è¯­ä¹‰ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 14. æ¨ç†å±‚ -->
        {% if data.get('inference') %}
        <div class="section">
            <h3>14. æ¨ç†åˆ†æ</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.inference.get('summary') %}
                <p><span class="field-label">æ¨ç†æ‘˜è¦ï¼š</span>{{ data.inference.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ§  å±•å¼€æ¨ç†è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.inference.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.inference.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.inference.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.inference.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- æ¨ç†äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.inference.get('events') and data.inference.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ¨ç†äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.inference.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.inference.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 3px solid #9b59b6;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">æ¨ç†ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('inference_type') %}
                            <p><span class="field-label">æ¨ç†ç±»å‹ï¼š</span>{{ ev.inference_type }}</p>
                            {% endif %}
                            {% if ev.get('inferred_proposition') %}
                            <p><span class="field-label">æ¨ç†ç»“è®ºï¼š</span>{{ ev.inferred_proposition }}</p>
                            {% endif %}
                            {% if ev.get('anchor_points') %}
                            <p><span class="field-label">ä¾æ®é”šç‚¹ï¼ˆè¯­ä¹‰æ ‡è¯†ï¼‰ï¼š</span>
                                <code>{{ ev.anchor_points | join(', ') }}</code>
                            </p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') or ev.get('semantic_notation') %}
                            <details class="details-block" style="margin-top: 8px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬æ¨ç†ä¾æ®ä¸è¯­ä¹‰</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f5f6fa; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('evidence') %}
                                    <p><span class="field-label">åŸå§‹æ–‡æœ¬è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                    {% if ev.get('semantic_notation') %}
                                    <p><span class="field-label">æ¨ç†è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 15. æ·±åº¦åˆ†æ -->
        {% if data.get('deep_analysis') %}
        <div class="section">
            <h3>15. æ·±åº¦åˆ†æ</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.deep_analysis.get('summary') %}
                <p><span class="field-label">æ·±å±‚åŠ¨å› æ‘˜è¦ï¼š</span>{{ data.deep_analysis.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ·±åº¦åŠ¨å› è§£æï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶çº§æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.deep_analysis.get('evidence') %}
                        <p><span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.deep_analysis.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if data.deep_analysis.get('semantic_notation') %}
                        <p><span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.deep_analysis.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- æ·±åº¦åˆ†æäº‹ä»¶åˆ—è¡¨ -->
                        {% if data.deep_analysis.get('events') and data.deep_analysis.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ·±åº¦åŠ¨å› äº‹ä»¶ï¼ˆå…± {{ data.deep_analysis.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.deep_analysis.events %}
                        <div class="relation-item" style="padding: 12px; background: #fff9f0; border-radius: 6px; margin-bottom: 14px; border-left: 3px solid #e67e22;">

                            <!-- åŸºç¡€ä¿¡æ¯ -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">åˆ†æå¯¹è±¡ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}

                            <!-- æ ¸å¿ƒåŠ¨æœºç»„ï¼ˆå…³æ€€/ææƒ§/ä¿æŠ¤ï¼‰ -->
                            {% if ev.get('core_driver') or ev.get('care_expression') or ev.get('separation_anxiety') or ev.get('protective_intent') %}
                            <div style="margin-top: 8px; padding: 8px; background: #fdf6e3; border-radius: 4px;">
                                <strong>â¤ï¸ æ ¸å¿ƒæƒ…æ„Ÿä¸åŠ¨æœºï¼š</strong>
                                {% if ev.get('core_driver') %}<p><span class="field-label">æ ¹æœ¬é©±åŠ¨åŠ›ï¼š</span>{{ ev.core_driver | join('; ') }}</p>{% endif %}
                                {% if ev.get('care_expression') %}<p><span class="field-label">å…³æ€€è¡¨è¾¾ï¼š</span>{{ ev.care_expression | join('; ') }}</p>{% endif %}
                                {% if ev.get('separation_anxiety') %}<p><span class="field-label">åˆ†ç¦»ç„¦è™‘ï¼š</span>{{ ev.separation_anxiety | join('; ') }}</p>{% endif %}
                                {% if ev.get('protective_intent') %}<p><span class="field-label">ä¿æŠ¤æ„å›¾ï¼š</span>{{ ev.protective_intent | join('; ') }}</p>{% endif %}
                            </div>
                            {% endif %}

                            <!-- æ§åˆ¶ä¸æœä»ç»“æ„ -->
                            {% if ev.get('resource_control') or ev.get('survival_imperative') or ev.get('social_enforcement_mechanism') %}
                            <div style="margin-top: 8px; padding: 8px; background: #f0f9ff; border-radius: 4px;">
                                <strong>âš–ï¸ æ§åˆ¶ã€æœä»ä¸ç¤¾ä¼šå‹åŠ›ï¼š</strong>
                                {% if ev.get('resource_control') %}<p><span class="field-label">èµ„æºæ§åˆ¶ï¼š</span>{{ ev.resource_control | join('; ') }}</p>{% endif %}
                                {% if ev.get('survival_imperative') %}<p><span class="field-label">ç”Ÿå­˜æ€§æœä»ï¼š</span>{{ ev.survival_imperative | join('; ') }}</p>{% endif %}
                                {% if ev.get('social_enforcement_mechanism') %}<p><span class="field-label">ç¤¾ä¼šè§„èŒƒå‹åŠ›ï¼š</span>{{ ev.social_enforcement_mechanism | join('; ') }}</p>{% endif %}
                            </div>
                            {% endif %}

                            <!-- æƒåŠ›ä¸å¯¹ç§°ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('power_asymmetry') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ” æƒåŠ›ä¸å¯¹ç§°ç»“æ„ï¼ˆæ§åˆ¶/ä¾èµ–/å¨èƒï¼‰</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #f8f0ff; border-radius: 4px;">
                                    {% if ev.power_asymmetry.get('control_axis') %}<p><span class="field-label">æ§åˆ¶ç»´åº¦ï¼š</span>{{ ev.power_asymmetry.control_axis | join(', ') }}</p>{% endif %}
                                    {% if ev.power_asymmetry.get('dependency_ratio') is not none %}
                                    <p><span class="field-label">ä¾èµ–ç¨‹åº¦ï¼š</span>{{ "%.2f"|format(ev.power_asymmetry.dependency_ratio) }}</p>
                                    {% endif %}
                                    {% if ev.power_asymmetry.get('threat_vector') %}<p><span class="field-label">å¨èƒæ–¹å¼ï¼š</span>{{ ev.power_asymmetry.threat_vector | join(', ') }}</p>{% endif %}
                                    {% if ev.power_asymmetry.get('evidence') %}
                                    <p><span class="field-label">æƒåŠ›è¯æ®ï¼š</span>
                                        {% for frag in ev.power_asymmetry.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                            <!-- è¯æœ¯ç­–ç•¥ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('narrative_distortion') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ­ è¯æœ¯ç­–ç•¥ï¼ˆè‡ªæˆ‘åˆç†åŒ–/è´£ä»»è½¬å«/é“å¾·è±å…ï¼‰</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #f0fff0; border-radius: 4px;">
                                    {% if ev.narrative_distortion.get('self_justification') %}
                                    <p><span class="field-label">è‡ªæˆ‘åˆç†åŒ–ï¼š</span>{{ ev.narrative_distortion.self_justification }}</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('blame_shift') %}
                                    <p><span class="field-label">è´£ä»»è½¬å«ï¼š</span>{{ ev.narrative_distortion.blame_shift }}</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('moral_licensing') %}
                                    <p><span class="field-label">é“å¾·è±å…ï¼š</span>{{ ev.narrative_distortion.moral_licensing }}</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('evidence') %}
                                    <p><span class="field-label">è¯æœ¯è¯æ®ï¼š</span>
                                        {% for frag in ev.narrative_distortion.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 16. åˆç†å»ºè®® -->
        {% if data.get('rational_advice') %}
        <div class="section">
            <h3>16. åˆç†å»ºè®®</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.rational_advice.get('summary') %}
                <p><span class="field-label">å»ºè®®æ¦‚è¿°ï¼š</span>{{ data.rational_advice.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ› ï¸ å±•å¼€å®Œæ•´å»ºè®®æ–¹æ¡ˆï¼ˆå«ä¾æ®ã€ä»£ä»·è¯„ä¼°ä¸æ–‡åŒ–é€‚é…ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.rational_advice.get('evidence') %}
                        <p><span class="field-label">å»ºè®®ä¾æ®ï¼ˆæ¥è‡ªåˆ†æå±‚è¯­ä¹‰æ ‡è¯†ï¼‰ï¼š</span>
                            <code>{{ data.rational_advice.evidence | join(', ') }}</code>
                        </p>
                        {% endif %}

                        {% if data.rational_advice.get('semantic_notation') %}
                        <p><span class="field-label">å»ºè®®è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.rational_advice.semantic_notation }}</code></p>
                        {% endif %}

                        <!-- å®‰å…¨ä¼˜å…ˆå¹²é¢„ï¼ˆé«˜äº®ï¼‰ -->
                        {% if data.rational_advice.get('safety_first_intervention') %}
                        <h4 style="color: #c0392b; margin-top: 16px;">âš ï¸ å®‰å…¨ä¼˜å…ˆå¹²é¢„ï¼ˆç«‹å³æ‰§è¡Œï¼‰</h4>
                        <ul class="advice-list" style="background: #fff5f5; padding: 10px; border-left: 3px solid #e74c3c;">
                            {% for item in data.rational_advice.safety_first_intervention %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- ç³»ç»Ÿæ æ†ç‚¹ -->
                        {% if data.rational_advice.get('systemic_leverage_point') %}
                        <h4 style="margin-top: 16px;">ğŸ¯ ç³»ç»Ÿæ æ†ç‚¹ï¼ˆå…³é”®çªç ´å£ï¼‰</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.systemic_leverage_point %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- åˆ†é˜¶æ®µç­–ç•¥ -->
                        {% if data.rational_advice.get('incremental_strategy') %}
                        <h4 style="margin-top: 16px;">ğŸ“ˆ åˆ†é˜¶æ®µç­–ç•¥ï¼ˆä½é£é™©æ¸è¿›ï¼‰</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.incremental_strategy %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- é•¿æœŸè„±ç¦»è·¯å¾„ -->
                        {% if data.rational_advice.get('long_term_exit_path') %}
                        <h4 style="margin-top: 16px;">ğŸšª é•¿æœŸè„±ç¦»è·¯å¾„ï¼ˆå¯æŒç»­é€€å‡ºï¼‰</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.long_term_exit_path %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- æ–‡åŒ–é€‚åº”å»ºè®® -->
                        {% if data.rational_advice.get('cultural_adaptation_needed') %}
                        <h4 style="margin-top: 16px;">ğŸŒ æ–‡åŒ–é€‚åº”å»ºè®®</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.cultural_adaptation_needed %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- åˆ©ç›Šç›¸å…³æ–¹ä»£ä»·è¯„ä¼°ï¼ˆæŠ˜å ï¼‰ -->
                        {% if data.rational_advice.get('stakeholder_tradeoffs') %}
                        <details class="details-block" style="margin-top: 16px;">
                            <summary>âš–ï¸ åˆ©ç›Šç›¸å…³æ–¹ä»£ä»·è¯„ä¼°ï¼ˆå«ä¾æ®ï¼‰</summary>
                            <div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                                {% if data.rational_advice.stakeholder_tradeoffs.get('victim_cost') %}
                                <p><span class="field-label">ä½ä½è€…é£é™©ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.victim_cost | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('oppressor_loss') %}
                                <p><span class="field-label">é«˜ä½è€…æŸå¤±ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.oppressor_loss | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('system_stability') %}
                                <p><span class="field-label">ç³»ç»Ÿç¨³å®šæ€§å½±å“ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.system_stability | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('evidence') %}
                                <p><span class="field-label">ä»£ä»·è¯„ä¼°ä¾æ®ï¼š</span>
                                    {% for frag in data.rational_advice.stakeholder_tradeoffs.evidence %}
                                    <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                    {% endfor %}
                                </p>
                                {% endif %}
                            </div>
                        </details>
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        {% if data.analysis and data.analysis.suggestion %}
            <section class="suggestion-section">
                <h3>17. æŠ¥å‘Šè§£è¯»</h3>
                {% if data.analysis.suggestion.success %}
                    <div class="suggestion-content">{{ data.analysis.suggestion.content }}</div>
                {% else %}
                    <div class="suggestion-error">
                      <em>{{ data.analysis.suggestion.content }}</em>
                    </div>
                {% endif %}
            </section>
        {% endif %}

        <!-- è‹¥æ— ä»»ä½•æ•°æ® -->
        {% if not data or (data|length == 0) %}
        <p class="empty-section">æš‚æ— åˆ†ææ•°æ®ã€‚</p>
        {% endif %}
    </div>

    <!-- åˆ†äº«é€‰é¡¹ -->
    <div class="share-options">
        <h3>åˆ†äº«è¿™ä»½æŠ¥å‘Šï¼š</h3>
        <button id="btn-export-md" class="share-btn" onclick="saveAsMarkdown()">
            ğŸ’¾ å¯¼å‡ºä¸º Markdown
        </button>
        <button id="btn-generate-pdf" class="share-btn" onclick="generatePDF()">
            ğŸ–¨ï¸ ç”ŸæˆPDFæŠ¥å‘Š
        </button>
        <button id="btn-copy-text" class="share-btn" onclick="copyReportText()">
            ğŸ“‹ å¤åˆ¶æŠ¥å‘Šæ–‡æœ¬
        </button>
    </div>

    <!-- å›¾æ ‡ -->
    <div id="scroll-controls" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 1000;
    ">
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
                title="å›åˆ°é¡¶éƒ¨"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–²
        </button>
        <button onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})"
                title="æ»šåŠ¨åˆ°åº•"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–¼
        </button>
    </div>

    <script>
        var TurndownService = (function () {
          'use strict';

          function extend (destination) {
            for (var i = 1; i < arguments.length; i++) {
              var source = arguments[i];
              for (var key in source) {
                if (source.hasOwnProperty(key)) destination[key] = source[key];
              }
            }
            return destination
          }

          function repeat (character, count) {
            return Array(count + 1).join(character)
          }

          function trimLeadingNewlines (string) {
            return string.replace(/^\n*/, '')
          }

          function trimTrailingNewlines (string) {
            // avoid match-at-end regexp bottleneck, see #370
            var indexEnd = string.length;
            while (indexEnd > 0 && string[indexEnd - 1] === '\n') indexEnd--;
            return string.substring(0, indexEnd)
          }

          var blockElements = [
            'ADDRESS', 'ARTICLE', 'ASIDE', 'AUDIO', 'BLOCKQUOTE', 'BODY', 'CANVAS',
            'CENTER', 'DD', 'DIR', 'DIV', 'DL', 'DT', 'FIELDSET', 'FIGCAPTION', 'FIGURE',
            'FOOTER', 'FORM', 'FRAMESET', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'HEADER',
            'HGROUP', 'HR', 'HTML', 'ISINDEX', 'LI', 'MAIN', 'MENU', 'NAV', 'NOFRAMES',
            'NOSCRIPT', 'OL', 'OUTPUT', 'P', 'PRE', 'SECTION', 'TABLE', 'TBODY', 'TD',
            'TFOOT', 'TH', 'THEAD', 'TR', 'UL'
          ];

          function isBlock (node) {
            return is(node, blockElements)
          }

          var voidElements = [
            'AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT',
            'KEYGEN', 'LINK', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR'
          ];

          function isVoid (node) {
            return is(node, voidElements)
          }

          function hasVoid (node) {
            return has(node, voidElements)
          }

          var meaningfulWhenBlankElements = [
            'A', 'TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TH', 'TD', 'IFRAME', 'SCRIPT',
            'AUDIO', 'VIDEO'
          ];

          function isMeaningfulWhenBlank (node) {
            return is(node, meaningfulWhenBlankElements)
          }

          function hasMeaningfulWhenBlank (node) {
            return has(node, meaningfulWhenBlankElements)
          }

          function is (node, tagNames) {
            return tagNames.indexOf(node.nodeName) >= 0
          }

          function has (node, tagNames) {
            return (
              node.getElementsByTagName &&
              tagNames.some(function (tagName) {
                return node.getElementsByTagName(tagName).length
              })
            )
          }

          var rules = {};

          rules.paragraph = {
            filter: 'p',

            replacement: function (content) {
              return '\n\n' + content + '\n\n'
            }
          };

          rules.lineBreak = {
            filter: 'br',

            replacement: function (content, node, options) {
              return options.br + '\n'
            }
          };

          rules.heading = {
            filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],

            replacement: function (content, node, options) {
              var hLevel = Number(node.nodeName.charAt(1));

              if (options.headingStyle === 'setext' && hLevel < 3) {
                var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);
                return (
                  '\n\n' + content + '\n' + underline + '\n\n'
                )
              } else {
                return '\n\n' + repeat('#', hLevel) + ' ' + content + '\n\n'
              }
            }
          };

          rules.blockquote = {
            filter: 'blockquote',

            replacement: function (content) {
              content = content.replace(/^\n+|\n+$/g, '');
              content = content.replace(/^/gm, '> ');
              return '\n\n' + content + '\n\n'
            }
          };

          rules.list = {
            filter: ['ul', 'ol'],

            replacement: function (content, node) {
              var parent = node.parentNode;
              if (parent.nodeName === 'LI' && parent.lastElementChild === node) {
                return '\n' + content
              } else {
                return '\n\n' + content + '\n\n'
              }
            }
          };

          rules.listItem = {
            filter: 'li',

            replacement: function (content, node, options) {
              content = content
                .replace(/^\n+/, '') // remove leading newlines
                .replace(/\n+$/, '\n') // replace trailing newlines with just a single one
                .replace(/\n/gm, '\n    '); // indent
              var prefix = options.bulletListMarker + '   ';
              var parent = node.parentNode;
              if (parent.nodeName === 'OL') {
                var start = parent.getAttribute('start');
                var index = Array.prototype.indexOf.call(parent.children, node);
                prefix = (start ? Number(start) + index : index + 1) + '.  ';
              }
              return (
                prefix + content + (node.nextSibling && !/\n$/.test(content) ? '\n' : '')
              )
            }
          };

          rules.indentedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'indented' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              return (
                '\n\n    ' +
                node.firstChild.textContent.replace(/\n/g, '\n    ') +
                '\n\n'
              )
            }
          };

          rules.fencedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'fenced' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              var className = node.firstChild.getAttribute('class') || '';
              var language = (className.match(/language-(\S+)/) || [null, ''])[1];
              var code = node.firstChild.textContent;

              var fenceChar = options.fence.charAt(0);
              var fenceSize = 3;
              var fenceInCodeRegex = new RegExp('^' + fenceChar + '{3,}', 'gm');

              var match;
              while ((match = fenceInCodeRegex.exec(code))) {
                if (match[0].length >= fenceSize) {
                  fenceSize = match[0].length + 1;
                }
              }

              var fence = repeat(fenceChar, fenceSize);

              return (
                '\n\n' + fence + language + '\n' +
                code.replace(/\n$/, '') +
                '\n' + fence + '\n\n'
              )
            }
          };

          rules.horizontalRule = {
            filter: 'hr',

            replacement: function (content, node, options) {
              return '\n\n' + options.hr + '\n\n'
            }
          };

          rules.inlineLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'inlined' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              return '[' + content + '](' + href + title + ')'
            }
          };

          rules.referenceLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'referenced' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node, options) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              var replacement;
              var reference;

              switch (options.linkReferenceStyle) {
                case 'collapsed':
                  replacement = '[' + content + '][]';
                  reference = '[' + content + ']: ' + href + title;
                  break
                case 'shortcut':
                  replacement = '[' + content + ']';
                  reference = '[' + content + ']: ' + href + title;
                  break
                default:
                  var id = this.references.length + 1;
                  replacement = '[' + content + '][' + id + ']';
                  reference = '[' + id + ']: ' + href + title;
              }

              this.references.push(reference);
              return replacement
            },

            references: [],

            append: function (options) {
              var references = '';
              if (this.references.length) {
                references = '\n\n' + this.references.join('\n') + '\n\n';
                this.references = []; // Reset references
              }
              return references
            }
          };

          rules.emphasis = {
            filter: ['em', 'i'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.emDelimiter + content + options.emDelimiter
            }
          };

          rules.strong = {
            filter: ['strong', 'b'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.strongDelimiter + content + options.strongDelimiter
            }
          };

          rules.code = {
            filter: function (node) {
              var hasSiblings = node.previousSibling || node.nextSibling;
              var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;

              return node.nodeName === 'CODE' && !isCodeBlock
            },

            replacement: function (content) {
              if (!content) return ''
              content = content.replace(/\r?\n|\r/g, ' ');

              var extraSpace = /^`|^ .*?[^ ].* $|`$/.test(content) ? ' ' : '';
              var delimiter = '`';
              var matches = content.match(/`+/gm) || [];
              while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';

              return delimiter + extraSpace + content + extraSpace + delimiter
            }
          };

          rules.image = {
            filter: 'img',

            replacement: function (content, node) {
              var alt = cleanAttribute(node.getAttribute('alt'));
              var src = node.getAttribute('src') || '';
              var title = cleanAttribute(node.getAttribute('title'));
              var titlePart = title ? ' "' + title + '"' : '';
              return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''
            }
          };

          function cleanAttribute (attribute) {
            return attribute ? attribute.replace(/(\n+\s*)+/g, '\n') : ''
          }

          /**
           * Manages a collection of rules used to convert HTML to Markdown
           */

          function Rules (options) {
            this.options = options;
            this._keep = [];
            this._remove = [];

            this.blankRule = {
              replacement: options.blankReplacement
            };

            this.keepReplacement = options.keepReplacement;

            this.defaultRule = {
              replacement: options.defaultReplacement
            };

            this.array = [];
            for (var key in options.rules) this.array.push(options.rules[key]);
          }

          Rules.prototype = {
            add: function (key, rule) {
              this.array.unshift(rule);
            },

            keep: function (filter) {
              this._keep.unshift({
                filter: filter,
                replacement: this.keepReplacement
              });
            },

            remove: function (filter) {
              this._remove.unshift({
                filter: filter,
                replacement: function () {
                  return ''
                }
              });
            },

            forNode: function (node) {
              if (node.isBlank) return this.blankRule
              var rule;

              if ((rule = findRule(this.array, node, this.options))) return rule
              if ((rule = findRule(this._keep, node, this.options))) return rule
              if ((rule = findRule(this._remove, node, this.options))) return rule

              return this.defaultRule
            },

            forEach: function (fn) {
              for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);
            }
          };

          function findRule (rules, node, options) {
            for (var i = 0; i < rules.length; i++) {
              var rule = rules[i];
              if (filterValue(rule, node, options)) return rule
            }
            return void 0
          }

          function filterValue (rule, node, options) {
            var filter = rule.filter;
            if (typeof filter === 'string') {
              if (filter === node.nodeName.toLowerCase()) return true
            } else if (Array.isArray(filter)) {
              if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true
            } else if (typeof filter === 'function') {
              if (filter.call(rule, node, options)) return true
            } else {
              throw new TypeError('`filter` needs to be a string, array, or function')
            }
          }

          /**
           * The collapseWhitespace function is adapted from collapse-whitespace
           * by Luc Thevenard.
           *
           * The MIT License (MIT)
           *
           * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>
           *
           * Permission is hereby granted, free of charge, to any person obtaining a copy
           * of this software and associated documentation files (the "Software"), to deal
           * in the Software without restriction, including without limitation the rights
           * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
           * copies of the Software, and to permit persons to whom the Software is
           * furnished to do so, subject to the following conditions:
           *
           * The above copyright notice and this permission notice shall be included in
           * all copies or substantial portions of the Software.
           *
           * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
           * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
           * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
           * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
           * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
           * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
           * THE SOFTWARE.
           */

          /**
           * collapseWhitespace(options) removes extraneous whitespace from an the given element.
           *
           * @param {Object} options
           */
          function collapseWhitespace (options) {
            var element = options.element;
            var isBlock = options.isBlock;
            var isVoid = options.isVoid;
            var isPre = options.isPre || function (node) {
              return node.nodeName === 'PRE'
            };

            if (!element.firstChild || isPre(element)) return

            var prevText = null;
            var keepLeadingWs = false;

            var prev = null;
            var node = next(prev, element, isPre);

            while (node !== element) {
              if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE
                var text = node.data.replace(/[ \r\n\t]+/g, ' ');

                if ((!prevText || / $/.test(prevText.data)) &&
                    !keepLeadingWs && text[0] === ' ') {
                  text = text.substr(1);
                }

                // `text` might be empty at this point.
                if (!text) {
                  node = remove(node);
                  continue
                }

                node.data = text;

                prevText = node;
              } else if (node.nodeType === 1) { // Node.ELEMENT_NODE
                if (isBlock(node) || node.nodeName === 'BR') {
                  if (prevText) {
                    prevText.data = prevText.data.replace(/ $/, '');
                  }

                  prevText = null;
                  keepLeadingWs = false;
                } else if (isVoid(node) || isPre(node)) {
                  // Avoid trimming space around non-block, non-BR void elements and inline PRE.
                  prevText = null;
                  keepLeadingWs = true;
                } else if (prevText) {
                  // Drop protection if set previously.
                  keepLeadingWs = false;
                }
              } else {
                node = remove(node);
                continue
              }

              var nextNode = next(prev, node, isPre);
              prev = node;
              node = nextNode;
            }

            if (prevText) {
              prevText.data = prevText.data.replace(/ $/, '');
              if (!prevText.data) {
                remove(prevText);
              }
            }
          }

          /**
           * remove(node) removes the given node from the DOM and returns the
           * next node in the sequence.
           *
           * @param {Node} node
           * @return {Node} node
           */
          function remove (node) {
            var next = node.nextSibling || node.parentNode;

            node.parentNode.removeChild(node);

            return next
          }

          /**
           * next(prev, current, isPre) returns the next node in the sequence, given the
           * current and previous nodes.
           *
           * @param {Node} prev
           * @param {Node} current
           * @param {Function} isPre
           * @return {Node}
           */
          function next (prev, current, isPre) {
            if ((prev && prev.parentNode === current) || isPre(current)) {
              return current.nextSibling || current.parentNode
            }

            return current.firstChild || current.nextSibling || current.parentNode
          }

          /*
           * Set up window for Node.js
           */

          var root = (typeof window !== 'undefined' ? window : {});

          /*
           * Parsing HTML strings
           */

          function canParseHTMLNatively () {
            var Parser = root.DOMParser;
            var canParse = false;

            // Adapted from https://gist.github.com/1129031
            // Firefox/Opera/IE throw errors on unsupported types
            try {
              // WebKit returns null on unsupported types
              if (new Parser().parseFromString('', 'text/html')) {
                canParse = true;
              }
            } catch (e) {}

            return canParse
          }

          function createHTMLParser () {
            var Parser = function () {};

            {
              if (shouldUseActiveX()) {
                Parser.prototype.parseFromString = function (string) {
                  var doc = new window.ActiveXObject('htmlfile');
                  doc.designMode = 'on'; // disable on-page scripts
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              } else {
                Parser.prototype.parseFromString = function (string) {
                  var doc = document.implementation.createHTMLDocument('');
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              }
            }
            return Parser
          }

          function shouldUseActiveX () {
            var useActiveX = false;
            try {
              document.implementation.createHTMLDocument('').open();
            } catch (e) {
              if (window.ActiveXObject) useActiveX = true;
            }
            return useActiveX
          }

          var HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();

          function RootNode (input, options) {
            var root;
            if (typeof input === 'string') {
              var doc = htmlParser().parseFromString(
                // DOM parsers arrange elements in the <head> and <body>.
                // Wrapping in a custom element ensures elements are reliably arranged in
                // a single element.
                '<x-turndown id="turndown-root">' + input + '</x-turndown>',
                'text/html'
              );
              root = doc.getElementById('turndown-root');
            } else {
              root = input.cloneNode(true);
            }
            collapseWhitespace({
              element: root,
              isBlock: isBlock,
              isVoid: isVoid,
              isPre: options.preformattedCode ? isPreOrCode : null
            });

            return root
          }

          var _htmlParser;
          function htmlParser () {
            _htmlParser = _htmlParser || new HTMLParser();
            return _htmlParser
          }

          function isPreOrCode (node) {
            return node.nodeName === 'PRE' || node.nodeName === 'CODE'
          }

          function Node (node, options) {
            node.isBlock = isBlock(node);
            node.isCode = node.nodeName === 'CODE' || node.parentNode.isCode;
            node.isBlank = isBlank(node);
            node.flankingWhitespace = flankingWhitespace(node, options);
            return node
          }

          function isBlank (node) {
            return (
              !isVoid(node) &&
              !isMeaningfulWhenBlank(node) &&
              /^\s*$/i.test(node.textContent) &&
              !hasVoid(node) &&
              !hasMeaningfulWhenBlank(node)
            )
          }

          function flankingWhitespace (node, options) {
            if (node.isBlock || (options.preformattedCode && node.isCode)) {
              return { leading: '', trailing: '' }
            }

            var edges = edgeWhitespace(node.textContent);

            // abandon leading ASCII WS if left-flanked by ASCII WS
            if (edges.leadingAscii && isFlankedByWhitespace('left', node, options)) {
              edges.leading = edges.leadingNonAscii;
            }

            // abandon trailing ASCII WS if right-flanked by ASCII WS
            if (edges.trailingAscii && isFlankedByWhitespace('right', node, options)) {
              edges.trailing = edges.trailingNonAscii;
            }

            return { leading: edges.leading, trailing: edges.trailing }
          }

          function edgeWhitespace (string) {
            var m = string.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);
            return {
              leading: m[1], // whole string for whitespace-only strings
              leadingAscii: m[2],
              leadingNonAscii: m[3],
              trailing: m[4], // empty for whitespace-only strings
              trailingNonAscii: m[5],
              trailingAscii: m[6]
            }
          }

          function isFlankedByWhitespace (side, node, options) {
            var sibling;
            var regExp;
            var isFlanked;

            if (side === 'left') {
              sibling = node.previousSibling;
              regExp = / $/;
            } else {
              sibling = node.nextSibling;
              regExp = /^ /;
            }

            if (sibling) {
              if (sibling.nodeType === 3) {
                isFlanked = regExp.test(sibling.nodeValue);
              } else if (options.preformattedCode && sibling.nodeName === 'CODE') {
                isFlanked = false;
              } else if (sibling.nodeType === 1 && !isBlock(sibling)) {
                isFlanked = regExp.test(sibling.textContent);
              }
            }
            return isFlanked
          }

          var reduce = Array.prototype.reduce;
          var escapes = [
            [/\\/g, '\\\\'],
            [/\*/g, '\\*'],
            [/^-/g, '\\-'],
            [/^\+ /g, '\\+ '],
            [/^(=+)/g, '\\$1'],
            [/^(#{1,6}) /g, '\\$1 '],
            [/`/g, '\\`'],
            [/^~~~/g, '\\~~~'],
            [/\[/g, '\\['],
            [/\]/g, '\\]'],
            [/^>/g, '\\>'],
            [/_/g, '\\_'],
            [/^(\d+)\. /g, '$1\\. ']
          ];

          function TurndownService (options) {
            if (!(this instanceof TurndownService)) return new TurndownService(options)

            var defaults = {
              rules: rules,
              headingStyle: 'setext',
              hr: '* * *',
              bulletListMarker: '*',
              codeBlockStyle: 'indented',
              fence: '```',
              emDelimiter: '_',
              strongDelimiter: '**',
              linkStyle: 'inlined',
              linkReferenceStyle: 'full',
              br: '  ',
              preformattedCode: false,
              blankReplacement: function (content, node) {
                return node.isBlock ? '\n\n' : ''
              },
              keepReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + node.outerHTML + '\n\n' : node.outerHTML
              },
              defaultReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + content + '\n\n' : content
              }
            };
            this.options = extend({}, defaults, options);
            this.rules = new Rules(this.options);
          }

          TurndownService.prototype = {
            /**
             * The entry point for converting a string or DOM node to Markdown
             * @public
             * @param {String|HTMLElement} input The string or DOM node to convert
             * @returns A Markdown representation of the input
             * @type String
             */

            turndown: function (input) {
              if (!canConvert(input)) {
                throw new TypeError(
                  input + ' is not a string, or an element/document/fragment node.'
                )
              }

              if (input === '') return ''

              var output = process.call(this, new RootNode(input, this.options));
              return postProcess.call(this, output)
            },

            /**
             * Add one or more plugins
             * @public
             * @param {Function|Array} plugin The plugin or array of plugins to add
             * @returns The Turndown instance for chaining
             * @type Object
             */

            use: function (plugin) {
              if (Array.isArray(plugin)) {
                for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);
              } else if (typeof plugin === 'function') {
                plugin(this);
              } else {
                throw new TypeError('plugin must be a Function or an Array of Functions')
              }
              return this
            },

            /**
             * Adds a rule
             * @public
             * @param {String} key The unique key of the rule
             * @param {Object} rule The rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            addRule: function (key, rule) {
              this.rules.add(key, rule);
              return this
            },

            /**
             * Keep a node (as HTML) that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            keep: function (filter) {
              this.rules.keep(filter);
              return this
            },

            /**
             * Remove a node that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            remove: function (filter) {
              this.rules.remove(filter);
              return this
            },

            /**
             * Escapes Markdown syntax
             * @public
             * @param {String} string The string to escape
             * @returns A string with Markdown syntax escaped
             * @type String
             */

            escape: function (string) {
              return escapes.reduce(function (accumulator, escape) {
                return accumulator.replace(escape[0], escape[1])
              }, string)
            }
          };

          /**
           * Reduces a DOM node down to its Markdown string equivalent
           * @private
           * @param {HTMLElement} parentNode The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function process (parentNode) {
            var self = this;
            return reduce.call(parentNode.childNodes, function (output, node) {
              node = new Node(node, self.options);

              var replacement = '';
              if (node.nodeType === 3) {
                replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);
              } else if (node.nodeType === 1) {
                replacement = replacementForNode.call(self, node);
              }

              return join(output, replacement)
            }, '')
          }

          /**
           * Appends strings as each rule requires and trims the output
           * @private
           * @param {String} output The conversion output
           * @returns A trimmed version of the ouput
           * @type String
           */

          function postProcess (output) {
            var self = this;
            this.rules.forEach(function (rule) {
              if (typeof rule.append === 'function') {
                output = join(output, rule.append(self.options));
              }
            });

            return output.replace(/^[\t\r\n]+/, '').replace(/[\t\r\n\s]+$/, '')
          }

          /**
           * Converts an element node to its Markdown equivalent
           * @private
           * @param {HTMLElement} node The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function replacementForNode (node) {
            var rule = this.rules.forNode(node);
            var content = process.call(this, node);
            var whitespace = node.flankingWhitespace;
            if (whitespace.leading || whitespace.trailing) content = content.trim();
            return (
              whitespace.leading +
              rule.replacement(content, node, this.options) +
              whitespace.trailing
            )
          }

          /**
           * Joins replacement to the current output with appropriate number of new lines
           * @private
           * @param {String} output The current conversion output
           * @param {String} replacement The string to append to the output
           * @returns Joined output
           * @type String
           */

          function join (output, replacement) {
            var s1 = trimTrailingNewlines(output);
            var s2 = trimLeadingNewlines(replacement);
            var nls = Math.max(output.length - s1.length, replacement.length - s2.length);
            var separator = '\n\n'.substring(0, nls);

            return s1 + separator + s2
          }

          /**
           * Determines whether an input can be converted
           * @private
           * @param {String|HTMLElement} input Describe this parameter
           * @returns Describe what it returns
           * @type String|Object|Array|Boolean|Number
           */

          function canConvert (input) {
            return (
              input != null && (
                typeof input === 'string' ||
                (input.nodeType && (
                  input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11
                ))
              )
            )
          }

          return TurndownService;

        }());
    </script>

    <script>
        const REPORT_TITLE = {{ data.meta.title | default('æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š') | tojson }}

        function saveAsMarkdown() {
            if (typeof TurndownService !== 'function') {
                alert('âŒ Markdown è½¬æ¢å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚');
                return;
            }

            const reportEl = document.querySelector('.report');
            if (!reportEl) {
                alert('âŒ æœªæ‰¾åˆ° .report å…ƒç´ ');
                return;
            }

            // å…‹éš†å¹¶æ¸…ç†
            const clone = reportEl.cloneNode(true);
            clone.querySelectorAll('script, style, .no-export').forEach(el => el.remove());

            // è½¬æ¢
            const turndownService = new TurndownService({
                headingStyle: 'atx',
                bulletListMarker: '-',
                codeBlockStyle: 'fenced'
            });
            let markdown = turndownService.turndown(clone.innerHTML);

            // æ¸…ç†å¤šä½™ç©ºè¡Œ
            markdown = markdown.replace(/\n{3,}/g, '\n\n').trim();

            // ç”Ÿæˆå®‰å…¨æ–‡ä»¶å
            const safeName = REPORT_TITLE
                .replace(/[<>:"/\\|?*\x00-\x1F]/g, '_')
                .replace(/\s+/g, '_')
                .substring(0, 60) || 'report';

            // ä¸‹è½½
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${safeName}.md`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copyReportText() {
            const el = document.querySelector('.report');
            if (!el) {
                alert('âŒ æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚');
                return;
            }
            const text = el.innerText;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶ï¼ˆä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼‰ï¼');
            } catch (err) {
                alert('âŒ è¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æœ¬ã€‚');
            }
            document.body.removeChild(textarea);
        }

        function generatePDF() {
            window.print(); // è§¦å‘æ‰“å°ï¼Œç”¨æˆ·å¯é€‰æ‹©â€œå¦å­˜ä¸ºPDFâ€
        }
    </script>
</body>
</html>