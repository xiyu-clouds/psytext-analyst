<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ¯æ„ŸçŸ¥åŸºåº•åˆ†ææŠ¥å‘Š</title>
    <style>
        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .subsection {
            margin-top: 15px;
            padding: 10px;
            background: #ffffff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        h2 {
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        h3 {
            color: #495057;
            margin-top: 20px;
        }
        ul, ol {
            padding-left: 20px;
            margin: 8px 0;
        }
        li {
            margin-bottom: 4px;
        }
        .field-label {
            font-weight: bold;
            color: #495057;
        }
        .empty-section {
            color: #6c757d;
            font-style: italic;
        }

        /* Share buttons */
        .share-options {
            margin: 30px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
        }
        .share-btn {
            margin: 5px 8px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .share-btn:hover {
            background: #0056b3;
        }
        .details-block {
            margin-top: 12px;
            border-left: 2px solid #e0e0e0;
            padding-left: 12px;
        }
        .details-block summary {
            cursor: pointer;
            color: #1a73e8;
            font-weight: 500;
        }
        .details-content {
            margin-top: 8px;
            padding: 8px 0;
            border-top: 1px dashed #ddd;
        }
        code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .suggestion-section {
          background-color: #f8f9fa;
          border-left: 4px solid #0d6efd;
          padding: 16px;
          margin: 24px 0;
        }
        .suggestion-content {
          white-space: pre-wrap;
          line-height: 1.6;
        }
        .suggestion-error {
          color: #dc3545;
          font-style: italic;
        }
        /* æ‰“å°æ—¶éšè—åˆ†äº«æ“ä½œæŒ‰é’® */
        @media print {
          #btn-export-md,
          #btn-generate-pdf,
          #btn-copy-text,
          .share-options > h3 {
            display: none !important;
          }
          #scroll-controls {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
          }
        }

        .semantic-signature-line {
            word-break: break-all;
            overflow-wrap: break-word;
            white-space: normal;
        }
        .semantic-value {
            display: inline-block;
            max-width: calc(100% - 120px);
            vertical-align: top;
        }
    </style>
</head>
<body>
    <!-- æŠ¥å‘Šå†…å®¹ -->
    <div class="report">
        {% if data%}
        <h2>{{ data.meta.title or 'å…¨æ¯æ„ŸçŸ¥åŸºåº•åˆ†ææŠ¥å‘Š' }}</h2>
        {% endif %}

        <!-- åˆ†æå…ƒä¿¡æ¯ -->
        {% if data%}
        <div class="section">
          <h3>åˆ†æå…ƒä¿¡æ¯</h3>
          <div class="subsection">
            <!-- åŸºç¡€æ ‡è¯† -->
            <p><span class="field-label">æŠ¥å‘ŠIDï¼š</span>{{ data.id or 'æœªçŸ¥' }}</p>
            {% if data.formatter_time %}
              <p><span class="field-label">ç”Ÿæˆæ—¶é—´ï¼š</span>{{ data.formatter_time | default('æœªçŸ¥') }}</p>
            {% endif %}
            <p><span class="field-label">æŠ¥å‘Šç±»å‹ï¼š</span>{{ data.type or 'æœªæŒ‡å®š' }}</p>

            <!-- åŸå§‹å†…å®¹ï¼ˆå»ºè®®ç”¨ <pre> æˆ–é™åˆ¶é«˜åº¦ï¼‰ -->
            {% if data.source and data.source.content %}
              <p><span class="field-label">åŸå§‹æ–‡æœ¬ï¼š</span></p>
              <div style="background:#f9f9f9; padding:8px; border-radius:4px; max-height:150px; overflow:auto; font-family:monospace; font-size:0.9em;">
                {{ data.source.content | e }}
              </div>
            {% endif %}

            <!-- AI ä¸æ¨¡å‹ä¿¡æ¯ -->
            <p><span class="field-label">AI ç”Ÿæˆï¼š</span>{{ 'æ˜¯' if data.meta.created_by_ai else 'å¦' }}</p>
            <p><span class="field-label">æ¨¡å‹ç‰ˆæœ¬ï¼š</span>{{ data.meta.llm_model or 'æœªçŸ¥' }}</p>
            <p><span class="field-label">åº“ç‰ˆæœ¬ï¼š</span>{{ data.meta.library_version or 'æœªçŸ¥' }}</p>
<!--            <p><span class="field-label">å™äº‹å¢å¼ºï¼š</span>{{ 'å·²å¯ç”¨' if data.meta.narrative_enriched else 'æœªå¯ç”¨' }}</p>-->

            <!-- åç»­æ³¨å…¥å­—æ®µ -->
            {% if data.meta.validity_level %}
              <p><span class="field-label">æœ‰æ•ˆæ€§ç­‰çº§ï¼š</span>{{ data.meta.validity_level }}</p>
            {% endif %}
            {% if data.meta.privacy_scope and data.meta.privacy_scope.privacy_level is defined %}
              <p><span class="field-label">éšç§ç­‰çº§ï¼š</span>{{ "%.2f"|format(data.meta.privacy_scope.privacy_level) }}</p>
            {% endif %}
            {% if data.meta.global_semantic_signature %}
              <p class="semantic-signature-line">
                <span class="field-label">å…¨å±€è¯­ä¹‰æ ‡è¯†ï¼š</span>
                <span class="semantic-value">{{ data.meta.global_semantic_signature }}</span>
              </p>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- 1. æºæ•°æ®æå–ï¼ˆå‚ä¸è€…ï¼‰ -->
        {% if data.get('participants') %}
        <div class="section">
            <h3>1. å‚ä¸è€…</h3>
            <details class="details-block">
                <summary>ğŸ” å±•å¼€å‚ä¸è€…è§£æè¯¦æƒ…</summary>
                <div class="subsection" style="margin-top: 16px;">
                    {% for p in data.participants %}
                    <div style="margin-bottom: 24px; padding: 12px; border-left: 2px solid #4a90e2; background: #f9fbfd;">
                        <!-- æ ¸å¿ƒæ ‡è¯† -->
                        <p><span class="field-label">åŸå§‹æŒ‡ç§°ï¼š</span><code>{{ p.entity }}</code></p>

                        <!-- èº«ä»½ä¸ç¤¾ä¼šå±æ€§ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_identity = [
                            p.get('occupation'),
                            p.get('social_role'),
                            p.get('family_status'),
                            p.get('institutional_affiliation'),
                            p.get('education_level'),
                            p.get('primary_language'),
                            p.get('cultural_identity')
                        ] | select | list %}
                        {% if has_identity %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ§¾ èº«ä»½ä¸ç¤¾ä¼šå±æ€§</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('occupation') %}<p><span class="field-label">èŒä¸šèº«ä»½ï¼š</span>{{ p.occupation }}</p>{% endif %}
                                {% if p.get('social_role') %}<p><span class="field-label">ç¤¾ä¼šèº«ä»½æ ‡ç­¾ï¼š</span>{{ p.social_role }}</p>{% endif %}
                                {% if p.get('family_status') %}<p><span class="field-label">å®¶åº­çŠ¶æ€ï¼š</span>{{ p.family_status }}</p>{% endif %}
                                {% if p.get('institutional_affiliation') %}<p><span class="field-label">æ‰€å±æœºæ„ï¼š</span>{{ p.institutional_affiliation }}</p>{% endif %}
                                {% if p.get('education_level') %}<p><span class="field-label">æ•™è‚²ç¨‹åº¦ï¼š</span>{{ p.education_level }}</p>{% endif %}
                                {% if p.get('primary_language') %}<p><span class="field-label">ä¸»è¦ä½¿ç”¨è¯­è¨€ï¼š</span>{{ p.primary_language }}</p>{% endif %}
                                {% if p.get('cultural_identity') %}<p><span class="field-label">æ–‡åŒ–/æ°‘æ—èº«ä»½æ ‡ç­¾ï¼š</span>{{ p.cultural_identity }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- ç”Ÿç‰©ä¸ç”Ÿç†ç‰¹å¾ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_bio = [
                            p.get('gender'),
                            p.get('age_range'),
                            p.get('ethnicity_or_origin'),
                            p.get('physical_traits')
                        ] | select | list %}
                        {% if has_bio %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ§¬ ç”Ÿç‰©ä¸ç”Ÿç†ç‰¹å¾</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('gender') %}<p><span class="field-label">æ€§åˆ«æ ‡è¯†ï¼š</span>{{ p.gender }}</p>{% endif %}
                                {% if p.get('age_range') %}<p><span class="field-label">å¹´é¾„é˜¶æ®µï¼š</span>{{ p.age_range }}</p>{% endif %}
                                {% if p.get('ethnicity_or_origin') %}<p><span class="field-label">æ—ç¾¤/å›½ç±/åœ°åŸŸå‡ºèº«ï¼š</span>{{ p.ethnicity_or_origin }}</p>{% endif %}
                                {% if p.get('physical_traits') %}<p><span class="field-label">å›ºæœ‰ç”Ÿç†ç‰¹å¾ï¼š</span>{{ p.physical_traits | join(', ') }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- å½“å‰å¤–æ˜¾çŠ¶æ€ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_state = [
                            p.get('appearance'),
                            p.get('current_action_state'),
                            p.get('visible_injury_or_wound'),
                            p.get('possessions'),
                            p.get('inherent_odor'),
                            p.get('voice_quality'),
                            p.get('speech_pattern')
                        ] | select | list %}
                        {% if has_state %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ‘ï¸ å½“å‰å¤–æ˜¾çŠ¶æ€</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('appearance') %}<p><span class="field-label">å¤–è²Œä¸è¡£ç€ç‰¹å¾ï¼š</span>{{ p.appearance | join(', ') }}</p>{% endif %}
                                {% if p.get('current_action_state') %}<p><span class="field-label">å½“å‰çŠ¶æ€ï¼š</span>{{ p.current_action_state }}</p>{% endif %}
                                {% if p.get('visible_injury_or_wound') %}<p><span class="field-label">å¯è§ä¼¤ç—•æˆ–åŒ…æ‰ï¼š</span>{{ p.visible_injury_or_wound }}</p>{% endif %}
                                {% if p.get('possessions') %}<p><span class="field-label">æŒæœ‰æˆ–ä½©æˆ´ç‰©å“ï¼š</span>{{ p.possessions | join(', ') }}</p>{% endif %}
                                {% if p.get('inherent_odor') %}<p><span class="field-label">ä½“å‘³æˆ–æ°”æ¯ï¼š</span>{{ p.inherent_odor }}</p>{% endif %}
                                {% if p.get('voice_quality') %}<p><span class="field-label">å—“éŸ³ç‰¹è´¨ï¼š</span>{{ p.voice_quality }}</p>{% endif %}
                                {% if p.get('speech_pattern') %}<p><span class="field-label">è¯´è¯æ–¹å¼ï¼š</span>{{ p.speech_pattern }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- äº‹ä»¶ä¸­çš„åŠŸèƒ½è§’è‰²ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰ -->
                        {% if p.get('interaction_role') %}
                        <p style="margin-top: 12px; padding: 8px; background-color: #fff8e1; border-radius: 4px;">
                            <span class="field-label">ğŸ“Œ äº‹ä»¶åŠŸèƒ½è§’è‰²ï¼š</span>{{ p.interaction_role }}
                        </p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </details>
        </div>
        {% endif %}

        <!-- 2. æ—¶é—´æ„ŸçŸ¥ -->
        {% if data.get('temporal') %}
        <div class="section">
            <h3>2. æ—¶é—´</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.temporal.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.temporal.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ—¶é—´è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.temporal.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€äº‹ä»¶è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªæ—¶é—´åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.temporal.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æ—¶é—´äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.temporal.get('events') and data.temporal.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ—¶é—´äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.temporal.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.temporal.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒä¿¡æ¯ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('temporal_mentions_by_type') %}
                                {% set tm = ev.temporal_mentions_by_type %}
                                {% if tm.absolute %}<p><span class="field-label">å…·ä½“æ—¶é—´ç‚¹æˆ–æ—¶é•¿ï¼š</span>{{ tm.absolute | join(', ') }}</p>{% endif %}
                                {% if tm.range %}<p><span class="field-label">æ—¶é—´åŒºé—´ï¼š</span>{{ tm.range | join('; ') }}</p>{% endif %}
                                {% if tm.duration %}<p><span class="field-label">æŒç»­æ—¶é—´è¡¨è¾¾ï¼š</span>{{ tm.duration | join(', ') }}</p>{% endif %}
                                {% if tm.frequency %}<p><span class="field-label">é¢‘ç‡æˆ–å‘¨æœŸæ€§è¡¨è¾¾ï¼š</span>{{ tm.frequency | join(', ') }}</p>{% endif %}
                                {% if tm.cultural %}<p><span class="field-label">æ–‡åŒ–æˆ–åˆ¶åº¦æ€§æ—¶é—´ï¼š</span>{{ tm.cultural | join(', ') }}</p>{% endif %}
                                {% if tm.relative %}<p><span class="field-label">ç›¸å¯¹æ—¶é—´è¡¨è¾¾ï¼š</span>{{ tm.relative | join(', ') }}</p>{% endif %}
                                {% if tm.negated %}<p><span class="field-label">è¢«å¦å®šçš„æ—¶é—´è¡¨è¾¾ï¼š</span>{{ tm.negated | join(', ') }}</p>{% endif %}
                                {% if tm.uncertain %}<p><span class="field-label">ä¸ç¡®å®šçš„æ—¶é—´è¡¨è¾¾ï¼š</span>{{ tm.uncertain | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- è¯­è¨€ä¸ä¸Šä¸‹æ–‡çº¿ç´¢ -->
                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 3. ç©ºé—´æ„ŸçŸ¥ -->
        {% if data.get('spatial') %}
        <div class="section">
            <h3>3. ç©ºé—´</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.spatial.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.spatial.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç©ºé—´è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸å…³ç³»ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.spatial.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€ç©ºé—´è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªç©ºé—´åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.spatial.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- ç©ºé—´äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.spatial.get('events') and data.spatial.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ç©ºé—´äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.spatial.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.spatial.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒæ ‡è¯† -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            <!-- === åŸºäº spatial_mentions æŒ‰ type åˆ†ç±»å±•ç¤º === -->
                            {% if ev.get('spatial_mentions_by_type') %}
                                {% set sm = ev.spatial_mentions_by_type %}
                                {% if sm.location %}<p><span class="field-label">å…·ä½“åœ°ç‚¹åç§°ï¼š</span>{{ sm.location | join(', ') }}</p>{% endif %}
                                {% if sm.relative %}<p><span class="field-label">ç›¸å¯¹æ–¹ä½è¯ï¼š</span>{{ sm.relative | join(', ') }}</p>{% endif %}
                                {% if sm.direction %}<p><span class="field-label">ç»å¯¹æ–¹å‘è¯ï¼š</span>{{ sm.direction | join(', ') }}</p>{% endif %}
                                {% if sm.topological %}<p><span class="field-label">ç©ºé—´ä½ç½®å…³ç³»ï¼š</span>{{ sm.topological | join(', ') }}</p>{% endif %}
                                {% if sm.toward %}<p><span class="field-label">æœå‘æ ‡è®°è¯ï¼š</span>{{ sm.toward | join(', ') }}</p>{% endif %}
                                {% if sm.cultural %}<p><span class="field-label">åˆ¶åº¦/åŠŸèƒ½ç©ºé—´ï¼š</span>{{ sm.cultural | join(', ') }}</p>{% endif %}
                                {% if sm.negated %}<p><span class="field-label">è¢«å¦å®šçš„ç©ºé—´æè¿°ï¼š</span>{{ sm.negated | join(', ') }}</p>{% endif %}
                                {% if sm.measure %}<p><span class="field-label">é‡åŒ–ç©ºé—´æ•°æ®ï¼š</span>{{ sm.measure | join(', ') }}</p>{% endif %}
                                {% if sm.layout %}<p><span class="field-label">ç©ºé—´å¸ƒå±€ç»“æ„ï¼š</span>{{ sm.layout | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- å…±ç°åŠ¨è¯æˆ–åè¯ -->
                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ® -->
                            {% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 4. è§†è§‰æ„ŸçŸ¥ -->
        {% if data.get('visual') %}
        <div class="section">
            <h3>4. è§†è§‰</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.visual.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.visual.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è§†è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.visual.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€è§†è§‰è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªè§†è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.visual.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è§†è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.visual.get('events') and data.visual.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§†è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.visual.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.visual.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('visual_mentions_by_type') %}
                                {% set vm = ev.visual_mentions_by_type %}
                                {% if vm.color %}<p><span class="field-label">é¢œè‰²ï¼š</span>{{ vm.color | join(', ') }}</p>{% endif %}
                                {% if vm.brightness %}<p><span class="field-label">æ˜æš—å±æ€§ï¼š</span>{{ vm.brightness | join(', ') }}</p>{% endif %}
                                {% if vm.expression %}<p><span class="field-label">é¢éƒ¨è¡¨æƒ…ï¼š</span>{{ vm.expression | join(', ') }}</p>{% endif %}
                                {% if vm.posture %}<p><span class="field-label">èº«ä½“å§¿æ€ï¼š</span>{{ vm.posture | join(', ') }}</p>{% endif %}
                                {% if vm.object %}<p><span class="field-label">æ— ç”Ÿå‘½ç‰©ä½“ï¼š</span>{{ vm.object | join(', ') }}</p>{% endif %}
                                {% if vm.entity %}<p><span class="field-label">äººæˆ–åŠ¨ç‰©ä¸»ä½“ï¼š</span>{{ vm.entity | join(', ') }}</p>{% endif %}
                                {% if vm.optical %}<p><span class="field-label">æˆåƒçŠ¶æ€ï¼š</span>{{ vm.optical | join(', ') }}</p>{% endif %}
                                {% if vm.negated %}<p><span class="field-label">è¢«å¦å®šçš„è§†è§‰å†…å®¹ï¼š</span>{{ vm.negated | join(', ') }}</p>{% endif %}
                                {% if vm.gaze %}<p><span class="field-label">æ³¨è§†ç›®æ ‡ï¼š</span>{{ vm.gaze | join(', ') }}</p>{% endif %}
                                {% if vm.contact %}<p><span class="field-label">ç›®å…‰äº¤äº’ï¼š</span>{{ vm.contact | join(', ') }}</p>{% endif %}
                                {% if vm.medium %}<p><span class="field-label">è§‚å¯Ÿåª’ä»‹ï¼š</span>{{ vm.medium | join(', ') }}</p>{% endif %}
                                {% if vm.occlusion %}<p><span class="field-label">è§†çº¿é®æŒ¡ï¼š</span>{{ vm.occlusion | join(', ') }}</p>{% endif %}
                                {% if vm.lighting %}<p><span class="field-label">ç¯å¢ƒå…‰ç…§ï¼š</span>{{ vm.lighting | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ® -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 5. å¬è§‰æ„ŸçŸ¥ -->
        {% if data.get('auditory') %}
        <div class="section">
            <h3>5. å¬è§‰</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.auditory.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.auditory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å¬è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.auditory.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€å¬è§‰è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå¬è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.auditory.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å¬è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.auditory.get('events') and data.auditory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å¬è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.auditory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.auditory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆä»… schema å®šä¹‰çš„ï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('auditory_mentions_by_type') %}
                                {% set am = ev.auditory_mentions_by_type %}
                                {% if am.verb %}<p><span class="field-label">å¬è§‰åŠ¨è¯ï¼š</span>{{ am.verb | join(', ') }}</p>{% endif %}
                                {% if am.speech %}<p><span class="field-label">è¨€è¯­å†…å®¹ï¼š</span>{{ am.speech | join(', ') }}</p>{% endif %}
                                {% if am.sound %}<p><span class="field-label">éè¨€è¯­å£°éŸ³ï¼š</span>{{ am.sound | join(', ') }}</p>{% endif %}
                                {% if am.intensity %}<p><span class="field-label">å£°éŸ³å¼ºåº¦ï¼š</span>{{ am.intensity | join(', ') }}</p>{% endif %}
                                {% if am.prosody %}<p><span class="field-label">å£°éŸ³èŠ‚å¥ç‰¹å¾ï¼š</span>{{ am.prosody | join(', ') }}</p>{% endif %}
                                {% if am.medium %}<p><span class="field-label">å£°éŸ³ä¼ æ’­åª’ä»‹ï¼š</span>{{ am.medium | join(', ') }}</p>{% endif %}
                                {% if am.background %}<p><span class="field-label">ç¯å¢ƒèƒŒæ™¯å£°ï¼š</span>{{ am.background | join(', ') }}</p>{% endif %}
                                {% if am.source %}<p><span class="field-label">å£°æºä¸»ä½“æˆ–ç‰©ä½“ï¼š</span>{{ am.source | join(', ') }}</p>{% endif %}
                                {% if am.negated %}<p><span class="field-label">è¢«å¦å®šçš„å¬è§‰å†…å®¹ï¼š</span>{{ am.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 6. å—…è§‰æ„ŸçŸ¥ -->
        {% if data.get('olfactory') %}
        <div class="section">
            <h3>6. å—…è§‰</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.olfactory.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.olfactory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å—…è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.olfactory.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€å—…è§‰è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå—…è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.olfactory.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å—…è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.olfactory.get('events') and data.olfactory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å—…è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.olfactory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.olfactory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('olfactory_mentions_by_type') %}
                                {% set om = ev.olfactory_mentions_by_type %}
                                {% if om.odor %}<p><span class="field-label">å…·ä½“æ°”å‘³æè¿°ï¼š</span>{{ om.odor | join(', ') }}</p>{% endif %}
                                {% if om.source %}<p><span class="field-label">æ°”å‘³å…·ä½“æ¥æºï¼š</span>{{ om.source | join(', ') }}</p>{% endif %}
                                {% if om.intensity %}<p><span class="field-label">æ°”å‘³å¼ºåº¦ï¼š</span>{{ om.intensity | join(', ') }}</p>{% endif %}
                                {% if om.valence %}<p><span class="field-label">æ°”å‘³æ„Ÿå®˜è¯„ä»·ï¼š</span>{{ om.valence | join(', ') }}</p>{% endif %}
                                {% if om.negated %}<p><span class="field-label">è¢«å¦å®šçš„å—…è§‰å†…å®¹ï¼š</span>{{ om.negated | join(', ') }}</p>{% endif %}
                                {% if om.action %}<p><span class="field-label">å—…è§‰ç›¸å…³åŠ¨ä½œï¼š</span>{{ om.action | join(', ') }}</p>{% endif %}
                                {% if om.category %}<p><span class="field-label">æ°”å‘³æ¥æºç±»åˆ«ï¼š</span>{{ om.category | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 7. è§¦è§‰æ„ŸçŸ¥ -->
        {% if data.get('tactile') %}
        <div class="section">
            <h3>7. è§¦è§‰ä¿¡æ¯</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.tactile.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.tactile.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è§¦è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.tactile.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€è§¦è§‰è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªè§¦è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.tactile.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è§¦è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.tactile.get('events') and data.tactile.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§¦è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.tactile.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.tactile.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå­—æ®µï¼ˆä»… schema å®šä¹‰çš„ï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            <!-- === åŸºäº tactile_mentions æŒ‰ 15 ç±» type åˆ†ç»„å±•ç¤º === -->
                            {% if ev.get('tactile_mentions_by_type') %}
                                {% set tm = ev.tactile_mentions_by_type %}
                                {% if tm.pain %}<p><span class="field-label">ä½“è¡¨ç–¼ç—›ï¼š</span>{{ tm.pain | join(', ') }}</p>{% endif %}
                                {% if tm.target %}<p><span class="field-label">æ¥è§¦å¯¹è±¡ï¼š</span>{{ tm.target | join(', ') }}</p>{% endif %}
                                {% if tm.body %}<p><span class="field-label">èº«ä½“éƒ¨ä½ï¼š</span>{{ tm.body | join(', ') }}</p>{% endif %}
                                {% if tm.descriptor %}<p><span class="field-label">ä½“è¡¨è§¦è§‰å½¢å®¹è¯ï¼š</span>{{ tm.descriptor | join(', ') }}</p>{% endif %}
                                {% if tm.intensity %}<p><span class="field-label">å¼ºåº¦ä¿®é¥°ï¼š</span>{{ tm.intensity | join(', ') }}</p>{% endif %}
                                {% if tm.texture %}<p><span class="field-label">è´¨åœ°æè¿°ï¼š</span>{{ tm.texture | join(', ') }}</p>{% endif %}
                                {% if tm.temperature %}<p><span class="field-label">ä½“è¡¨æˆ–ç‰©ä½“æ¸©åº¦ï¼š</span>{{ tm.temperature | join(', ') }}</p>{% endif %}
                                {% if tm.motion %}<p><span class="field-label">æ¥è§¦ä¸­çš„å¾®åŠ¨ï¼š</span>{{ tm.motion | join(', ') }}</p>{% endif %}
                                {% if tm.vibration %}<p><span class="field-label">éœ‡åŠ¨æ„Ÿï¼š</span>{{ tm.vibration | join(', ') }}</p>{% endif %}
                                {% if tm.moisture %}<p><span class="field-label">çš®è‚¤æˆ–ç‰©ä½“æ¹¿åº¦ï¼š</span>{{ tm.moisture | join(', ') }}</p>{% endif %}
                                {% if tm.mode %}<p><span class="field-label">æ¥è§¦æ–¹å¼ï¼š</span>{{ tm.mode | join(', ') }}</p>{% endif %}
                                {% if tm.negated %}<p><span class="field-label">è¢«å¦å®šçš„è§¦è§‰å†…å®¹ï¼š</span>{{ tm.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 8. å‘³è§‰æ„ŸçŸ¥ -->
        {% if data.get('gustatory') %}
        <div class="section">
            <h3>8. å‘³è§‰</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.gustatory.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.gustatory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å‘³è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.gustatory.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€å‘³è§‰è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå‘³è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.gustatory.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å‘³è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.gustatory.get('events') and data.gustatory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å‘³è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.gustatory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.gustatory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            <!-- === åŸºäº gustatory_mentions æŒ‰ 9 ç±» type åˆ†ç»„å±•ç¤º === -->
                            {% if ev.get('gustatory_mentions_by_type') %}
                                {% set gm = ev.gustatory_mentions_by_type %}
                                {% if gm.source %}<p><span class="field-label">å“å°å¯¹è±¡ï¼š</span>{{ gm.source | join(', ') }}</p>{% endif %}
                                {% if gm.basic %}<p><span class="field-label">åŸºæœ¬å‘³è§‰ï¼š</span>{{ gm.basic | join(', ') }}</p>{% endif %}
                                {% if gm.complex %}<p><span class="field-label">å¤åˆå£æ„Ÿï¼š</span>{{ gm.complex | join(', ') }}</p>{% endif %}
                                {% if gm.thermal %}<p><span class="field-label">æ¸©åº¦æ„Ÿå—ï¼š</span>{{ gm.thermal | join(', ') }}</p>{% endif %}
                                {% if gm.evaluation %}<p><span class="field-label">å‘³é“æ„Ÿå®˜è¯„ä»·ï¼š</span>{{ gm.evaluation | join(', ') }}</p>{% endif %}
                                {% if gm.intensity %}<p><span class="field-label">å‘³é“å¼ºåº¦æè¿°ï¼š</span>{{ gm.intensity | join(', ') }}</p>{% endif %}
                                {% if gm.body %}<p><span class="field-label">å‘³è§‰æ„ŸçŸ¥éƒ¨ä½ï¼š</span>{{ gm.body | join(', ') }}</p>{% endif %}
                                {% if gm.negated %}<p><span class="field-label">è¢«å¦å®šçš„å‘³è§‰å†…å®¹ï¼š</span>{{ gm.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 9. å†…æ„Ÿå— -->
        {% if data.get('interoceptive') %}
        <div class="section">
            <h3>9. å†…æ„Ÿå—</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.interoceptive.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.interoceptive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å†…æ„Ÿå—è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.interoceptive.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€å†…æ„Ÿå—è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“å†…æ„Ÿå—åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.interoceptive.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å†…æ„Ÿå—äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.interoceptive.get('events') and data.interoceptive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å†…æ„Ÿå—äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.interoceptive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.interoceptive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('interoceptive_mentions_by_type') %}
                                {% set im = ev.interoceptive_mentions_by_type %}
                                {% if im.body %}<p><span class="field-label">èº«ä½“å†…éƒ¨éƒ¨ä½ï¼š</span>{{ im.body | join(', ') }}</p>{% endif %}
                                {% if im.cardiac %}<p><span class="field-label">å¿ƒè·³æˆ–å¿ƒåŒºä¸é€‚ï¼š</span>{{ im.cardiac | join(', ') }}</p>{% endif %}
                                {% if im.respiratory %}<p><span class="field-label">å‘¼å¸å¼‚å¸¸ï¼š</span>{{ im.respiratory | join(', ') }}</p>{% endif %}
                                {% if im.gastrointestinal %}<p><span class="field-label">èƒƒè‚ ä¸é€‚ï¼š</span>{{ im.gastrointestinal | join(', ') }}</p>{% endif %}
                                {% if im.thermal %}<p><span class="field-label">ä½“æ¸©å¼‚å¸¸ï¼š</span>{{ im.thermal | join(', ') }}</p>{% endif %}
                                {% if im.muscular %}<p><span class="field-label">è‚Œè‚‰å¼‚å¸¸ï¼š</span>{{ im.muscular | join(', ') }}</p>{% endif %}
                                {% if im.visceral %}<p><span class="field-label">å†…è„å‹è¿«æˆ–æ²‰é‡æ„Ÿï¼š</span>{{ im.visceral | join(', ') }}</p>{% endif %}
                                {% if im.dizziness %}<p><span class="field-label">å¤´æ™•æˆ–å¤±è¡¡ï¼š</span>{{ im.dizziness | join(', ') }}</p>{% endif %}
                                {% if im.nausea %}<p><span class="field-label">æ¶å¿ƒæˆ–æƒ³åï¼š</span>{{ im.nausea | join(', ') }}</p>{% endif %}
                                {% if im.fatigue %}<p><span class="field-label">å…¨èº«ç–²ä¹æ„Ÿï¼š</span>{{ im.fatigue | join(', ') }}</p>{% endif %}
                                {% if im.thirst_hunger %}<p><span class="field-label">å£æ¸´æˆ–é¥¥é¥¿æ„Ÿï¼š</span>{{ im.thirst_hunger | join(', ') }}</p>{% endif %}
                                {% if im.intensity %}<p><span class="field-label">æ„Ÿå—å¼ºåº¦ä¿®é¥°ï¼š</span>{{ im.intensity | join(', ') }}</p>{% endif %}
                                {% if im.initiator %}<p><span class="field-label">å†…æ„Ÿå—è§¦å‘æƒ…å¢ƒï¼š</span>{{ im.initiator | join(', ') }}</p>{% endif %}
                                {% if im.negated %}<p><span class="field-label">è¢«å¦å®šçš„å†…æ„Ÿå—ï¼š</span>{{ im.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 10. è®¤çŸ¥è¿‡ç¨‹ -->
        {% if data.get('cognitive') %}
        <div class="section">
            <h3>10. è®¤çŸ¥è¿‡ç¨‹</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.cognitive.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.cognitive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è®¤çŸ¥è¿‡ç¨‹è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.cognitive.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€è®¤çŸ¥è¿‡ç¨‹è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“è®¤çŸ¥åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.cognitive.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è®¤çŸ¥äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.cognitive.get('events') and data.cognitive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è®¤çŸ¥è¿‡ç¨‹äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.cognitive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.cognitive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            <!-- === åŸºäº cognitive_mentions æŒ‰ 16 ç±» type åˆ†ç»„å±•ç¤º === -->
                            {% if ev.get('cognitive_mentions_by_type') %}
                                {% set cm = ev.cognitive_mentions_by_type %}
                                {% if cm.belief %}<p><span class="field-label">ä¿¡å¿µï¼š</span>{{ cm.belief | join(', ') }}</p>{% endif %}
                                {% if cm.intention %}<p><span class="field-label">æ„å›¾ï¼š</span>{{ cm.intention | join(', ') }}</p>{% endif %}
                                {% if cm.inference %}<p><span class="field-label">æ¨ç†ï¼š</span>{{ cm.inference | join(', ') }}</p>{% endif %}
                                {% if cm.memory %}<p><span class="field-label">è®°å¿†ï¼š</span>{{ cm.memory | join(', ') }}</p>{% endif %}
                                {% if cm.doubt %}<p><span class="field-label">æ€€ç–‘ï¼š</span>{{ cm.doubt | join(', ') }}</p>{% endif %}
                                {% if cm.evaluation %}<p><span class="field-label">è¯„ä»·ï¼š</span>{{ cm.evaluation | join(', ') }}</p>{% endif %}
                                {% if cm.solving %}<p><span class="field-label">é—®é¢˜è§£å†³ï¼š</span>{{ cm.solving | join(', ') }}</p>{% endif %}
                                {% if cm.meta %}<p><span class="field-label">å…ƒè®¤çŸ¥ï¼š</span>{{ cm.meta | join(', ') }}</p>{% endif %}
                                {% if cm.certainty %}<p><span class="field-label">ç¡®ä¿¡ç¨‹åº¦ï¼š</span>{{ cm.certainty | join(', ') }}</p>{% endif %}
                                {% if cm.negated %}<p><span class="field-label">è¢«å¦å®šçš„è®¤çŸ¥ï¼š</span>{{ cm.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 11. èº¯ä½“åŒ–è¡¨ç° -->
        {% if data.get('bodily') %}
        <div class="section">
            <h3>11. èº¯ä½“åŒ–è¡¨ç°</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.bodily.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.bodily.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€èº¯ä½“åŒ–è¡¨ç°è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.bodily.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€èº¯ä½“åŒ–è¡¨ç°è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“èº¯ä½“åŒ–åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.bodily.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- èº¯ä½“åŒ–äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.bodily.get('events') and data.bodily.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">èº¯ä½“åŒ–è¡¨ç°äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.bodily.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.bodily.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}

                            {% if ev.get('bodily_mentions_by_type') %}
                                {% set bm = ev.bodily_mentions_by_type %}
                                {% if bm.movement %}<p><span class="field-label">èº«ä½“ä½ç§»ï¼š</span>{{ bm.movement | join(', ') }}</p>{% endif %}
                                {% if bm.posture %}<p><span class="field-label">èº«ä½“å§¿æ€ï¼š</span>{{ bm.posture | join(', ') }}</p>{% endif %}
                                {% if bm.facial %}<p><span class="field-label">é¢éƒ¨è¡¨æƒ…ä¸å˜åŒ–ï¼š</span>{{ bm.facial | join(', ') }}</p>{% endif %}
                                {% if bm.vocal %}<p><span class="field-label">å‘å£°å¼‚å¸¸ç‰¹å¾ï¼š</span>{{ bm.vocal | join(', ') }}</p>{% endif %}
                                {% if bm.autonomic %}<p><span class="field-label">ç”Ÿç†åº”æ¿€ååº”ï¼š</span>{{ bm.autonomic | join(', ') }}</p>{% endif %}
                                {% if bm.freeze %}<p><span class="field-label">è¡Œä¸ºå†»ç»“ï¼š</span>{{ bm.freeze | join(', ') }}</p>{% endif %}
                                {% if bm.faint %}<p><span class="field-label">æ™•å¥å‰å…†è¡¨ç°ï¼š</span>{{ bm.faint | join(', ') }}</p>{% endif %}
                                {% if bm.action %}<p><span class="field-label">ç²¾ç»†åŠ¨ä½œï¼š</span>{{ bm.action | join(', ') }}</p>{% endif %}
                                {% if bm.intensity %}<p><span class="field-label">è¡Œä¸ºå¼ºåº¦ä¿®é¥°ï¼š</span>{{ bm.intensity | join(', ') }}</p>{% endif %}
                                {% if bm.negated %}<p><span class="field-label">è¢«å¦å®šçš„è¡Œä¸ºï¼š</span>{{ bm.negated | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 12. æƒ…æ„ŸçŠ¶æ€ -->
        {% if data.get('emotional') %}
        <div class="section">
            <h3>12. æƒ…æ„ŸçŠ¶æ€</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.emotional.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.emotional.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æƒ…æ„Ÿè§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.emotional.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€æƒ…æ„ŸçŠ¶æ€è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“æƒ…æ„Ÿåˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.emotional.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æƒ…æ„Ÿäº‹ä»¶åˆ—è¡¨ -->
                        {% if data.emotional.get('events') and data.emotional.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æƒ…æ„Ÿäº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.emotional.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.emotional.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}

                            <!-- === åŸºäº emotional_mentions æŒ‰ type åˆ†ç»„å±•ç¤º === -->
                            {% if ev.get('emotional_mentions_by_type') %}
                                {% set em = ev.emotional_mentions_by_type %}
                                {% if em.emotion %}<p><span class="field-label">å…·ä½“æƒ…ç»ªè¯ï¼š</span>{{ em.emotion | join(', ') }}</p>{% endif %}
                                {% if em.valence %}<p><span class="field-label">æƒ…æ„Ÿæ•ˆä»·è¯ï¼š</span>{{ em.valence | join(', ') }}</p>{% endif %}
                                {% if em.arousal %}<p><span class="field-label">å”¤é†’åº¦çŠ¶æ€è¯ï¼š</span>{{ em.arousal | join(', ') }}</p>{% endif %}
                                {% if em.intensity %}<p><span class="field-label">æƒ…æ„Ÿå¼ºåº¦ä¿®é¥°ï¼š</span>{{ em.intensity | join(', ') }}</p>{% endif %}
                                {% if em.verb %}<p><span class="field-label">æƒ…ç»ªåŠ¨è¯ï¼š</span>{{ em.verb | join(', ') }}</p>{% endif %}
                                {% if em.adjective %}<p><span class="field-label">æƒ…ç»ªå½¢å®¹è¯ï¼š</span>{{ em.adjective | join(', ') }}</p>{% endif %}
                                {% if em.adverb %}<p><span class="field-label">æƒ…ç»ªå‰¯è¯ï¼š</span>{{ em.adverb | join(', ') }}</p>{% endif %}
                                {% if em.mixed %}<p><span class="field-label">ä¸­è‹±æ··æ‚æƒ…ç»ªè¡¨è¾¾ï¼š</span>{{ em.mixed | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ® -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 13. ç¤¾ä¼šå…³ç³» -->
        {% if data.get('social_relation') %}
        <div class="section">
            <h3>13. ç¤¾ä¼šå…³ç³»</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.social_relation.get('summary') %}
                <p><span class="field-label">æ‘˜è¦ï¼š</span>{{ data.social_relation.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç¤¾ä¼šå…³ç³»è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.social_relation.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€ç¤¾ä¼šå…³ç³»è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“å…³ç³»åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.social_relation.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- ç¤¾ä¼šå…³ç³»äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.social_relation.get('events') and data.social_relation.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ç¤¾ä¼šå…³ç³»äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.social_relation.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.social_relation.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">å‚ä¸ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}

                            <!-- === åŸºäº social_relation_mentions æŒ‰ 9 ç±» type åˆ†ç»„å±•ç¤º === -->
                            {% if ev.get('social_relation_mentions_by_type') %}
                                {% set sm = ev.social_relation_mentions_by_type %}
                                {% if sm.kinship %}<p><span class="field-label">äº²å±ç§°è°“ï¼š</span>{{ sm.kinship | join(', ') }}</p>{% endif %}
                                {% if sm.role %}<p><span class="field-label">ç¤¾ä¼šè§’è‰²ï¼š</span>{{ sm.role | join(', ') }}</p>{% endif %}
                                {% if sm.address %}<p><span class="field-label">ç›´æ¥ç§°å‘¼ï¼š</span>{{ sm.address | join(', ') }}</p>{% endif %}
                                {% if sm.possessive %}<p><span class="field-label">æ‰€å±å…³ç³»ï¼š</span>{{ sm.possessive | join(', ') }}</p>{% endif %}
                                {% if sm.relation_verb %}<p><span class="field-label">å…³ç³»åŠ¨è¯ï¼š</span>{{ sm.relation_verb | join(', ') }}</p>{% endif %}
                                {% if sm.compound %}<p><span class="field-label">å¤åˆå…³ç³»è¯ï¼š</span>{{ sm.compound | join(', ') }}</p>{% endif %}
                                {% if sm.duration %}<p><span class="field-label">å…³ç³»æŒç»­æ—¶é—´ï¼š</span>{{ sm.duration | join(', ') }}</p>{% endif %}
                                {% if sm.distance %}<p><span class="field-label">ç¤¾äº¤äº²ç–åº¦ï¼š</span>{{ sm.distance | join(', ') }}</p>{% endif %}
                            {% endif %}

                            {% if ev.get('event_markers') %}
                            <p><span class="field-label">æ ¸å¿ƒè¯æ±‡ï¼š</span>{{ ev.event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 14. ç­–ç•¥é”šå®š -->
        {% if data.get('strategy_anchor') %}
        <div class="section">
            <h3>14. ç­–ç•¥é”šå®š</h3>
            <div class="subsection">

                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.strategy_anchor.get('synthesis') %}
                <p><span class="field-label">ç­–ç•¥ç ”åˆ¤ï¼š</span>{{ data.strategy_anchor.synthesis }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç­–ç•¥é”šå®šè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.strategy_anchor.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€ç­–ç•¥è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“ç­–ç•¥åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.strategy_anchor.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- ç­–ç•¥äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.strategy_anchor.get('events') and data.strategy_anchor.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ç­–ç•¥é”šå®šäº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.strategy_anchor.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.strategy_anchor.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid #2980b9;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            {% if ev.get('agent') %}
                            <p><span class="field-label">è¡Œä¸ºä¸»ä½“ï¼š</span>{{ ev.agent }}</p>
                            {% endif %}

                            {% if ev.get('target') %}
                            <p><span class="field-label">ä½œç”¨å¯¹è±¡ï¼š</span>{{ ev.target }}</p>
                            {% endif %}

                            {% if ev.get('behavior') %}
                            <p><span class="field-label">ç­–ç•¥è¡Œä¸ºï¼š</span>{{ ev.behavior }}</p>
                            {% endif %}

                            {% if ev.get('implicit_goal') %}
                            <p><span class="field-label">éšæ€§ç›®æ ‡ï¼š</span>{{ ev.implicit_goal }}</p>
                            {% endif %}

                            {% if ev.get('explicit_justification') %}
                            <p><span class="field-label">è¡¨é¢ç†ç”±ï¼š</span>{{ ev.explicit_justification }}</p>
                            {% endif %}

                            {% if ev.get('social_script') %}
                            <p><span class="field-label">ç¤¾ä¼šè„šæœ¬ï¼š</span>{{ ev.social_script }}</p>
                            {% endif %}

                            {% if ev.get('power_differential') %}
                            <p><span class="field-label">æƒåŠ›å·®å¼‚ï¼š</span>{{ ev.power_differential }}</p>
                            {% endif %}

                            {% if ev.get('audience_role') %}
                            <p><span class="field-label">è§‚ä¼—åŠŸèƒ½ï¼š</span>{{ ev.audience_role }}</p>
                            {% endif %}

                            {% if ev.get('anchor_perceptions') %}
                            <p>
                                <span class="field-label">æ„ŸçŸ¥é”šç‚¹ï¼š</span>
                                <small style="color: #666;">ï¼ˆå¼•ç”¨çš„åº•å±‚æ„ŸçŸ¥äº‹ä»¶ semantic_notationï¼‰</small><br>
                                <code>{{ ev.anchor_perceptions | join('; ') }}</code>
                            </p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 15. çŸ›ç›¾æš´éœ² -->
        {% if data.get('contradiction_map') %}
        <div class="section">
            <h3>15. çŸ›ç›¾æš´éœ²</h3>
            <div class="subsection">

                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.contradiction_map.get('synthesis') %}
                <p><span class="field-label">çŸ›ç›¾ç ”åˆ¤ï¼š</span>{{ data.contradiction_map.synthesis }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€çŸ›ç›¾æš´éœ²è¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.contradiction_map.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€çŸ›ç›¾è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“çŸ›ç›¾åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.contradiction_map.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- çŸ›ç›¾äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.contradiction_map.get('events') and data.contradiction_map.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">çŸ›ç›¾æš´éœ²äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.contradiction_map.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.contradiction_map.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid #e67e22;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            {% if ev.get('claimed_premise') %}
                            <p><span class="field-label">å£°ç§°å‰æï¼š</span>{{ ev.claimed_premise }}</p>
                            {% endif %}

                            {% if ev.get('actual_behavior') %}
                            <p><span class="field-label">å®é™…è¡Œä¸ºï¼š</span>{{ ev.actual_behavior }}</p>
                            {% endif %}

                            {% if ev.get('contradiction_type') %}
                            <p>
                                <span class="field-label">çŸ›ç›¾ç±»å‹ï¼š</span>
                                {% set type_labels = {
                                    'means_end_mismatch': 'æ‰‹æ®µ-ç›®çš„é”™é…',
                                    'speech_action_split': 'è¨€è¡Œåˆ†è£‚',
                                    'context_violation': 'æƒ…å¢ƒè¿å’Œ',
                                    'value_inconsistency': 'ä»·å€¼è§‚è‡ªç›¸çŸ›ç›¾'
                                } %}
                                {{ type_labels.get(ev.contradiction_type, ev.contradiction_type) }}
                            </p>
                            {% endif %}

                            {% if ev.get('logical_conflict') %}
                            <p><span class="field-label">é€»è¾‘å†²çªï¼š</span>{{ ev.logical_conflict }}</p>
                            {% endif %}

                            {% if ev.get('anchor_perceptions') %}
                            <p>
                                <span class="field-label">æ„ŸçŸ¥é”šç‚¹ï¼š</span>
                                <small style="color: #666;">ï¼ˆå¼•ç”¨çš„åº•å±‚æ„ŸçŸ¥äº‹ä»¶ semantic_notationï¼‰</small><br>
                                <code>{{ ev.anchor_perceptions | join('; ') }}</code>
                            </p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 16. æ“æ§æœºåˆ¶è§£ç  -->
        {% if data.get('manipulation_decode') %}
        <div class="section">
            <h3>16. æ“æ§æœºåˆ¶è§£ç </h3>
            <div class="subsection">

                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.manipulation_decode.get('synthesis') %}
                <p><span class="field-label">æ“æ§ç ”åˆ¤ï¼š</span>{{ data.manipulation_decode.synthesis }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ“æ§æœºåˆ¶è¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.manipulation_decode.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€æ“æ§è¯æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“æ“æ§åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.manipulation_decode.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æ“æ§äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.manipulation_decode.get('events') and data.manipulation_decode.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ“æ§æœºåˆ¶äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.manipulation_decode.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.manipulation_decode.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid #c0392b;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            {% if ev.get('mechanism_type') %}
                            <p>
                                <span class="field-label">æœºåˆ¶ç±»å‹ï¼š</span>
                                {%- set mechanism_labels = {
                                    'guilt_induction': 'å†…ç–šè¯±å¯¼',
                                    'fear_appeal': 'ææƒ§è¯‰æ±‚',
                                    'love_bombing': 'çˆ±æ„è½°ç‚¸',
                                    'choice_elimination': 'é€‰æ‹©å‰¥å¤º',
                                    'reputation_leverage': 'å£°èª‰æŒŸæŒ',
                                    'false_generosity': 'è™šå‡æ…·æ…¨',
                                    'public_shaming_avoidance': 'è€»æ„Ÿè§„é¿æ–½å‹'
                                } -%}
                                {{ mechanism_labels.get(ev.mechanism_type, ev.mechanism_type) }}
                            </p>
                            {% endif %}

                            {% if ev.get('technique') %}
                            <p><span class="field-label">å®æ–½æŠ€æœ¯ï¼š</span>{{ ev.technique }}</p>
                            {% endif %}

                            {% if ev.get('leverage_point') %}
                            <p><span class="field-label">å¿ƒç†æ æ†ï¼š</span>{{ ev.leverage_point }}</p>
                            {% endif %}

                            {% if ev.get('intended_effect') %}
                            <p><span class="field-label">é¢„æœŸæ•ˆæœï¼š</span>{{ ev.intended_effect }}</p>
                            {% endif %}

                            {% if ev.get('exit_barrier_created') %}
                            <p><span class="field-label">é€€å‡ºéšœç¢ï¼š</span>{{ ev.exit_barrier_created }}</p>
                            {% endif %}

                            {% if ev.get('anchor_perceptions') %}
                            <p>
                                <span class="field-label">æ„ŸçŸ¥é”šç‚¹ï¼š</span>
                                <small style="color: #666;">ï¼ˆå¼•ç”¨çš„åº•å±‚æ„ŸçŸ¥äº‹ä»¶ semantic_notationï¼‰</small><br>
                                <code>{{ ev.anchor_perceptions | join('; ') }}</code>
                            </p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 17. æœ€å°å¯è¡Œæ€§å»ºè®® -->
        {% if data.get('minimal_viable_advice') %}
        <div class="section">
            <h3>17. æœ€å°å¯è¡Œæ€§å»ºè®®</h3>
            <div class="subsection">

                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.minimal_viable_advice.get('synthesis') %}
                <p><span class="field-label">ååˆ¶æ ‡ç­¾ï¼š</span>{{ data.minimal_viable_advice.synthesis }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æœ€å°å¯è¡Œæ€§å»ºè®®è¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.minimal_viable_advice.get('evidence_with_count') %}
                        <p>
                            <span class="field-label">å…¨å±€å»ºè®®ä¾æ®ç‰‡æ®µï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘å»ºè®®å¯è¡Œæ€§çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for item in data.minimal_viable_advice.evidence_with_count %}
                                <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                {% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å»ºè®®äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.minimal_viable_advice.get('events') and data.minimal_viable_advice.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ååˆ¶å»ºè®®äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.minimal_viable_advice.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.minimal_viable_advice.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid #27ae60;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆä»… schema å®šä¹‰å­—æ®µï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            {% if ev.get('counter_action') %}
                            <p><span class="field-label">ç ´å±€è¡ŒåŠ¨ï¼š</span>{{ ev.counter_action }}</p>
                            {% endif %}

                            {% if ev.get('targeted_mechanism') %}
                            <p>
                                <span class="field-label">é’ˆå¯¹æœºåˆ¶ï¼š</span>
                                {%- set raw = ev.targeted_mechanism -%}
                                {%- if raw -%}
                                    <!-- å¸Œæœ›é¦–å­—æ¯å¤§å†™æˆ–æ›´è‡ªç„¶çš„ä¸­æ–‡é˜…è¯»æ„Ÿï¼Œå¯ä»¥åŠ ä¸ª title è¿‡æ»¤å™¨ï¼ˆä½†æ³¨æ„å®ƒä¼šæŠŠæ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼‰ -->
                                    <!-- å¸Œæœ›ä¿æŒå…¨å°å†™ï¼ˆæ¯”å¦‚ç”¨äºå­¦æœ¯é£æ ¼ï¼‰ï¼Œé‚£å°±ä¸è¦åŠ  title -->
                                    {{ raw | replace('_', ' ') | replace('-', ' ') | title }}
                                {%- endif -%}
                            </p>
                            {% endif %}

                            {% if ev.get('expected_disruption') %}
                            <p><span class="field-label">é¢„æœŸç ´åï¼š</span>{{ ev.expected_disruption }}</p>
                            {% endif %}

                            {% if ev.get('feasibility_condition') %}
                            <p><span class="field-label">å‰ææ¡ä»¶ï¼š</span>{{ ev.feasibility_condition }}</p>
                            {% endif %}

                            {% if ev.get('anchor_perceptions') %}
                            <p>
                                <span class="field-label">æ„ŸçŸ¥é”šç‚¹ï¼š</span>
                                <small style="color: #666;">ï¼ˆå¼•ç”¨çš„åº•å±‚æ„ŸçŸ¥äº‹ä»¶ semantic_notationï¼‰</small><br>
                                <code>{{ ev.anchor_perceptions | join('; ') }}</code>
                            </p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
							{% if ev.get('evidence_with_count') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for item in ev.evidence_with_count %}
                                            <code>&ldquo;{{ item.text }}&rdquo;{% if item.count > 1 %} (Ã—{{ item.count }}){% endif %}</code>
                                            {% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        {% if data.analysis and data.analysis.suggestion %}
            <section class="suggestion-section">
                <h3>18. ç”¨æˆ·è¾“å…¥å†…å®¹è§£è¯»</h3>
                {% if data.analysis.suggestion.success %}
                    <div class="suggestion-content">{{ data.analysis.suggestion.content }}</div>
                {% else %}
                    <div class="suggestion-error">
                      <em>{{ data.analysis.suggestion.content }}</em>
                    </div>
                {% endif %}
            </section>
        {% endif %}

        <!-- è‹¥æ— ä»»ä½•æ•°æ® -->
        {% if not data or (data|length == 0) %}
        <p class="empty-section">æš‚æ— åˆ†ææ•°æ®ã€‚</p>
        {% endif %}
    </div>

    <!-- åˆ†äº«é€‰é¡¹ -->
    <div class="share-options">
        <h3>åˆ†äº«è¿™ä»½æŠ¥å‘Šï¼š</h3>
        <button id="btn-export-md" class="share-btn" onclick="saveAsMarkdown()">
            ğŸ’¾ å¯¼å‡ºä¸º Markdown
        </button>
        <button id="btn-generate-pdf" class="share-btn" onclick="generatePDF()">
            ğŸ–¨ï¸ ç”ŸæˆPDFæŠ¥å‘Š
        </button>
        <button id="btn-copy-text" class="share-btn" onclick="copyReportText()">
            ğŸ“‹ å¤åˆ¶æŠ¥å‘Šæ–‡æœ¬
        </button>
    </div>

    <!-- å›¾æ ‡ -->
    <div id="scroll-controls" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 1000;
    ">
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
                title="å›åˆ°é¡¶éƒ¨"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–²
        </button>
        <button onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})"
                title="æ»šåŠ¨åˆ°åº•"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–¼
        </button>
    </div>

    <script>
        var TurndownService = (function () {
          'use strict';

          function extend (destination) {
            for (var i = 1; i < arguments.length; i++) {
              var source = arguments[i];
              for (var key in source) {
                if (source.hasOwnProperty(key)) destination[key] = source[key];
              }
            }
            return destination
          }

          function repeat (character, count) {
            return Array(count + 1).join(character)
          }

          function trimLeadingNewlines (string) {
            return string.replace(/^\n*/, '')
          }

          function trimTrailingNewlines (string) {
            // avoid match-at-end regexp bottleneck, see #370
            var indexEnd = string.length;
            while (indexEnd > 0 && string[indexEnd - 1] === '\n') indexEnd--;
            return string.substring(0, indexEnd)
          }

          var blockElements = [
            'ADDRESS', 'ARTICLE', 'ASIDE', 'AUDIO', 'BLOCKQUOTE', 'BODY', 'CANVAS',
            'CENTER', 'DD', 'DIR', 'DIV', 'DL', 'DT', 'FIELDSET', 'FIGCAPTION', 'FIGURE',
            'FOOTER', 'FORM', 'FRAMESET', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'HEADER',
            'HGROUP', 'HR', 'HTML', 'ISINDEX', 'LI', 'MAIN', 'MENU', 'NAV', 'NOFRAMES',
            'NOSCRIPT', 'OL', 'OUTPUT', 'P', 'PRE', 'SECTION', 'TABLE', 'TBODY', 'TD',
            'TFOOT', 'TH', 'THEAD', 'TR', 'UL'
          ];

          function isBlock (node) {
            return is(node, blockElements)
          }

          var voidElements = [
            'AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT',
            'KEYGEN', 'LINK', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR'
          ];

          function isVoid (node) {
            return is(node, voidElements)
          }

          function hasVoid (node) {
            return has(node, voidElements)
          }

          var meaningfulWhenBlankElements = [
            'A', 'TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TH', 'TD', 'IFRAME', 'SCRIPT',
            'AUDIO', 'VIDEO'
          ];

          function isMeaningfulWhenBlank (node) {
            return is(node, meaningfulWhenBlankElements)
          }

          function hasMeaningfulWhenBlank (node) {
            return has(node, meaningfulWhenBlankElements)
          }

          function is (node, tagNames) {
            return tagNames.indexOf(node.nodeName) >= 0
          }

          function has (node, tagNames) {
            return (
              node.getElementsByTagName &&
              tagNames.some(function (tagName) {
                return node.getElementsByTagName(tagName).length
              })
            )
          }

          var rules = {};

          rules.paragraph = {
            filter: 'p',

            replacement: function (content) {
              return '\n\n' + content + '\n\n'
            }
          };

          rules.lineBreak = {
            filter: 'br',

            replacement: function (content, node, options) {
              return options.br + '\n'
            }
          };

          rules.heading = {
            filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],

            replacement: function (content, node, options) {
              var hLevel = Number(node.nodeName.charAt(1));

              if (options.headingStyle === 'setext' && hLevel < 3) {
                var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);
                return (
                  '\n\n' + content + '\n' + underline + '\n\n'
                )
              } else {
                return '\n\n' + repeat('#', hLevel) + ' ' + content + '\n\n'
              }
            }
          };

          rules.blockquote = {
            filter: 'blockquote',

            replacement: function (content) {
              content = content.replace(/^\n+|\n+$/g, '');
              content = content.replace(/^/gm, '> ');
              return '\n\n' + content + '\n\n'
            }
          };

          rules.list = {
            filter: ['ul', 'ol'],

            replacement: function (content, node) {
              var parent = node.parentNode;
              if (parent.nodeName === 'LI' && parent.lastElementChild === node) {
                return '\n' + content
              } else {
                return '\n\n' + content + '\n\n'
              }
            }
          };

          rules.listItem = {
            filter: 'li',

            replacement: function (content, node, options) {
              content = content
                .replace(/^\n+/, '') // remove leading newlines
                .replace(/\n+$/, '\n') // replace trailing newlines with just a single one
                .replace(/\n/gm, '\n    '); // indent
              var prefix = options.bulletListMarker + '   ';
              var parent = node.parentNode;
              if (parent.nodeName === 'OL') {
                var start = parent.getAttribute('start');
                var index = Array.prototype.indexOf.call(parent.children, node);
                prefix = (start ? Number(start) + index : index + 1) + '.  ';
              }
              return (
                prefix + content + (node.nextSibling && !/\n$/.test(content) ? '\n' : '')
              )
            }
          };

          rules.indentedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'indented' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              return (
                '\n\n    ' +
                node.firstChild.textContent.replace(/\n/g, '\n    ') +
                '\n\n'
              )
            }
          };

          rules.fencedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'fenced' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              var className = node.firstChild.getAttribute('class') || '';
              var language = (className.match(/language-(\S+)/) || [null, ''])[1];
              var code = node.firstChild.textContent;

              var fenceChar = options.fence.charAt(0);
              var fenceSize = 3;
              var fenceInCodeRegex = new RegExp('^' + fenceChar + '{3,}', 'gm');

              var match;
              while ((match = fenceInCodeRegex.exec(code))) {
                if (match[0].length >= fenceSize) {
                  fenceSize = match[0].length + 1;
                }
              }

              var fence = repeat(fenceChar, fenceSize);

              return (
                '\n\n' + fence + language + '\n' +
                code.replace(/\n$/, '') +
                '\n' + fence + '\n\n'
              )
            }
          };

          rules.horizontalRule = {
            filter: 'hr',

            replacement: function (content, node, options) {
              return '\n\n' + options.hr + '\n\n'
            }
          };

          rules.inlineLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'inlined' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              return '[' + content + '](' + href + title + ')'
            }
          };

          rules.referenceLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'referenced' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node, options) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              var replacement;
              var reference;

              switch (options.linkReferenceStyle) {
                case 'collapsed':
                  replacement = '[' + content + '][]';
                  reference = '[' + content + ']: ' + href + title;
                  break
                case 'shortcut':
                  replacement = '[' + content + ']';
                  reference = '[' + content + ']: ' + href + title;
                  break
                default:
                  var id = this.references.length + 1;
                  replacement = '[' + content + '][' + id + ']';
                  reference = '[' + id + ']: ' + href + title;
              }

              this.references.push(reference);
              return replacement
            },

            references: [],

            append: function (options) {
              var references = '';
              if (this.references.length) {
                references = '\n\n' + this.references.join('\n') + '\n\n';
                this.references = []; // Reset references
              }
              return references
            }
          };

          rules.emphasis = {
            filter: ['em', 'i'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.emDelimiter + content + options.emDelimiter
            }
          };

          rules.strong = {
            filter: ['strong', 'b'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.strongDelimiter + content + options.strongDelimiter
            }
          };

          rules.code = {
            filter: function (node) {
              var hasSiblings = node.previousSibling || node.nextSibling;
              var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;

              return node.nodeName === 'CODE' && !isCodeBlock
            },

            replacement: function (content) {
              if (!content) return ''
              content = content.replace(/\r?\n|\r/g, ' ');

              var extraSpace = /^`|^ .*?[^ ].* $|`$/.test(content) ? ' ' : '';
              var delimiter = '`';
              var matches = content.match(/`+/gm) || [];
              while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';

              return delimiter + extraSpace + content + extraSpace + delimiter
            }
          };

          rules.image = {
            filter: 'img',

            replacement: function (content, node) {
              var alt = cleanAttribute(node.getAttribute('alt'));
              var src = node.getAttribute('src') || '';
              var title = cleanAttribute(node.getAttribute('title'));
              var titlePart = title ? ' "' + title + '"' : '';
              return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''
            }
          };

          function cleanAttribute (attribute) {
            return attribute ? attribute.replace(/(\n+\s*)+/g, '\n') : ''
          }

          /**
           * Manages a collection of rules used to convert HTML to Markdown
           */

          function Rules (options) {
            this.options = options;
            this._keep = [];
            this._remove = [];

            this.blankRule = {
              replacement: options.blankReplacement
            };

            this.keepReplacement = options.keepReplacement;

            this.defaultRule = {
              replacement: options.defaultReplacement
            };

            this.array = [];
            for (var key in options.rules) this.array.push(options.rules[key]);
          }

          Rules.prototype = {
            add: function (key, rule) {
              this.array.unshift(rule);
            },

            keep: function (filter) {
              this._keep.unshift({
                filter: filter,
                replacement: this.keepReplacement
              });
            },

            remove: function (filter) {
              this._remove.unshift({
                filter: filter,
                replacement: function () {
                  return ''
                }
              });
            },

            forNode: function (node) {
              if (node.isBlank) return this.blankRule
              var rule;

              if ((rule = findRule(this.array, node, this.options))) return rule
              if ((rule = findRule(this._keep, node, this.options))) return rule
              if ((rule = findRule(this._remove, node, this.options))) return rule

              return this.defaultRule
            },

            forEach: function (fn) {
              for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);
            }
          };

          function findRule (rules, node, options) {
            for (var i = 0; i < rules.length; i++) {
              var rule = rules[i];
              if (filterValue(rule, node, options)) return rule
            }
            return void 0
          }

          function filterValue (rule, node, options) {
            var filter = rule.filter;
            if (typeof filter === 'string') {
              if (filter === node.nodeName.toLowerCase()) return true
            } else if (Array.isArray(filter)) {
              if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true
            } else if (typeof filter === 'function') {
              if (filter.call(rule, node, options)) return true
            } else {
              throw new TypeError('`filter` needs to be a string, array, or function')
            }
          }

          /**
           * The collapseWhitespace function is adapted from collapse-whitespace
           * by Luc Thevenard.
           *
           * The MIT License (MIT)
           *
           * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>
           *
           * Permission is hereby granted, free of charge, to any person obtaining a copy
           * of this software and associated documentation files (the "Software"), to deal
           * in the Software without restriction, including without limitation the rights
           * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
           * copies of the Software, and to permit persons to whom the Software is
           * furnished to do so, subject to the following conditions:
           *
           * The above copyright notice and this permission notice shall be included in
           * all copies or substantial portions of the Software.
           *
           * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
           * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
           * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
           * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
           * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
           * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
           * THE SOFTWARE.
           */

          /**
           * collapseWhitespace(options) removes extraneous whitespace from an the given element.
           *
           * @param {Object} options
           */
          function collapseWhitespace (options) {
            var element = options.element;
            var isBlock = options.isBlock;
            var isVoid = options.isVoid;
            var isPre = options.isPre || function (node) {
              return node.nodeName === 'PRE'
            };

            if (!element.firstChild || isPre(element)) return

            var prevText = null;
            var keepLeadingWs = false;

            var prev = null;
            var node = next(prev, element, isPre);

            while (node !== element) {
              if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE
                var text = node.data.replace(/[ \r\n\t]+/g, ' ');

                if ((!prevText || / $/.test(prevText.data)) &&
                    !keepLeadingWs && text[0] === ' ') {
                  text = text.substr(1);
                }

                // `text` might be empty at this point.
                if (!text) {
                  node = remove(node);
                  continue
                }

                node.data = text;

                prevText = node;
              } else if (node.nodeType === 1) { // Node.ELEMENT_NODE
                if (isBlock(node) || node.nodeName === 'BR') {
                  if (prevText) {
                    prevText.data = prevText.data.replace(/ $/, '');
                  }

                  prevText = null;
                  keepLeadingWs = false;
                } else if (isVoid(node) || isPre(node)) {
                  // Avoid trimming space around non-block, non-BR void elements and inline PRE.
                  prevText = null;
                  keepLeadingWs = true;
                } else if (prevText) {
                  // Drop protection if set previously.
                  keepLeadingWs = false;
                }
              } else {
                node = remove(node);
                continue
              }

              var nextNode = next(prev, node, isPre);
              prev = node;
              node = nextNode;
            }

            if (prevText) {
              prevText.data = prevText.data.replace(/ $/, '');
              if (!prevText.data) {
                remove(prevText);
              }
            }
          }

          /**
           * remove(node) removes the given node from the DOM and returns the
           * next node in the sequence.
           *
           * @param {Node} node
           * @return {Node} node
           */
          function remove (node) {
            var next = node.nextSibling || node.parentNode;

            node.parentNode.removeChild(node);

            return next
          }

          /**
           * next(prev, current, isPre) returns the next node in the sequence, given the
           * current and previous nodes.
           *
           * @param {Node} prev
           * @param {Node} current
           * @param {Function} isPre
           * @return {Node}
           */
          function next (prev, current, isPre) {
            if ((prev && prev.parentNode === current) || isPre(current)) {
              return current.nextSibling || current.parentNode
            }

            return current.firstChild || current.nextSibling || current.parentNode
          }

          /*
           * Set up window for Node.js
           */

          var root = (typeof window !== 'undefined' ? window : {});

          /*
           * Parsing HTML strings
           */

          function canParseHTMLNatively () {
            var Parser = root.DOMParser;
            var canParse = false;

            // Adapted from https://gist.github.com/1129031
            // Firefox/Opera/IE throw errors on unsupported types
            try {
              // WebKit returns null on unsupported types
              if (new Parser().parseFromString('', 'text/html')) {
                canParse = true;
              }
            } catch (e) {}

            return canParse
          }

          function createHTMLParser () {
            var Parser = function () {};

            {
              if (shouldUseActiveX()) {
                Parser.prototype.parseFromString = function (string) {
                  var doc = new window.ActiveXObject('htmlfile');
                  doc.designMode = 'on'; // disable on-page scripts
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              } else {
                Parser.prototype.parseFromString = function (string) {
                  var doc = document.implementation.createHTMLDocument('');
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              }
            }
            return Parser
          }

          function shouldUseActiveX () {
            var useActiveX = false;
            try {
              document.implementation.createHTMLDocument('').open();
            } catch (e) {
              if (window.ActiveXObject) useActiveX = true;
            }
            return useActiveX
          }

          var HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();

          function RootNode (input, options) {
            var root;
            if (typeof input === 'string') {
              var doc = htmlParser().parseFromString(
                // DOM parsers arrange elements in the <head> and <body>.
                // Wrapping in a custom element ensures elements are reliably arranged in
                // a single element.
                '<x-turndown id="turndown-root">' + input + '</x-turndown>',
                'text/html'
              );
              root = doc.getElementById('turndown-root');
            } else {
              root = input.cloneNode(true);
            }
            collapseWhitespace({
              element: root,
              isBlock: isBlock,
              isVoid: isVoid,
              isPre: options.preformattedCode ? isPreOrCode : null
            });

            return root
          }

          var _htmlParser;
          function htmlParser () {
            _htmlParser = _htmlParser || new HTMLParser();
            return _htmlParser
          }

          function isPreOrCode (node) {
            return node.nodeName === 'PRE' || node.nodeName === 'CODE'
          }

          function Node (node, options) {
            node.isBlock = isBlock(node);
            node.isCode = node.nodeName === 'CODE' || node.parentNode.isCode;
            node.isBlank = isBlank(node);
            node.flankingWhitespace = flankingWhitespace(node, options);
            return node
          }

          function isBlank (node) {
            return (
              !isVoid(node) &&
              !isMeaningfulWhenBlank(node) &&
              /^\s*$/i.test(node.textContent) &&
              !hasVoid(node) &&
              !hasMeaningfulWhenBlank(node)
            )
          }

          function flankingWhitespace (node, options) {
            if (node.isBlock || (options.preformattedCode && node.isCode)) {
              return { leading: '', trailing: '' }
            }

            var edges = edgeWhitespace(node.textContent);

            // abandon leading ASCII WS if left-flanked by ASCII WS
            if (edges.leadingAscii && isFlankedByWhitespace('left', node, options)) {
              edges.leading = edges.leadingNonAscii;
            }

            // abandon trailing ASCII WS if right-flanked by ASCII WS
            if (edges.trailingAscii && isFlankedByWhitespace('right', node, options)) {
              edges.trailing = edges.trailingNonAscii;
            }

            return { leading: edges.leading, trailing: edges.trailing }
          }

          function edgeWhitespace (string) {
            var m = string.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);
            return {
              leading: m[1], // whole string for whitespace-only strings
              leadingAscii: m[2],
              leadingNonAscii: m[3],
              trailing: m[4], // empty for whitespace-only strings
              trailingNonAscii: m[5],
              trailingAscii: m[6]
            }
          }

          function isFlankedByWhitespace (side, node, options) {
            var sibling;
            var regExp;
            var isFlanked;

            if (side === 'left') {
              sibling = node.previousSibling;
              regExp = / $/;
            } else {
              sibling = node.nextSibling;
              regExp = /^ /;
            }

            if (sibling) {
              if (sibling.nodeType === 3) {
                isFlanked = regExp.test(sibling.nodeValue);
              } else if (options.preformattedCode && sibling.nodeName === 'CODE') {
                isFlanked = false;
              } else if (sibling.nodeType === 1 && !isBlock(sibling)) {
                isFlanked = regExp.test(sibling.textContent);
              }
            }
            return isFlanked
          }

          var reduce = Array.prototype.reduce;
          var escapes = [
            [/\\/g, '\\\\'],
            [/\*/g, '\\*'],
            [/^-/g, '\\-'],
            [/^\+ /g, '\\+ '],
            [/^(=+)/g, '\\$1'],
            [/^(#{1,6}) /g, '\\$1 '],
            [/`/g, '\\`'],
            [/^~~~/g, '\\~~~'],
            [/\[/g, '\\['],
            [/\]/g, '\\]'],
            [/^>/g, '\\>'],
            [/_/g, '\\_'],
            [/^(\d+)\. /g, '$1\\. ']
          ];

          function TurndownService (options) {
            if (!(this instanceof TurndownService)) return new TurndownService(options)

            var defaults = {
              rules: rules,
              headingStyle: 'setext',
              hr: '* * *',
              bulletListMarker: '*',
              codeBlockStyle: 'indented',
              fence: '```',
              emDelimiter: '_',
              strongDelimiter: '**',
              linkStyle: 'inlined',
              linkReferenceStyle: 'full',
              br: '  ',
              preformattedCode: false,
              blankReplacement: function (content, node) {
                return node.isBlock ? '\n\n' : ''
              },
              keepReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + node.outerHTML + '\n\n' : node.outerHTML
              },
              defaultReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + content + '\n\n' : content
              }
            };
            this.options = extend({}, defaults, options);
            this.rules = new Rules(this.options);
          }

          TurndownService.prototype = {
            /**
             * The entry point for converting a string or DOM node to Markdown
             * @public
             * @param {String|HTMLElement} input The string or DOM node to convert
             * @returns A Markdown representation of the input
             * @type String
             */

            turndown: function (input) {
              if (!canConvert(input)) {
                throw new TypeError(
                  input + ' is not a string, or an element/document/fragment node.'
                )
              }

              if (input === '') return ''

              var output = process.call(this, new RootNode(input, this.options));
              return postProcess.call(this, output)
            },

            /**
             * Add one or more plugins
             * @public
             * @param {Function|Array} plugin The plugin or array of plugins to add
             * @returns The Turndown instance for chaining
             * @type Object
             */

            use: function (plugin) {
              if (Array.isArray(plugin)) {
                for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);
              } else if (typeof plugin === 'function') {
                plugin(this);
              } else {
                throw new TypeError('plugin must be a Function or an Array of Functions')
              }
              return this
            },

            /**
             * Adds a rule
             * @public
             * @param {String} key The unique key of the rule
             * @param {Object} rule The rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            addRule: function (key, rule) {
              this.rules.add(key, rule);
              return this
            },

            /**
             * Keep a node (as HTML) that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            keep: function (filter) {
              this.rules.keep(filter);
              return this
            },

            /**
             * Remove a node that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            remove: function (filter) {
              this.rules.remove(filter);
              return this
            },

            /**
             * Escapes Markdown syntax
             * @public
             * @param {String} string The string to escape
             * @returns A string with Markdown syntax escaped
             * @type String
             */

            escape: function (string) {
              return escapes.reduce(function (accumulator, escape) {
                return accumulator.replace(escape[0], escape[1])
              }, string)
            }
          };

          /**
           * Reduces a DOM node down to its Markdown string equivalent
           * @private
           * @param {HTMLElement} parentNode The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function process (parentNode) {
            var self = this;
            return reduce.call(parentNode.childNodes, function (output, node) {
              node = new Node(node, self.options);

              var replacement = '';
              if (node.nodeType === 3) {
                replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);
              } else if (node.nodeType === 1) {
                replacement = replacementForNode.call(self, node);
              }

              return join(output, replacement)
            }, '')
          }

          /**
           * Appends strings as each rule requires and trims the output
           * @private
           * @param {String} output The conversion output
           * @returns A trimmed version of the ouput
           * @type String
           */

          function postProcess (output) {
            var self = this;
            this.rules.forEach(function (rule) {
              if (typeof rule.append === 'function') {
                output = join(output, rule.append(self.options));
              }
            });

            return output.replace(/^[\t\r\n]+/, '').replace(/[\t\r\n\s]+$/, '')
          }

          /**
           * Converts an element node to its Markdown equivalent
           * @private
           * @param {HTMLElement} node The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function replacementForNode (node) {
            var rule = this.rules.forNode(node);
            var content = process.call(this, node);
            var whitespace = node.flankingWhitespace;
            if (whitespace.leading || whitespace.trailing) content = content.trim();
            return (
              whitespace.leading +
              rule.replacement(content, node, this.options) +
              whitespace.trailing
            )
          }

          /**
           * Joins replacement to the current output with appropriate number of new lines
           * @private
           * @param {String} output The current conversion output
           * @param {String} replacement The string to append to the output
           * @returns Joined output
           * @type String
           */

          function join (output, replacement) {
            var s1 = trimTrailingNewlines(output);
            var s2 = trimLeadingNewlines(replacement);
            var nls = Math.max(output.length - s1.length, replacement.length - s2.length);
            var separator = '\n\n'.substring(0, nls);

            return s1 + separator + s2
          }

          /**
           * Determines whether an input can be converted
           * @private
           * @param {String|HTMLElement} input Describe this parameter
           * @returns Describe what it returns
           * @type String|Object|Array|Boolean|Number
           */

          function canConvert (input) {
            return (
              input != null && (
                typeof input === 'string' ||
                (input.nodeType && (
                  input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11
                ))
              )
            )
          }

          return TurndownService;

        }());
    </script>

    <script>
        const REPORT_TITLE = {{ data.meta.title | default('å…¨æ¯æ„ŸçŸ¥åŸºåº•åˆ†ææŠ¥å‘Š') | tojson }}

        function saveAsMarkdown() {
            if (typeof TurndownService !== 'function') {
                alert('âŒ Markdown è½¬æ¢å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚');
                return;
            }

            const reportEl = document.querySelector('.report');
            if (!reportEl) {
                alert('âŒ æœªæ‰¾åˆ° .report å…ƒç´ ');
                return;
            }

            // å…‹éš†å¹¶æ¸…ç†
            const clone = reportEl.cloneNode(true);
            clone.querySelectorAll('script, style, .no-export').forEach(el => el.remove());

            // è½¬æ¢
            const turndownService = new TurndownService({
                headingStyle: 'atx',
                bulletListMarker: '-',
                codeBlockStyle: 'fenced'
            });
            let markdown = turndownService.turndown(clone.innerHTML);

            // æ¸…ç†å¤šä½™ç©ºè¡Œ
            markdown = markdown.replace(/\n{3,}/g, '\n\n').trim();

            // ç”Ÿæˆå®‰å…¨æ–‡ä»¶å
            const safeName = REPORT_TITLE
                .replace(/[<>:"/\\|?*\x00-\x1F]/g, '_')
                .replace(/\s+/g, '_')
                .substring(0, 60) || 'report';

            // ä¸‹è½½
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${safeName}.md`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copyReportText() {
            const el = document.querySelector('.report');
            if (!el) {
                alert('âŒ æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚');
                return;
            }
            const text = el.innerText;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶ï¼ˆä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼‰ï¼');
            } catch (err) {
                alert('âŒ è¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æœ¬ã€‚');
            }
            document.body.removeChild(textarea);
        }

        function generatePDF() {
            window.print(); // è§¦å‘æ‰“å°ï¼Œç”¨æˆ·å¯é€‰æ‹©â€œå¦å­˜ä¸ºPDFâ€
        }
    </script>

    <!-- åŠ¨æ€æ°´å°æ³¨å…¥ï¼ˆä»…å½“å¯ç”¨æ—¶ï¼‰ -->
    {% if data.watermark and data.watermark.enabled %}
    <style>
    .watermark-grid {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        pointer-events: none;
        user-select: none;
        display: grid;
        grid-template-columns: repeat({{ data.watermark.cols }}, 1fr);
        grid-template-rows: repeat({{ data.watermark.rows }}, 1fr);
        opacity: {{ "%.2f"|format(data.watermark.opacity) }};
        transform: rotate({{ data.watermark.angle }}deg);
        font-family: "Microsoft YaHei", sans-serif;
    }

    .watermark-grid span {
        padding: {{ data.watermark.padding }}px;
        font-size: {{ data.watermark.fontSize }}px;
        color: {{ data.watermark.color }};
        font-weight: bold;
        white-space: nowrap;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
    }
    </style>

    <div class="watermark-grid">
        {%- for i in range(data.watermark.cols * data.watermark.rows) -%}
            <span>{{ data.watermark.text | e }}</span>
        {%- endfor -%}
    </div>
    {% endif %}
</body>
</html>