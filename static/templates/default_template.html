<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š</title>
    <style>
        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .subsection {
            margin-top: 15px;
            padding: 10px;
            background: #ffffff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        h2 {
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        h3 {
            color: #495057;
            margin-top: 20px;
        }
        ul, ol {
            padding-left: 20px;
            margin: 8px 0;
        }
        li {
            margin-bottom: 4px;
        }
        .field-label {
            font-weight: bold;
            color: #495057;
        }
        .empty-section {
            color: #6c757d;
            font-style: italic;
        }

        /* Share buttons */
        .share-options {
            margin: 30px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
        }
        .share-btn {
            margin: 5px 8px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .share-btn:hover {
            background: #0056b3;
        }
        .details-block {
            margin-top: 12px;
            border-left: 2px solid #e0e0e0;
            padding-left: 12px;
        }
        .details-block summary {
            cursor: pointer;
            color: #1a73e8;
            font-weight: 500;
        }
        .details-content {
            margin-top: 8px;
            padding: 8px 0;
            border-top: 1px dashed #ddd;
        }
        code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .suggestion-section {
          background-color: #f8f9fa;
          border-left: 4px solid #0d6efd;
          padding: 16px;
          margin: 24px 0;
        }
        .suggestion-content {
          white-space: pre-wrap;
          line-height: 1.6;
        }
        .suggestion-error {
          color: #dc3545;
          font-style: italic;
        }
        /* æ‰“å°æ—¶éšè—åˆ†äº«æ“ä½œæŒ‰é’® */
        @media print {
          #btn-export-md,
          #btn-generate-pdf,
          #btn-copy-text,
          .share-options > h3 {
            display: none !important;
          }
          #scroll-controls {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
          }
        }
        .watermark-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            pointer-events: none;        /* ç‚¹å‡»ç©¿é€ */
            user-select: none;           /* ç¦æ­¢é€‰ä¸­ */
            display: grid;
            grid-template-columns: repeat(5, 1fr);  /* 5åˆ— */
            grid-template-rows: repeat(8, 1fr);     /* 8è¡Œï¼Œé¿å…å¤ªå¯† */
            opacity: 0.12;               /* ä» 0.05 æé«˜åˆ° 0.12ï¼Œæ¸…æ™°ä½†ä¸åˆºçœ¼ */
            transform: rotate(-30deg);
            font-weight: bold;
            font-family: "Microsoft YaHei", sans-serif;
        }

        .watermark-grid span {
            padding: 30px;               /* å†…è¾¹è·åŠ å¤§ï¼Œé¿å…æ–‡å­—ç´§è´´ */
            font-size: 48px;             /* æ”¾å¤§ä¸‰å€ï¼å…³é”®æ”¹åŠ¨ */
            color: rgba(54, 52, 52, 0.9); /* çº¢è‰²ç”¨ rgba æ§åˆ¶ï¼Œä¿ç•™é€æ˜é€šé“ */
            font-weight: bold;
            white-space: nowrap;         /* é˜²æ­¢æ¢è¡Œ */
            text-align: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3); /* è½»å¾®é˜´å½±ï¼Œæå‡å¯è¯»æ€§ */
        }
    </style>
</head>
<body>
    <div class="watermark-grid">
        <span>å†…éƒ¨å®¡è®¡</span><span>ä¸¥ç¦å¤–ä¼ </span><span>å†…éƒ¨å®¡è®¡</span><span>ä¸¥ç¦å¤–ä¼ </span>
        <!-- æ›´å¤š... -->
    </div>

    <!-- æŠ¥å‘Šå†…å®¹ -->
    <div class="report">
        {% if data%}
        <h2>{{ data.meta.title or 'æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š' }}</h2>
        {% endif %}

        <!-- åˆ†æå…ƒä¿¡æ¯ -->
        {% if data%}
        <div class="section">
          <h3>åˆ†æå…ƒä¿¡æ¯</h3>
          <div class="subsection">
            <!-- åŸºç¡€æ ‡è¯† -->
            <p><span class="field-label">æŠ¥å‘ŠIDï¼š</span>{{ data.id or 'æœªçŸ¥' }}</p>
            {% if data.formatter_time %}
              <p><span class="field-label">ç”Ÿæˆæ—¶é—´ï¼š</span>{{ data.formatter_time | default('æœªçŸ¥') }}</p>
            {% endif %}
            <p><span class="field-label">æŠ¥å‘Šç±»å‹ï¼š</span>{{ data.type or 'æœªæŒ‡å®š' }}</p>

            <!-- åŸå§‹å†…å®¹ï¼ˆå»ºè®®ç”¨ <pre> æˆ–é™åˆ¶é«˜åº¦ï¼‰ -->
            {% if data.source and data.source.content %}
              <p><span class="field-label">åŸå§‹æ–‡æœ¬ï¼š</span></p>
              <div style="background:#f9f9f9; padding:8px; border-radius:4px; max-height:150px; overflow:auto; font-family:monospace; font-size:0.9em;">
                {{ data.source.content | e }}
              </div>
            {% endif %}

            <!-- AI ä¸æ¨¡å‹ä¿¡æ¯ -->
            <p><span class="field-label">AI ç”Ÿæˆï¼š</span>{{ 'æ˜¯' if data.meta.created_by_ai else 'å¦' }}</p>
            <p><span class="field-label">æ¨¡å‹ç‰ˆæœ¬ï¼š</span>{{ data.meta.llm_model or 'æœªçŸ¥' }}</p>
            <p><span class="field-label">åº“ç‰ˆæœ¬ï¼š</span>{{ data.meta.library_version or 'æœªçŸ¥' }}</p>
<!--            <p><span class="field-label">å™äº‹å¢å¼ºï¼š</span>{{ 'å·²å¯ç”¨' if data.meta.narrative_enriched else 'æœªå¯ç”¨' }}</p>-->

            <!-- åç»­æ³¨å…¥å­—æ®µ -->
            {% if data.meta.validity_level %}
              <p><span class="field-label">æœ‰æ•ˆæ€§ç­‰çº§ï¼š</span>{{ data.meta.validity_level }}</p>
            {% endif %}
            {% if data.meta.privacy_scope and data.meta.privacy_scope.privacy_level is defined %}
              <p><span class="field-label">éšç§ç­‰çº§ï¼š</span>{{ "%.2f"|format(data.meta.privacy_scope.privacy_level) }}</p>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- 1. æºæ•°æ®æå–ï¼ˆå‚ä¸è€…ï¼‰ -->
        {% if data.get('participants') %}
        <div class="section">
            <h3>1. å‚ä¸è€…ä¿¡æ¯</h3>
            <details class="details-block">
                <summary>ğŸ” å±•å¼€å‚ä¸è€…è§£æè¯¦æƒ…</summary>
                <div class="subsection" style="margin-top: 16px;">
                    {% for p in data.participants %}
                    <div style="margin-bottom: 24px; padding: 12px; border-left: 2px solid #4a90e2; background: #f9fbfd;">
                        <!-- æ ¸å¿ƒæ ‡è¯† -->
                        <p><span class="field-label">åŸå§‹æŒ‡ç§°ï¼š</span><code>{{ p.entity }}</code></p>

                        <!-- èº«ä»½ä¸ç¤¾ä¼šå±æ€§ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_identity = [
                            p.get('occupation'),
                            p.get('social_role'),
                            p.get('family_status'),
                            p.get('institutional_affiliation'),
                            p.get('education_level'),
                            p.get('primary_language'),
                            p.get('cultural_identity'),
                            p.get('beliefs_or_values')
                        ] | select | list %}
                        {% if has_identity %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ§¾ èº«ä»½ä¸ç¤¾ä¼šå±æ€§</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('occupation') %}<p><span class="field-label">èŒä¸šèº«ä»½ï¼š</span>{{ p.occupation }}</p>{% endif %}
                                {% if p.get('social_role') %}<p><span class="field-label">ç¤¾ä¼šå…³ç³»è§’è‰²ï¼š</span>{{ p.social_role }}</p>{% endif %}
                                {% if p.get('family_status') %}<p><span class="field-label">å®¶åº­çŠ¶æ€ï¼š</span>{{ p.family_status }}</p>{% endif %}
                                {% if p.get('institutional_affiliation') %}<p><span class="field-label">æ‰€å±æœºæ„ï¼š</span>{{ p.institutional_affiliation | join(', ') }}</p>{% endif %}
                                {% if p.get('education_level') %}<p><span class="field-label">æ•™è‚²ç¨‹åº¦ï¼š</span>{{ p.education_level }}</p>{% endif %}
                                {% if p.get('primary_language') %}<p><span class="field-label">ä¸»è¦ä½¿ç”¨è¯­è¨€ï¼š</span>{{ p.primary_language }}</p>{% endif %}
                                {% if p.get('cultural_identity') %}<p><span class="field-label">æ–‡åŒ–/æ—ç¾¤è®¤åŒï¼š</span>{{ p.cultural_identity | join(', ') }}</p>{% endif %}
                                {% if p.get('beliefs_or_values') %}<p><span class="field-label">æ˜ç¡®é™ˆè¿°çš„ä¿¡å¿µæˆ–ä»·å€¼è§‚ï¼š</span>{{ p.beliefs_or_values }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- ç”Ÿç‰©ä¸ç”Ÿç†ç‰¹å¾ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_bio = [
                            p.get('gender'),
                            p.get('age_range'),
                            p.get('ethnicity_or_origin'),
                            p.get('physical_traits')
                        ] | select | list %}
                        {% if has_bio %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ§¬ ç”Ÿç‰©ä¸ç”Ÿç†ç‰¹å¾</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('gender') %}<p><span class="field-label">æ€§åˆ«æ ‡è¯†ï¼š</span>{{ p.gender }}</p>{% endif %}
                                {% if p.get('age_range') %}<p><span class="field-label">å¹´é¾„é˜¶æ®µï¼š</span>{{ p.age_range }}</p>{% endif %}
                                {% if p.get('ethnicity_or_origin') %}<p><span class="field-label">åœ°åŸŸæˆ–æ—ç¾¤æ¥æºï¼š</span>{{ p.ethnicity_or_origin }}</p>{% endif %}
                                {% if p.get('physical_traits') %}<p><span class="field-label">é•¿æœŸç”Ÿç†ç‰¹å¾ï¼š</span>{{ p.physical_traits | join(', ') }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- å½“å‰å¤–æ˜¾çŠ¶æ€ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_state = [
                            p.get('appearance'),
                            p.get('current_physical_state'),
                            p.get('visible_injury_or_wound'),
                            p.get('carried_objects'),
                            p.get('worn_technology'),
                            p.get('inherent_odor'),
                            p.get('voice_quality'),
                            p.get('speech_pattern')
                        ] | select | list %}
                        {% if has_state %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ‘ï¸ å½“å‰å¤–æ˜¾çŠ¶æ€</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('appearance') %}<p><span class="field-label">å¤–æ˜¾ç‰¹å¾ï¼š</span>{{ p.appearance | join(', ') }}</p>{% endif %}
                                {% if p.get('current_physical_state') %}<p><span class="field-label">å½“å‰èº«ä½“/æƒ…ç»ªçŠ¶æ€ï¼š</span>{{ p.current_physical_state }}</p>{% endif %}
                                {% if p.get('visible_injury_or_wound') %}<p><span class="field-label">å¯è§ä¼¤ç—•æˆ–åŒ»ç–—ç—•è¿¹ï¼š</span>{{ p.visible_injury_or_wound | join(', ') }}</p>{% endif %}
                                {% if p.get('carried_objects') %}<p><span class="field-label">æŒæœ‰ç‰©å“ï¼š</span>{{ p.carried_objects | join(', ') }}</p>{% endif %}
                                {% if p.get('worn_technology') %}<p><span class="field-label">ä½©æˆ´çš„ç”µå­è®¾å¤‡ï¼š</span>{{ p.worn_technology | join(', ') }}</p>{% endif %}
                                {% if p.get('inherent_odor') %}<p><span class="field-label">ç›¸å…³æ°”å‘³ï¼š</span>{{ p.inherent_odor | join(', ') }}</p>{% endif %}
                                {% if p.get('voice_quality') %}<p><span class="field-label">å—“éŸ³ç‰¹å¾ï¼š</span>{{ p.voice_quality }}</p>{% endif %}
                                {% if p.get('speech_pattern') %}<p><span class="field-label">è¨€è¯­æ¨¡å¼ï¼š</span>{{ p.speech_pattern }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- å¿ƒç†ä¸è¡Œä¸ºå€¾å‘ï¼ˆä»…å½“ä»»ä¸€å­—æ®µå­˜åœ¨æ—¶æ˜¾ç¤ºï¼‰ -->
                        {% set has_psych = [
                            p.get('personality_traits'),
                            p.get('behavioral_tendencies')
                        ] | select | list %}
                        {% if has_psych %}
                        <details class="details-block" style="margin-top: 8px;">
                            <summary>ğŸ§  å¿ƒç†ä¸è¡Œä¸ºå€¾å‘</summary>
                            <div style="margin-top: 6px; padding-left: 12px; border-left: 1px dashed #ccc;">
                                {% if p.get('personality_traits') %}<p><span class="field-label">äººæ ¼ç‰¹è´¨é™ˆè¿°ï¼š</span>{{ p.personality_traits | join(', ') }}</p>{% endif %}
                                {% if p.get('behavioral_tendencies') %}<p><span class="field-label">ä¹ æƒ¯æ€§è¡Œä¸ºï¼š</span>{{ p.behavioral_tendencies | join(', ') }}</p>{% endif %}
                            </div>
                        </details>
                        {% endif %}

                        <!-- äº‹ä»¶ä¸­çš„åŠŸèƒ½è§’è‰²ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰ -->
                        {% if p.get('interaction_role') %}
                        <p style="margin-top: 12px; padding: 8px; background-color: #fff8e1; border-radius: 4px;">
                            <span class="field-label">ğŸ“Œ äº‹ä»¶åŠŸèƒ½è§’è‰²ï¼š</span>{{ p.interaction_role }}
                        </p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </details>
        </div>
        {% endif %}

        <!-- 2. æ—¶é—´æ„ŸçŸ¥ -->
        {% if data.get('temporal') %}
        <div class="section">
            <h3>2. æ—¶é—´æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.temporal.get('summary') %}
                <p><span class="field-label">æ—¶é—´æ‘˜è¦ï¼š</span>{{ data.temporal.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ—¶é—´è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼Œå¸¦è¯´æ˜ï¼‰ -->
                        {% if data.temporal.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªæ—¶é—´åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.temporal.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æ—¶é—´äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.temporal.get('events') and data.temporal.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ—¶é—´äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.temporal.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.temporal.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒæ—¶é—´ä¿¡æ¯ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">é™ˆè¿°ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('exact_literals') %}<p><span class="field-label">ç²¾ç¡®æ—¶é—´ï¼š</span>{{ ev.exact_literals | join(', ') }}</p>{% endif %}
                            {% if ev.get('time_ranges') %}<p><span class="field-label">æ—¶é—´åŒºé—´ï¼š</span>{{ ev.time_ranges | join('; ') }}</p>{% endif %}
                            {% if ev.get('durations') %}<p><span class="field-label">æŒç»­æ—¶é•¿ï¼š</span>{{ ev.durations | join(', ') }}</p>{% endif %}
                            {% if ev.get('frequencies') %}<p><span class="field-label">é¢‘ç‡/å‘¨æœŸæ€§ï¼š</span>{{ ev.frequencies | join(', ') }}</p>{% endif %}
                            {% if ev.get('seasonal_or_cultural_time') %}<p><span class="field-label">èŠ‚ä»¤/æ–‡åŒ–æ—¶é—´ï¼š</span>{{ ev.seasonal_or_cultural_time | join(', ') }}</p>{% endif %}
                            {% if ev.get('temporal_anchor') %}<p><span class="field-label">æ—¶é—´å‚è€ƒé”šç‚¹ï¼š</span>{{ ev.temporal_anchor }}</p>{% endif %}

                            <!-- æ¨¡ç³Šä¸å¦å®šè¡¨è¾¾ -->
                            {% if ev.get('relative_expressions') or ev.get('negated_time') or ev.get('uncertainty_modifiers') %}
                            {% if ev.get('relative_expressions') %}<p><span class="field-label">ç›¸å¯¹/æ¨¡ç³Šæ—¶é—´ï¼š</span>{{ ev.relative_expressions | join(', ') }}</p>{% endif %}
                            {% if ev.get('negated_time') %}<p><span class="field-label">è¢«å¦å®šçš„æ—¶é—´ï¼š</span>{{ ev.negated_time | join(', ') }}</p>{% endif %}
                            {% if ev.get('uncertainty_modifiers') %}<p><span class="field-label">ä¸ç¡®å®šæ€§ä¿®é¥°è¯­ï¼š</span>{{ ev.uncertainty_modifiers | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- è¯­è¨€ä¸ä¸Šä¸‹æ–‡çº¿ç´¢ -->
                            {% if ev.get('event_markers') or ev.get('tense_aspect') %}
                            {% if ev.get('event_markers') %}<p><span class="field-label">äº‹ä»¶å…³é”®è¯ï¼š</span>{{ ev.event_markers | join(', ') }}</p>{% endif %}
                            {% if ev.get('tense_aspect') %}<p><span class="field-label">æ—¶ä½“æ ‡è®°ï¼š</span>{{ ev.tense_aspect }}</p>{% endif %}
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 3. ç©ºé—´æ„ŸçŸ¥ -->
        {% if data.get('spatial') %}
        <div class="section">
            <h3>3. ç©ºé—´æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.spatial.get('summary') %}
                <p><span class="field-label">ç©ºé—´æ‘˜è¦ï¼š</span>{{ data.spatial.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç©ºé—´è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸å…³ç³»ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼Œå¸¦è¯´æ˜ï¼‰ -->
                        {% if data.spatial.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªç©ºé—´åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.spatial.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- ç©ºé—´äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.spatial.get('events') and data.spatial.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">ç©ºé—´äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.spatial.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.spatial.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒåœ°ç‚¹ä¿¡æ¯ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">é™ˆè¿°ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('places') %}<p><span class="field-label">åœ°ç‚¹ï¼š</span>{{ ev.places | join(', ') }}</p>{% endif %}
                            {% if ev.get('negated_places') %}<p><span class="field-label">è¢«å¦å®šçš„åœ°ç‚¹ï¼š</span>{{ ev.negated_places | join(', ') }}</p>{% endif %}
                            {% if ev.get('cultural_or_institutional_spaces') %}<p><span class="field-label">åˆ¶åº¦æ€§/æ–‡åŒ–ç©ºé—´ï¼š</span>{{ ev.cultural_or_institutional_spaces | join(', ') }}</p>{% endif %}

                            <!-- ç©ºé—´æè¿° -->
                            {% if ev.get('layout_descriptions') or ev.get('orientation_descriptions') %}
                            {% if ev.get('layout_descriptions') %}<p><span class="field-label">ç©ºé—´å¸ƒå±€ï¼š</span>{{ ev.layout_descriptions | join('; ') }}</p>{% endif %}
                            {% if ev.get('orientation_descriptions') %}<p><span class="field-label">æ–¹å‘/æœå‘ï¼š</span>{{ ev.orientation_descriptions | join('; ') }}</p>{% endif %}
                            {% endif %}

                            <!-- è¯­è¨€ä¸ä¸Šä¸‹æ–‡çº¿ç´¢ -->
                            {% if ev.get('spatial_event_markers') %}
                            <p><span class="field-label">äº‹ä»¶å…³é”®è¯ï¼š</span>{{ ev.spatial_event_markers | join(', ') }}</p>
                            {% endif %}

                            <!-- ç©ºé—´å…³ç³»åˆ—è¡¨ï¼ˆä½œä¸ºå­æ¨¡å—ï¼ŒæŠ˜å å±•ç¤ºï¼‰ -->
                            {% if ev.get('proximity_relations') and ev.proximity_relations %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ” å±•å¼€ç©ºé—´å…³ç³»è¯¦æƒ…ï¼ˆå…± {{ ev.proximity_relations | length }} é¡¹ï¼‰</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    {% for rel in ev.proximity_relations %}
                                    <div class="relation-item" style="padding: 8px; background: #fff0f0; border-radius: 5px; margin-bottom: 8px; font-size: 0.95em;">
                                        {% if rel.get('actor') %}<p><span class="field-label">ä¸»åŠ¨æ–¹ï¼š</span>{{ rel.actor }}</p>{% endif %}
                                        {% if rel.get('target') %}<p><span class="field-label">ç›®æ ‡æ–¹ï¼š</span>{{ rel.target }}</p>{% endif %}
                                        {% if rel.get('relation_type') %}<p><span class="field-label">å…³ç³»ç±»å‹ï¼š</span>{{ rel.relation_type }}</p>{% endif %}
                                        {% if rel.get('distance_cm') is not none %}<p><span class="field-label">è·ç¦»ï¼ˆcmï¼‰ï¼š</span>{{ rel.distance_cm }}</p>{% endif %}
                                        {% if rel.get('modifiers') %}<p><span class="field-label">ä¿®é¥°æˆåˆ†ï¼š</span>{{ rel.modifiers | join(', ') }}</p>{% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            </details>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 4. è§†è§‰æ„ŸçŸ¥ -->
        {% if data.get('visual') %}
        <div class="section">
            <h3>4. è§†è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.visual.get('summary') %}
                <p><span class="field-label">è§†è§‰æ‘˜è¦ï¼š</span>{{ data.visual.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è§†è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.visual.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªè§†è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.visual.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è§†è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.visual.get('events') and data.visual.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§†è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.visual.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.visual.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒè§‚å¯Ÿå­—æ®µï¼ˆå« salienceï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">è§‚å¯Ÿè€…ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('observed_entity') %}<p><span class="field-label">è¢«è§‚å¯Ÿå¯¹è±¡ï¼š</span>{{ ev.observed_entity }}</p>{% endif %}
                            {% if ev.get('visual_objects') %}<p><span class="field-label">å¯è§ç‰©ä½“ï¼š</span>{{ ev.visual_objects | join(', ') }}</p>{% endif %}
                            {% if ev.get('visual_attributes') %}<p><span class="field-label">è§†è§‰å±æ€§ï¼š</span>{{ ev.visual_attributes | join(', ') }}</p>{% endif %}
                            {% if ev.get('visual_actions') %}<p><span class="field-label">å¯è§åŠ¨ä½œï¼š</span>{{ ev.visual_actions | join(', ') }}</p>{% endif %}
                            {% if ev.get('gaze_target') %}<p><span class="field-label">æ³¨è§†ç›®æ ‡ï¼š</span>{{ ev.gaze_target }}</p>{% endif %}
                            {% if ev.get('eye_contact') %}<p><span class="field-label">çœ¼ç¥äº¤äº’ï¼š</span>{{ ev.eye_contact | join(', ') }}</p>{% endif %}
                            {% if ev.get('facial_cues') %}<p><span class="field-label">é¢éƒ¨çº¿ç´¢ï¼š</span>{{ ev.facial_cues | join(', ') }}</p>{% endif %}
                            {% if ev.get('negated_observations') %}<p><span class="field-label">è¢«å¦å®šçš„è§‚å¯Ÿï¼š</span>{{ ev.negated_observations | join(', ') }}</p>{% endif %}
                            {% if ev.get('salience') is not none %}<p><span class="field-label">æ˜¾è‘—æ€§ï¼š</span>{{ "%.1f"|format(ev.salience) }}</p>{% endif %}

                            <!-- æ„ŸçŸ¥æ¡ä»¶ä¸è§†çº¿é™åˆ¶ï¼ˆåŸâ€œç¯å¢ƒä¸çº¦æŸæ¡ä»¶â€ï¼‰ -->
                            {% if ev.get('lighting_conditions') or ev.get('visual_medium') or ev.get('occlusion_or_obstruction') %}
                            {% if ev.get('lighting_conditions') %}<p><span class="field-label">å…‰ç…§æ¡ä»¶ï¼š</span>{{ ev.lighting_conditions | join(', ') }}</p>{% endif %}
                            {% if ev.get('visual_medium') %}<p><span class="field-label">è§†è§‰åª’ä»‹ï¼š</span>{{ ev.visual_medium | join(', ') }}</p>{% endif %}
                            {% if ev.get('occlusion_or_obstruction') %}<p><span class="field-label">é®æŒ¡/é˜»ç¢ï¼š</span>{{ ev.occlusion_or_obstruction | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ä¸è¯­ä¹‰ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 5. å¬è§‰æ„ŸçŸ¥ -->
        {% if data.get('auditory') %}
        <div class="section">
            <h3>5. å¬è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.auditory.get('summary') %}
                <p><span class="field-label">å¬è§‰æ‘˜è¦ï¼š</span>{{ data.auditory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å¬è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼Œå¸¦è¯´æ˜ï¼‰ -->
                        {% if data.auditory.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå¬è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.auditory.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å¬è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.auditory.get('events') and data.auditory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å¬è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.auditory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.auditory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå¬è§‰è¦ç´  -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">æ„ŸçŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('sound_source') %}<p><span class="field-label">å£°æºï¼š</span>{{ ev.sound_source }}</p>{% endif %}
                            {% if ev.get('auditory_content') %}<p><span class="field-label">å¬è§‰å†…å®¹ï¼š</span>{{ ev.auditory_content | join(', ') }}</p>{% endif %}
                            {% if ev.get('is_primary_focus') is not none %}
                                <p><span class="field-label">æ˜¯å¦ä¸ºå¬è§‰ç„¦ç‚¹ï¼š</span>{{ 'æ˜¯' if ev.is_primary_focus else 'å¦' }}</p>
                            {% endif %}

                            <!-- å£°éŸ³ç‰¹å¾ -->
                            {% if ev.get('prosody_cues') or ev.get('pause_description') or ev.get('intensity') is not none %}
                            {% if ev.get('prosody_cues') %}<p><span class="field-label">è¯­è°ƒ/éŸµå¾‹ç‰¹å¾ï¼š</span>{{ ev.prosody_cues | join(', ') }}</p>{% endif %}
                            {% if ev.get('pause_description') %}<p><span class="field-label">åœé¡¿æè¿°ï¼š</span>{{ ev.pause_description }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0 é‡åŒ–å€¼ï¼‰</p>
                            {% endif %}
                            {% endif %}

                            <!-- ç¯å¢ƒä¸åª’ä»‹ -->
                            {% if ev.get('auditory_medium') or ev.get('background_sounds') or ev.get('nonverbal_sounds') %}
                            {% if ev.get('auditory_medium') %}<p><span class="field-label">å¬è§‰åª’ä»‹ï¼š</span>{{ ev.auditory_medium | join(', ') }}</p>{% endif %}
                            {% if ev.get('background_sounds') %}<p><span class="field-label">èƒŒæ™¯å£°éŸ³ï¼š</span>{{ ev.background_sounds | join(', ') }}</p>{% endif %}
                            {% if ev.get('nonverbal_sounds') %}<p><span class="field-label">éè¯­è¨€å£°éŸ³ï¼š</span>{{ ev.nonverbal_sounds | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- å¦å®šè§‚å¯Ÿ -->
                            {% if ev.get('negated_observations') %}
                            <p><span class="field-label">å¦å®šè§‚å¯Ÿï¼š</span>{{ ev.negated_observations | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 6. å—…è§‰æ„ŸçŸ¥ -->
        {% if data.get('olfactory') %}
        <div class="section">
            <h3>6. å—…è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.olfactory.get('summary') %}
                <p><span class="field-label">å—…è§‰æ‘˜è¦ï¼š</span>{{ data.olfactory.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å—…è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå§‹ç»ˆæ˜¾ç¤º + è¯´æ˜ï¼‰ -->
                        {% if data.olfactory.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå—…è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.olfactory.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å—…è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.olfactory.get('events') and data.olfactory.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å—…è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.olfactory.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.olfactory.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒæ°”å‘³è¦ç´  -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">æ„ŸçŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('odor_source') %}<p><span class="field-label">æ°”å‘³æ¥æºï¼š</span>{{ ev.odor_source }}</p>{% endif %}
                            {% if ev.get('odor_descriptors') %}<p><span class="field-label">æ°”å‘³æè¿°è¯ï¼š</span>{{ ev.odor_descriptors | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0 é‡åŒ–å€¼ï¼‰</p>
                            {% endif %}

                            <!-- æ°”å‘³æƒ…æ„Ÿä¸è¯„ä»· -->
                            {% if ev.get('odor_valence') %}
                            <p><span class="field-label">æƒ…æ„Ÿå€¾å‘ï¼š</span>{{ ev.odor_valence | join(', ') }}</p>
                            {% endif %}

                            <!-- æ¥æºåˆ†ç±»ä¸è¡Œä¸ºå“åº” -->
                            {% if ev.get('odor_source_category') or ev.get('olfactory_actions') %}
                            {% if ev.get('odor_source_category') %}<p><span class="field-label">æ¥æºç±»åˆ«ï¼š</span>{{ ev.odor_source_category | join(', ') }}</p>{% endif %}
                            {% if ev.get('olfactory_actions') %}<p><span class="field-label">å—…è§‰ç›¸å…³åŠ¨ä½œï¼š</span>{{ ev.olfactory_actions | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- å¦å®šè§‚å¯Ÿ -->
                            {% if ev.get('negated_observations') %}
                            <p><span class="field-label">å¦å®šè§‚å¯Ÿï¼š</span>{{ ev.negated_observations | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼Œè¯­ä¹‰å·²å‰ç½®ï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 7. è§¦è§‰æ„ŸçŸ¥ -->
        {% if data.get('tactile') %}
        <div class="section">
            <h3>7. è§¦è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.tactile.get('summary') %}
                <p><span class="field-label">è§¦è§‰æ‘˜è¦ï¼š</span>{{ data.tactile.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è§¦è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå¸¦è¯´æ˜ï¼‰ -->
                        {% if data.tactile.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªè§¦è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.tactile.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è§¦è§‰äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.tactile.get('events') and data.tactile.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è§¦è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.tactile.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.tactile.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒæ¥è§¦å…³ç³» -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">æ„ŸçŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('contact_initiator') %}<p><span class="field-label">æ¥è§¦å‘èµ·æ–¹ï¼š</span>{{ ev.contact_initiator }}</p>{% endif %}
                            {% if ev.get('contact_target') %}<p><span class="field-label">æ¥è§¦å¯¹è±¡ï¼š</span>{{ ev.contact_target }}</p>{% endif %}
                            {% if ev.get('body_part') %}<p><span class="field-label">èº«ä½“éƒ¨ä½ï¼š</span>{{ ev.body_part }}</p>{% endif %}
                            {% if ev.get('tactile_descriptors') %}<p><span class="field-label">è§¦è§‰æè¿°è¯ï¼š</span>{{ ev.tactile_descriptors | join(', ') }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0 é‡åŒ–å€¼ï¼‰</p>
                            {% endif %}

                            <!-- ç‰©ç†å±æ€§ç»´åº¦ï¼ˆè§¦è§‰æ ¸å¿ƒç‰¹è‰²ï¼ï¼‰ -->
                            {% if ev.get('texture') or ev.get('temperature') or ev.get('pressure') or ev.get('moisture') or ev.get('vibration') or ev.get('motion') or ev.get('pain') or ev.get('contact') %}
                            {% if ev.get('texture') %}<p><span class="field-label">è´¨åœ°ç‰¹å¾ï¼š</span>{{ ev.texture | join(', ') }}</p>{% endif %}
                            {% if ev.get('temperature') %}<p><span class="field-label">æ¸©åº¦ç‰¹å¾ï¼š</span>{{ ev.temperature | join(', ') }}</p>{% endif %}
                            {% if ev.get('pressure') %}<p><span class="field-label">å‹åŠ›ç‰¹å¾ï¼š</span>{{ ev.pressure | join(', ') }}</p>{% endif %}
                            {% if ev.get('moisture') %}<p><span class="field-label">æ¹¿åº¦ç‰¹å¾ï¼š</span>{{ ev.moisture | join(', ') }}</p>{% endif %}
                            {% if ev.get('vibration') %}<p><span class="field-label">éœ‡åŠ¨ç‰¹å¾ï¼š</span>{{ ev.vibration | join(', ') }}</p>{% endif %}
                            {% if ev.get('motion') %}<p><span class="field-label">åŠ¨æ€è§¦è§‰ï¼š</span>{{ ev.motion | join(', ') }}</p>{% endif %}
                            {% if ev.get('pain') %}<p><span class="field-label">ç–¼ç—›æè¿°ï¼š</span>{{ ev.pain | join(', ') }}</p>{% endif %}
                            {% if ev.get('contact') %}<p><span class="field-label">æ¥è§¦æ–¹å¼/å­˜åœ¨ï¼š</span>{{ ev.contact | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- æƒ…æ„Ÿä¸æ„å›¾ -->
                            {% if ev.get('tactile_intent_or_valence') %}
                            <p><span class="field-label">æƒ…æ„Ÿæˆ–æ„å›¾ï¼š</span>{{ ev.tactile_intent_or_valence | join(', ') }}</p>
                            {% endif %}

                            <!-- å¦å®šè§‚å¯Ÿ -->
                            {% if ev.get('negated_observations') %}
                            <p><span class="field-label">å¦å®šè§‚å¯Ÿï¼š</span>{{ ev.negated_observations | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 8. å‘³è§‰æ„ŸçŸ¥ -->
        {% if data.get('gustatory') %}
        <div class="section">
            <h3>8. å‘³è§‰æ„ŸçŸ¥</h3>
            <div class="subsection">
            <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
            {% if data.gustatory.get('summary') %}
            <p><span class="field-label">å‘³è§‰æ‘˜è¦ï¼š</span>{{ data.gustatory.summary }}</p>
            {% endif %}

            <!-- æŠ˜å è¯¦æƒ… -->
            <details class="details-block">
                <summary>ğŸ” å±•å¼€å‘³è§‰è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                <div class="details-content">

                    <!-- å…¨å±€åŸæ–‡è¯æ®ï¼ˆå¸¦è¯´æ˜ï¼‰ -->
                    {% if data.gustatory.get('evidence') %}
                    <p>
                        <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                        <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä¸ªå‘³è§‰åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                        {% for frag in data.gustatory.evidence %}
                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                        {% endfor %}
                    </p>
                    {% endif %}

                    <!-- å‘³è§‰äº‹ä»¶åˆ—è¡¨ -->
                    {% if data.gustatory.get('events') and data.gustatory.events %}
                    <h4 style="margin-top: 16px; margin-bottom: 10px;">å‘³è§‰äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.gustatory.events | length }} é¡¹ï¼‰</h4>
                    {% for ev in data.gustatory.events %}
                    <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                        <!-- æ ¸å¿ƒæ‘„å…¥å…³ç³» -->
                        {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                        {% if ev.get('experiencer') %}<p><span class="field-label">æ„ŸçŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                        {% if ev.get('contact_initiator') %}<p><span class="field-label">æ‘„å…¥å‘èµ·æ–¹ï¼š</span>{{ ev.contact_initiator }}</p>{% endif %}
                        {% if ev.get('taste_source') %}<p><span class="field-label">å‘³é“æ¥æºï¼š</span>{{ ev.taste_source }}</p>{% endif %}
                        {% if ev.get('body_part') %}<p><span class="field-label">æ„Ÿå—éƒ¨ä½ï¼š</span>{{ ev.body_part }}</p>{% endif %}
                        {% if ev.get('taste_descriptors') %}<p><span class="field-label">å‘³è§‰æè¿°è¯ï¼š</span>{{ ev.taste_descriptors | join(', ') }}</p>{% endif %}
                        {% if ev.get('intensity') is not none %}
                            <p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0 é‡åŒ–å€¼ï¼‰</p>
                        {% endif %}

                        <!-- åŸºç¡€å‘³å‹ï¼ˆç»å…¸äº”å‘³ï¼‰ -->
                        {% if ev.get('sweet') or ev.get('salty') or ev.get('sour') or ev.get('bitter') or ev.get('umami') %}
                        {% if ev.get('sweet') %}<p><span class="field-label">ç”œå‘³ï¼š</span>{{ ev.sweet | join(', ') }}</p>{% endif %}
                        {% if ev.get('salty') %}<p><span class="field-label">å’¸å‘³ï¼š</span>{{ ev.salty | join(', ') }}</p>{% endif %}
                        {% if ev.get('sour') %}<p><span class="field-label">é…¸å‘³ï¼š</span>{{ ev.sour | join(', ') }}</p>{% endif %}
                        {% if ev.get('bitter') %}<p><span class="field-label">è‹¦å‘³ï¼š</span>{{ ev.bitter | join(', ') }}</p>{% endif %}
                        {% if ev.get('umami') %}<p><span class="field-label">é²œå‘³ï¼š</span>{{ ev.umami | join(', ') }}</p>{% endif %}
                        {% endif %}

                        <!-- æ‰©å±•é£å‘³ä¸ä¸‰å‰ç¥ç»åˆºæ¿€ -->
                        {% if ev.get('spicy') or ev.get('astringent') or ev.get('fatty') or ev.get('metallic') or ev.get('chemical') or ev.get('thermal') %}
                        {% if ev.get('spicy') %}<p><span class="field-label">è¾£/åˆºæ¿€æ„Ÿï¼š</span>{{ ev.spicy | join(', ') }}</p>{% endif %}
                        {% if ev.get('astringent') %}<p><span class="field-label">æ¶©å‘³ï¼š</span>{{ ev.astringent | join(', ') }}</p>{% endif %}
                        {% if ev.get('fatty') %}<p><span class="field-label">æ²¹è„‚æ„Ÿï¼š</span>{{ ev.fatty | join(', ') }}</p>{% endif %}
                        {% if ev.get('metallic') %}<p><span class="field-label">é‡‘å±å‘³ï¼š</span>{{ ev.metallic | join(', ') }}</p>{% endif %}
                        {% if ev.get('chemical') %}<p><span class="field-label">åŒ–å­¦å¼‚å‘³ï¼š</span>{{ ev.chemical | join(', ') }}</p>{% endif %}
                        {% if ev.get('thermal') %}<p><span class="field-label">æ¸…å‡‰/ç¼çƒ­æ„Ÿï¼š</span>{{ ev.thermal | join(', ') }}</p>{% endif %}
                        {% endif %}

                        <!-- æƒ…æ„Ÿä¸æ„å›¾ -->
                        {% if ev.get('intent_or_valence') %}
                        <p><span class="field-label">æƒ…æ„Ÿæˆ–æ„å›¾ï¼š</span>{{ ev.intent_or_valence | join(', ') }}</p>
                        {% endif %}

                        <!-- å¦å®šè§‚å¯Ÿ -->
                        {% if ev.get('negated_observations') %}
                        <p><span class="field-label">å¦å®šè§‚å¯Ÿï¼š</span>{{ ev.negated_observations | join(', ') }}</p>
                        {% endif %}

                        <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                        {% if ev.get('evidence') %}
                        <details class="details-block" style="margin-top: 10px;">
                            <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                            <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                    {% for frag in ev.evidence %}
                                    <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                    {% endfor %}
                                </p>
                            </div>
                        </details>
                        {% endif %}

                    </div>
                    {% endfor %}
                    {% endif %}

                </div>
            </details>
            </div>
        </div>
        {% endif %}

        <!-- 9. å†…æ„Ÿå— -->
        {% if data.get('interoceptive') %}
        <div class="section">
            <h3>9. å†…æ„Ÿå—</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.interoceptive.get('summary') %}
                <p><span class="field-label">å†…æ„Ÿå—æ‘˜è¦ï¼š</span>{{ data.interoceptive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å†…æ„Ÿå—è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.interoceptive.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“å†…æ„Ÿå—åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.interoceptive.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- å†…æ„Ÿå—äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.interoceptive.get('events') and data.interoceptive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å†…æ„Ÿå—äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.interoceptive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.interoceptive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">æ„ŸçŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('body_part') %}<p><span class="field-label">æ„Ÿå—éƒ¨ä½ï¼š</span>{{ ev.body_part }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">æ„ŸçŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0 é‡åŒ–å€¼ï¼‰</p>
                            {% endif %}

                            <!-- é€šç”¨èº«ä½“æ„Ÿè§‰ï¼ˆéåˆ†ç±»æè¿°ï¼‰ -->
                            {% if ev.get('body_sensation') %}
                            <p><span class="field-label">éç‰¹å¼‚æ€§æè¿°ï¼š</span>{{ ev.body_sensation | join(', ') }}</p>
                            {% endif %}

                            <!-- ç”Ÿç†ç³»ç»Ÿç»´åº¦ï¼ˆåˆ†ç»„å‘ˆç°ï¼‰ -->
                            {% set has_systemic = ev.get('cardiac') or ev.get('respiratory') or ev.get('gastrointestinal') or ev.get('thermal') or ev.get('muscular') or ev.get('visceral_pressure') %}
                            {% if has_systemic %}
                            {% if ev.get('cardiac') %}<p><span class="field-label">å¿ƒæ‚¸/å¿ƒè·³æ„Ÿï¼š</span>{{ ev.cardiac | join(', ') }}</p>{% endif %}
                            {% if ev.get('respiratory') %}<p><span class="field-label">å‘¼å¸æ„Ÿï¼š</span>{{ ev.respiratory | join(', ') }}</p>{% endif %}
                            {% if ev.get('gastrointestinal') %}<p><span class="field-label">èƒƒè‚ æ„Ÿï¼š</span>{{ ev.gastrointestinal | join(', ') }}</p>{% endif %}
                            {% if ev.get('thermal') %}<p><span class="field-label">ä½“æ¸©æ„Ÿï¼š</span>{{ ev.thermal | join(', ') }}</p>{% endif %}
                            {% if ev.get('muscular') %}<p><span class="field-label">è‚Œè‚‰æ„Ÿï¼š</span>{{ ev.muscular | join(', ') }}</p>{% endif %}
                            {% if ev.get('visceral_pressure') %}<p><span class="field-label">å‹è¿«æ„Ÿï¼š</span>{{ ev.visceral_pressure | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- ç¥ç»ä¸ç¨³æ€ç›¸å…³æ„Ÿå— -->
                            {% set has_neuro_homeostatic = ev.get('dizziness') or ev.get('nausea') or ev.get('fatigue') or ev.get('thirst_hunger') %}
                            {% if has_neuro_homeostatic %}
                            {% if ev.get('dizziness') %}<p><span class="field-label">çœ©æ™•/å¤±è¡¡æ„Ÿï¼š</span>{{ ev.dizziness | join(', ') }}</p>{% endif %}
                            {% if ev.get('nausea') %}<p><span class="field-label">æ¶å¿ƒ/åèƒƒæ„Ÿï¼š</span>{{ ev.nausea | join(', ') }}</p>{% endif %}
                            {% if ev.get('fatigue') %}<p><span class="field-label">ç–²æƒ«/è™šè„±æ„Ÿï¼š</span>{{ ev.fatigue | join(', ') }}</p>{% endif %}
                            {% if ev.get('thirst_hunger') %}<p><span class="field-label">é¥¥æ¸´æ„Ÿï¼š</span>{{ ev.thirst_hunger | join(', ') }}</p>{% endif %}
                            {% endif %}

                            <!-- æƒ…æ„Ÿ/æ„å›¾å€¾å‘ -->
                            {% if ev.get('intent_or_valence') %}
                            <p><span class="field-label">æƒ…æ„Ÿæˆ–æ„å›¾ï¼š</span>{{ ev.intent_or_valence | join(', ') }}</p>
                            {% endif %}

                            <!-- å¦å®šè§‚å¯Ÿ -->
                            {% if ev.get('negated_observations') %}
                            <p><span class="field-label">å¦å®šå†…å®¹ï¼š</span>{{ ev.negated_observations | join(', ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 10. è®¤çŸ¥è¿‡ç¨‹ -->
        {% if data.get('cognitive') %}
        <div class="section">
            <h3>10. è®¤çŸ¥è¿‡ç¨‹</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.cognitive.get('summary') %}
                <p><span class="field-label">è®¤çŸ¥æ‘˜è¦ï¼š</span>{{ data.cognitive.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€è®¤çŸ¥è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.cognitive.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“è®¤çŸ¥åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.cognitive.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- è®¤çŸ¥äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.cognitive.get('events') and data.cognitive.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">è®¤çŸ¥äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.cognitive.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.cognitive.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">è®¤çŸ¥ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('target_entity') %}<p><span class="field-label">æ€ç»´ã€æƒ³æ³•ã€å¿µå¤´ï¼š</span>{{ ev.target_entity }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">è®¤çŸ¥å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0ï¼Œè¡¨ç¡®ä¿¡åº¦æˆ–è´Ÿè·ï¼‰</p>
                            {% endif %}

                            <!-- åŸå§‹æ˜¾æ€§æ€ç»´ï¼ˆä¿ç•™ï¼Œä½œä¸ºå…œåº•ï¼‰ -->
                            {% if ev.get('explicit_thought') %}
                            <p><span class="field-label">æœªåˆ†ç±»æ€ç»´æ–‡æœ¬ï¼š</span>{{ ev.explicit_thought | join('; ') }}</p>
                            {% endif %}

                            <!-- åŸºç¡€è®¤çŸ¥åŠŸèƒ½ -->
                            {% set has_basic = ev.get('belief') or ev.get('memory_recall') or ev.get('intention') %}
                            {% if has_basic %}
                            {% if ev.get('belief') %}<p><span class="field-label">ä¿¡å¿µï¼š</span>{{ ev.belief | join('; ') }}</p>{% endif %}
                            {% if ev.get('intention') %}<p><span class="field-label">æ„å›¾ï¼š</span>{{ ev.intention | join('; ') }}</p>{% endif %}
                            {% if ev.get('memory_recall') %}<p><span class="field-label">è®°å¿†æå–ï¼š</span>{{ ev.memory_recall | join('; ') }}</p>{% endif %}
                            {% endif %}

                            <!-- é«˜é˜¶è®¤çŸ¥åŠŸèƒ½ -->
                            {% set has_higher = ev.get('inference') or ev.get('problem_solving') or ev.get('metacognition') %}
                            {% if has_higher %}
                            {% if ev.get('inference') %}<p><span class="field-label">æ¨ç†ï¼š</span>{{ ev.inference | join('; ') }}</p>{% endif %}
                            {% if ev.get('problem_solving') %}<p><span class="field-label">é—®é¢˜è§£å†³æ€è·¯ï¼š</span>{{ ev.problem_solving | join('; ') }}</p>{% endif %}
                            {% if ev.get('metacognition') %}<p><span class="field-label">å…ƒè®¤çŸ¥ï¼ˆå¯¹æ€ç»´çš„åæ€ï¼‰ï¼š</span>{{ ev.metacognition | join('; ') }}</p>{% endif %}
                            {% endif %}

                            <!-- æƒ…æ„Ÿè€¦åˆçš„è®¤çŸ¥ -->
                            {% set has_affective = ev.get('evaluation') or ev.get('doubt_or_uncertainty') %}
                            {% if has_affective %}
                            {% if ev.get('evaluation') %}<p><span class="field-label">ä»·å€¼åˆ¤æ–­ï¼š</span>{{ ev.evaluation | join('; ') }}</p>{% endif %}
                            {% if ev.get('doubt_or_uncertainty') %}<p><span class="field-label">æ€€ç–‘/ä¸ç¡®å®šï¼š</span>{{ ev.doubt_or_uncertainty | join('; ') }}</p>{% endif %}
                            {% endif %}

                            <!-- å¦å®šè®¤çŸ¥ -->
                            {% if ev.get('negated_cognitions') %}
                            <p><span class="field-label">å¦å®šå†…å®¹ï¼š</span>{{ ev.negated_cognitions | join('; ') }}</p>
                            {% endif %}

                            <!-- è®¤çŸ¥æƒ…æ„Ÿå€¾å‘ -->
                            {% if ev.get('cognitive_valence') %}
                            <p><span class="field-label">æƒ…æ„Ÿè‰²å½©ï¼š</span>{{ ev.cognitive_valence | join('; ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 11. èº¯ä½“åŒ–è¡¨ç° -->
        {% if data.get('bodily') %}
        <div class="section">
            <h3>11. èº¯ä½“åŒ–è¡¨ç°</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.bodily.get('summary') %}
                <p><span class="field-label">èº¯ä½“åŒ–æ‘˜è¦ï¼š</span>{{ data.bodily.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€èº¯ä½“åŒ–è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.bodily.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“èº¯ä½“åŒ–åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.bodily.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- èº¯ä½“åŒ–äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.bodily.get('events') and data.bodily.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">èº¯ä½“åŒ–äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.bodily.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.bodily.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('semantic_notation') %}<p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>{% endif %}
                            {% if ev.get('experiencer') %}<p><span class="field-label">è¡Œä¸ºä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>{% endif %}
                            {% if ev.get('observer') %}<p><span class="field-label">è§‚å¯Ÿè€…ï¼š</span>{{ ev.observer }}</p>{% endif %}
                            {% if ev.get('intensity') is not none %}
                                <p><span class="field-label">è¡¨ç°å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0ï¼Œè¡¨æ˜¾è‘—ç¨‹åº¦ï¼‰</p>
                            {% endif %}

                            <!-- å§¿æ€ä¸è¿åŠ¨ -->
                            {% set has_posture_motion = ev.get('posture') or ev.get('movement_direction') %}
                            {% if has_posture_motion %}
                            {% if ev.get('posture') %}<p><span class="field-label">é™æ€å§¿æ€ï¼š</span>{{ ev.posture }}</p>{% endif %}
                            {% if ev.get('movement_direction') %}<p><span class="field-label">è¿åŠ¨æ–¹å‘/è¶‹åŠ¿ï¼š</span>{{ ev.movement_direction }}</p>{% endif %}
                            {% endif %}

                            <!-- å¤–æ˜¾è¡Œä¸ºç³»ç»Ÿ -->
                            {% set has_expressive = ev.get('facial_expression') or ev.get('vocal_behavior') or ev.get('motor_behavior') %}
                            {% if has_expressive %}
                            {% if ev.get('facial_expression') %}<p><span class="field-label">é¢éƒ¨è¡¨æƒ…ï¼š</span>{{ ev.facial_expression | join('; ') }}</p>{% endif %}
                            {% if ev.get('vocal_behavior') %}<p><span class="field-label">å£°éŸ³è¡¨ç°ï¼š</span>{{ ev.vocal_behavior | join('; ') }}</p>{% endif %}
                            {% if ev.get('motor_behavior') %}<p><span class="field-label">åŠ¨ä½œè¡Œä¸ºï¼š</span>{{ ev.motor_behavior | join('; ') }}</p>{% endif %}
                            {% endif %}

                            <!-- è‡ªä¸»ç¥ç»ç³»ç»Ÿååº” -->
                            {% if ev.get('autonomic_signs') %}
                            <p><span class="field-label">ç”Ÿç†å”¤é†’è¡¨ç°ï¼š</span>{{ ev.autonomic_signs | join('; ') }}</p>
                            {% endif %}

                            <!-- åº”æ¿€é˜²å¾¡ååº” -->
                            {% if ev.get('freeze_or_faint') %}
                            <p><span class="field-label">å†»ç»“/æ™•å¥ç±»ååº”ï¼š</span>{{ ev.freeze_or_faint | join('; ') }}</p>
                            {% endif %}

                            <!-- åŸå§‹æœªåˆ†ç±»è¡Œä¸ºï¼ˆå…œåº•ï¼‰ -->
                            {% if ev.get('observable_behavior') %}
                            <p><span class="field-label">åŸå§‹å¯è§‚æµ‹è¡Œä¸ºï¼š</span>{{ ev.observable_behavior | join('; ') }}</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 12. æƒ…æ„ŸçŠ¶æ€ -->
        {% if data.get('emotional') %}
        <div class="section">
            <h3>12. æƒ…æ„ŸçŠ¶æ€</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.emotional.get('summary') %}
                <p><span class="field-label">æƒ…æ„Ÿæ‘˜è¦ï¼š</span>{{ data.emotional.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æƒ…æ„Ÿè§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.emotional.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“æƒ…æ„Ÿåˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.emotional.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æƒ…æ„Ÿäº‹ä»¶åˆ—è¡¨ -->
                        {% if data.emotional.get('events') and data.emotional.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æƒ…æ„Ÿäº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.emotional.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.emotional.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">æƒ…ç»ªä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('emotion_labels') %}
                            <p><span class="field-label">æƒ…ç»ªæ ‡ç­¾ï¼š</span>{{ ev.emotion_labels | join('; ') }}</p>
                            {% endif %}

                            <!-- æƒ…æ„Ÿè¡¨è¾¾æ¨¡å¼ï¼ˆè§„èŒƒå–å€¼ï¼‰ -->
                            {% if ev.get('expression_mode') %}
                            <p><span class="field-label">è¡¨è¾¾æ¨¡å¼ï¼š</span>
                                <span style="font-family: monospace; background: #f8f9fa; padding: 2px 6px; border-radius: 3px;">
                                    {{ ev.expression_mode }}
                                </span>
                                <small style="color: #7f8c8d; margin-left: 6px;">
                                    {% if ev.expression_mode == 'self_report' %}
                                        ï¼ˆç¬¬ä¸€äººç§°è‡ªè¿°ï¼‰
                                    {% elif ev.expression_mode == 'observed_behavior' %}
                                        ï¼ˆä»–äººè§‚å¯Ÿåˆ°çš„è¡Œä¸ºï¼‰
                                    {% elif ev.expression_mode == 'narrator_attribution' %}
                                        ï¼ˆå™è¿°è€…å½’å› ï¼‰
                                    {% elif ev.expression_mode == 'explicit' %}
                                        ï¼ˆç›´æ¥é™ˆè¿°ï¼‰
                                    {% elif ev.expression_mode == 'implicit' %}
                                        ï¼ˆé—´æ¥æš—ç¤ºï¼šè¡Œä¸º/èº¯ä½“/ç¯å¢ƒçº¿ç´¢ï¼‰
                                    {% elif ev.expression_mode == 'projected' %}
                                        ï¼ˆæƒ…ç»ªæŠ•å°„è‡³ä»–äººï¼‰
                                    {% else %}
                                        ï¼ˆ{{ ev.expression_mode }}ï¼‰
                                    {% endif %}
                                </small>
                            </p>
                            {% endif %}

                            <!-- æƒ…æ„Ÿç»´åº¦ç³»ç»Ÿï¼ˆå‚ç›´æ’åˆ—ï¼Œç»Ÿä¸€æ ¼å¼ï¼‰ -->
                            {% if ev.get('valence') is not none %}
                            <p><span class="field-label">æ•ˆä»·ï¼ˆValenceï¼‰ï¼š</span>{{ "%.1f"|format(ev.valence) }}ï¼ˆ-1=è´Ÿå‘ï¼Œ0=ä¸­æ€§ï¼Œ+1=æ­£å‘ï¼‰</p>
                            {% endif %}
                            {% if ev.get('arousal') is not none %}
                            <p><span class="field-label">å”¤é†’åº¦ï¼ˆArousalï¼‰ï¼š</span>{{ "%.1f"|format(ev.arousal) }}ï¼ˆ0=å¹³é™ï¼Œ1=æ¿€åŠ¨ï¼‰</p>
                            {% endif %}
                            {% if ev.get('intensity') is not none %}
                            <p><span class="field-label">ä¸»è§‚å¼ºåº¦ï¼š</span>{{ "%.1f"|format(ev.intensity) }}ï¼ˆ0.0â€“1.0ï¼Œè¡¨æƒ…ç»ªå¼ºçƒˆç¨‹åº¦ï¼‰</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ® -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 13. ç¤¾ä¼šå…³ç³» -->
        {% if data.get('social_relation') %}
        <div class="section">
            <h3>13. ç¤¾ä¼šå…³ç³»</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.social_relation.get('summary') %}
                <p><span class="field-label">å…³ç³»æ‘˜è¦ï¼š</span>{{ data.social_relation.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€ç¤¾ä¼šå…³ç³»è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶ç»†èŠ‚ï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.social_relation.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“å…³ç³»åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.social_relation.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- ç¤¾ä¼šå…³ç³»äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.social_relation.get('events') and data.social_relation.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">å…³ç³»äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.social_relation.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.social_relation.events %}
                        <div class="relation-item" style="padding: 10px; background: #f9f9f9; border-radius: 6px; margin-bottom: 12px;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            <!-- å…³ç³»æ–¹å‘æ€§å¤„ç† -->
                            {% if ev.get('source') and ev.get('target') %}
                            <p><span class="field-label">å…³ç³»ä¸»ä½“ â†’ å¯¹è±¡ï¼š</span><strong>{{ ev.source }}</strong> â†’ <strong>{{ ev.target }}</strong></p>
                            {% elif ev.get('participants') %}
                            <p><span class="field-label">å‚ä¸è€…ï¼š</span>{{ ev.participants | join('; ') }}</p>
                            {% endif %}

                            <!-- è‡ªç„¶è¯­è¨€å…³ç³»ç±»å‹ -->
                            {% if ev.get('relation_type') %}
                            <p><span class="field-label">å…³ç³»ç±»å‹ï¼š</span>{{ ev.relation_type }}</p>
                            {% endif %}

                            <!-- ç½®ä¿¡åº¦ï¼ˆæ ¼å¼ä¸è®¤çŸ¥å¼ºåº¦ä¸€è‡´ï¼‰ -->
                            {% if ev.get('confidence') is not none %}
                            <p><span class="field-label">åˆ¤æ–­ç½®ä¿¡åº¦ï¼š</span>{{ "%.1f"|format(ev.confidence) }}ï¼ˆ0.0â€“1.0ï¼Œè¡¨ç¡®ä¿¡ç¨‹åº¦ï¼‰</p>
                            {% endif %}

                            <!-- äº‹ä»¶çº§è¯æ®ï¼ˆä»… evidenceï¼‰ -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬äº‹ä»¶ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f0f8ff; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">äº‹ä»¶è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 14. åˆç†æ¨æ¼” -->
        {% if data.get('inference') %}
        <div class="section">
            <h3>14. åˆç†æ¨æ¼”</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                {% if data.inference.get('summary') %}
                <p><span class="field-label">æ¨æ¼”æ‘˜è¦ï¼š</span>{{ data.inference.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ¨æ¼”è§£æè¯¦æƒ…ï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€åŸæ–‡è¯æ® -->
                        {% if data.inference.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            <small style="color: #666; font-style: italic;">ï¼ˆæ”¯æ’‘æ•´ä½“æ¨æ¼”åˆ¤æ–­çš„åŸå§‹æ–‡æœ¬ç‰‡æ®µï¼‰</small><br>
                            {% for frag in data.inference.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- æ¨æ¼”äº‹ä»¶åˆ—è¡¨ -->
                        {% if data.inference.get('events') and data.inference.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ¨æ¼”äº‹ä»¶è¯¦æƒ…ï¼ˆå…± {{ data.inference.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.inference.events %}
                        <div class="relation-item" style="padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid #9b59b6;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}

                            <!-- æ¨ç†ä¸»ä½“ä¸ç»“è®º -->
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">æ¨æ¼”ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}
                            {% if ev.get('inferred_proposition') %}
                            <p><span class="field-label">æ¨æ¼”ç»“è®ºï¼š</span>{{ ev.inferred_proposition }}</p>
                            {% endif %}

                            <!-- æ¨ç†ç±»å‹ï¼ˆè§„èŒƒå–å€¼ï¼‰ -->
                            {% if ev.get('inference_type') %}
                            <p><span class="field-label">æ¨ç†ç±»å‹ï¼š</span>
                                <span style="font-family: monospace; background: #eef2f7; padding: 2px 6px; border-radius: 3px;">
                                    {{ ev.inference_type }}
                                </span>
                                <small style="color: #7f8c8d; margin-left: 6px;">
                                    {% if ev.inference_type == 'causal' %}ï¼ˆå› æœæ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'temporal' %}ï¼ˆæ—¶åºæ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'intentional' %}ï¼ˆæ„å›¾æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'belief' %}ï¼ˆä¿¡å¿µæ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'contradiction' %}ï¼ˆçŸ›ç›¾æ£€æµ‹ï¼‰
                                    {% elif ev.inference_type == 'consistency_check' %}ï¼ˆä¸€è‡´æ€§æ ¡éªŒï¼‰
                                    {% elif ev.inference_type == 'counterfactual' %}ï¼ˆåäº‹å®æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'abductive' %}ï¼ˆæº¯å› æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'normative' %}ï¼ˆè§„èŒƒæ€§æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'social_attribution' %}ï¼ˆç¤¾ä¼šå½’å› ï¼‰
                                    {% elif ev.inference_type == 'state_transition' %}ï¼ˆçŠ¶æ€è½¬ç§»æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'predictive' %}ï¼ˆé¢„æµ‹æ€§æ¨æ–­ï¼‰
                                    {% elif ev.inference_type == 'analogical' %}ï¼ˆç±»æ¯”æ¨æ–­ï¼‰
                                    {% else %}ï¼ˆæœªçŸ¥ç±»å‹ï¼š{{ ev.inference_type }}ï¼‰
                                    {% endif %}
                                </small>
                            </p>
                            {% endif %}

                            <!-- é”šç‚¹ï¼šé“¾æ¥åº•å±‚æ„ŸçŸ¥äº‹ä»¶ -->
                            {% if ev.get('anchor_points') %}
                            <p>
                                <span class="field-label">æ„ŸçŸ¥é”šç‚¹ï¼š</span>
                                <small style="color: #666;">ï¼ˆå¼•ç”¨çš„åº•å±‚äº‹ä»¶è¯­ä¹‰æ ‡è¯†ï¼‰</small><br>
                                <code>{{ ev.anchor_points | join('; ') }}</code>
                            </p>
                            {% endif %}

                            <!-- å…ƒå±æ€§ï¼šææ€§ã€æ¨¡æ€ã€èŒƒå›´ -->
                            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; font-size: 0.95em; color: #555;">
                                {% if ev.get('polarity') %}
                                <div>
                                    <span class="field-label">å‘½é¢˜ææ€§ï¼š</span>
                                    {% if ev.polarity == 'positive' %}
                                        <span style="color: #27ae60;">ç§¯æ</span>
                                    {% elif ev.polarity == 'negative' %}
                                        <span style="color: #e74c3c;">æ¶ˆæ</span>
                                    {% elif ev.polarity == 'neutral' %}
                                        <span style="color: #7f8c8d;">ä¸­æ€§</span>
                                    {% endif %}
                                </div>
                                {% endif %}

                                {% if ev.get('context_modality') %}
                                <div><span class="field-label">è¯­å¢ƒæ¨¡æ€ï¼š</span>
                                    <span style="font-family: monospace;">{{ ev.context_modality }}</span>
                                    <small style="color: #7f8c8d;">
                                        {% if ev.context_modality == 'epistemic' %}ï¼ˆè®¤çŸ¥å¯èƒ½ï¼‰
                                        {% elif ev.context_modality == 'deontic' %}ï¼ˆä¹‰åŠ¡/è®¸å¯ï¼‰
                                        {% elif ev.context_modality == 'bouletic' %}ï¼ˆæ„¿æœ›/åå¥½ï¼‰
                                        {% elif ev.context_modality == 'alethic' %}ï¼ˆé€»è¾‘å¿…ç„¶ï¼‰
                                        {% else %}ï¼ˆ{{ ev.context_modality }}ï¼‰
                                        {% endif %}
                                    </small>
                                </div>
                                {% endif %}

                                {% if ev.get('scope') %}
                                <div><span class="field-label">é€‚ç”¨èŒƒå›´ï¼š</span>{{ ev.scope }}</div>
                                {% endif %}
                            </div>

                            <!-- äº‹ä»¶çº§è¯æ® -->
                            {% if ev.get('evidence') %}
                            <details class="details-block" style="margin-top: 12px;">
                                <summary>ğŸ“„ æŸ¥çœ‹æœ¬æ¨æ¼”åŸå§‹ä¾æ®</summary>
                                <div style="margin-top: 6px; padding: 6px; background: #f5f6fa; border-radius: 4px; font-size: 0.95em;">
                                    <p><span class="field-label">åŸå§‹æ–‡æœ¬è¯æ®ï¼š</span>
                                        {% for frag in ev.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 15. æ˜¾æ€§åŠ¨æœº -->
        {% if data.get('explicit_motivation') %}
        <div class="section">
            <h3>15. æ˜¾æ€§åŠ¨æœº</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ -->
                {% if data.explicit_motivation.get('summary') %}
                <p><span class="field-label">æ˜¾æ€§åŠ¨å› æ‘˜è¦ï¼š</span>{{ data.explicit_motivation.summary }}</p>
                {% endif %}

                <!-- æŠ˜å è¯¦æƒ… -->
                <details class="details-block">
                    <summary>ğŸ” å±•å¼€æ·±åº¦åŠ¨å› è§£æï¼ˆå«å…¨å±€è¯æ®ã€è¯­ä¹‰æ ‡è¯†ä¸äº‹ä»¶çº§æº¯æºï¼‰</summary>
                    <div class="details-content">

                        <!-- å…¨å±€å­—æ®µ -->
                        {% if data.explicit_motivation.get('evidence') %}
                        <p>
                            <span class="field-label">å…¨å±€åŸæ–‡è¯æ®ï¼š</span>
                            {% for frag in data.explicit_motivation.evidence %}
                            <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        <!-- åŠ¨æœºäº‹ä»¶åˆ—è¡¨ -->
                        {% if data.explicit_motivation.get('events') and data.explicit_motivation.events %}
                        <h4 style="margin-top: 16px; margin-bottom: 10px;">æ˜¾æ€§åŠ¨æœºäº‹ä»¶ï¼ˆå…± {{ data.explicit_motivation.events | length }} é¡¹ï¼‰</h4>
                        {% for ev in data.explicit_motivation.events %}
                        <div class="relation-item" style="padding: 12px; background: #fff9f0; border-radius: 6px; margin-bottom: 14px; border-left: 4px solid #e67e22;">

                            <!-- æ ¸å¿ƒå…ƒä¿¡æ¯ï¼ˆå‰ç½®ï¼‰ -->
                            {% if ev.get('motivation_category') %}
                            <p><span class="field-label">åŠ¨æœºç±»å‹ï¼š</span>
                                <span style="font-family: monospace; background: #fdf6e3; padding: 2px 6px; border-radius: 3px;">
                                    {{ ev.motivation_category }}
                                </span>
                            </p>
                            {% endif %}
                            {% if ev.get('semantic_notation') %}
                            <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ ev.semantic_notation }}</code></p>
                            {% endif %}
                            {% if ev.get('experiencer') %}
                            <p><span class="field-label">é™ˆè¿°ä¸»ä½“ï¼š</span>{{ ev.experiencer }}</p>
                            {% endif %}

                            <!-- åŸæ–‡è¯æ®ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                            {% if ev.get('evidence') %}
                            <p><span class="field-label">åŸå§‹é™ˆè¿°ï¼š</span>
                                {% for frag in ev.evidence %}
                                <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                {% endfor %}
                            </p>
                            {% endif %}

                            <!-- æƒ…æ„ŸåŠ¨æœºï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('core_driver') or ev.get('care_expression') or ev.get('separation_anxiety') or ev.get('protective_intent') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>â¤ï¸ æƒ…æ„Ÿä¸å…³æ€€é©±åŠ¨</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #fdf6e3; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('core_driver') %}<p><span class="field-label">æ ¹æœ¬é©±åŠ¨åŠ›ï¼š</span>{{ ev.core_driver | join('; ') }}</p>{% endif %}
                                    {% if ev.get('care_expression') %}<p><span class="field-label">å…³æ€€è¡¨è¾¾ï¼š</span>{{ ev.care_expression | join('; ') }}</p>{% endif %}
                                    {% if ev.get('separation_anxiety') %}<p><span class="field-label">åˆ†ç¦»ç„¦è™‘ï¼š</span>{{ ev.separation_anxiety | join('; ') }}</p>{% endif %}
                                    {% if ev.get('protective_intent') %}<p><span class="field-label">ä¿æŠ¤æ„å›¾ï¼š</span>{{ ev.protective_intent | join('; ') }}</p>{% endif %}
                                </div>
                            </details>
                            {% endif %}

                            <!-- ç¤¾ä¼šæ§åˆ¶ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('resource_control') or ev.get('survival_imperative') or ev.get('social_enforcement_mechanism') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>âš–ï¸ ç¤¾ä¼šæ§åˆ¶ä¸æœä»å‹åŠ›</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #f0f9ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.get('resource_control') %}<p><span class="field-label">èµ„æºæ§åˆ¶ï¼š</span>{{ ev.resource_control | join('; ') }}</p>{% endif %}
                                    {% if ev.get('survival_imperative') %}<p><span class="field-label">ç”Ÿå­˜æ€§æœä»ï¼š</span>{{ ev.survival_imperative | join('; ') }}</p>{% endif %}
                                    {% if ev.get('social_enforcement_mechanism') %}<p><span class="field-label">ç¤¾ä¼šè§„èŒƒå‹åŠ›ï¼š</span>{{ ev.social_enforcement_mechanism | join('; ') }}</p>{% endif %}
                                </div>
                            </details>
                            {% endif %}

                            <!-- å†…åŒ–å‹è¿«ï¼ˆæ˜¾çœ¼è­¦ç¤ºï¼‰ -->
                            {% if ev.get('internalized_oppression') %}
                            <div style="margin-top: 10px; padding: 8px; background: #ffecec; border-left: 3px solid #e74c3c; border-radius: 4px;">
                                <strong>ğŸ©¹ å†…åŒ–å‹è¿«ï¼ˆç”¨æˆ·è‡ªæˆ‘è´¬ä½/æ­£å½“åŒ–ä¼¤å®³ï¼‰ï¼š</strong>
                                <p>{{ ev.internalized_oppression | join('; ') }}</p>
                            </div>
                            {% endif %}

                            <!-- æƒåŠ›ç»“æ„ï¼ˆä»…å½“æ˜¾æ€§æè¿°ï¼‰ -->
                            {% if ev.get('power_asymmetry') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ” ç”¨æˆ·è‡ªè¿°çš„æƒåŠ›ä¸å¯¹ç§°</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #f8f0ff; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.power_asymmetry.get('control_axis') %}
                                    <p><span class="field-label">æ§åˆ¶æ–¹å¼ï¼š</span>{{ ev.power_asymmetry.control_axis | join(', ') }}</p>
                                    {% endif %}
                                    {% if ev.power_asymmetry.get('threat_vector') %}
                                    <p><span class="field-label">å¨èƒæ‰‹æ®µï¼š</span>{{ ev.power_asymmetry.threat_vector | join(', ') }}</p>
                                    {% endif %}
                                    {% if ev.power_asymmetry.get('evidence') %}
                                    <p><span class="field-label">åŸæ–‡è¯æ®ï¼š</span>
                                        {% for frag in ev.power_asymmetry.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                            <!-- è¯æœ¯ç­–ç•¥ï¼ˆæŠ˜å ï¼‰ -->
                            {% if ev.get('narrative_distortion') %}
                            <details class="details-block" style="margin-top: 10px;">
                                <summary>ğŸ­ ç”¨æˆ·è‡ªè¿°çš„è¯æœ¯ç­–ç•¥</summary>
                                <div style="margin-top: 6px; padding: 8px; background: #f0fff0; border-radius: 4px; font-size: 0.95em;">
                                    {% if ev.narrative_distortion.get('self_justification') %}
                                    <p><span class="field-label">è‡ªæˆ‘åˆç†åŒ–ï¼š</span>â€œ{{ ev.narrative_distortion.self_justification }}â€</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('blame_shift') %}
                                    <p><span class="field-label">è´£ä»»è½¬å«ï¼š</span>â€œ{{ ev.narrative_distortion.blame_shift }}â€</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('moral_licensing') %}
                                    <p><span class="field-label">é“å¾·è±å…ï¼š</span>â€œ{{ ev.narrative_distortion.moral_licensing }}â€</p>
                                    {% endif %}
                                    {% if ev.narrative_distortion.get('evidence') %}
                                    <p><span class="field-label">è¯æœ¯è¯æ®ï¼š</span>
                                        {% for frag in ev.narrative_distortion.evidence %}
                                        <code>"{{ frag }}"</code>{% if not loop.last %}ï¼›{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                </div>
                            </details>
                            {% endif %}

                        </div>
                        {% endfor %}
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        <!-- 16. åˆç†å»ºè®® -->
        {% if data.get('rational_advice') %}
        <div class="section">
            <h3>16. åˆç†å»ºè®®</h3>
            <div class="subsection">
                <!-- ä¸»æ‘˜è¦ -->
                {% if data.rational_advice.get('summary') %}
                <p><span class="field-label">å»ºè®®æ¦‚è¿°ï¼š</span>{{ data.rational_advice.summary }}</p>
                {% endif %}
                {% if data.rational_advice.get('semantic_notation') %}
                <p><span class="field-label">è¯­ä¹‰æ ‡è¯†ï¼š</span><code>{{ data.rational_advice.semantic_notation }}</code></p>
                {% endif %}

                <details class="details-block">
                    <summary>ğŸ” å±•å¼€å®Œæ•´å»ºè®®æ–¹æ¡ˆï¼ˆå«ä¾æ®ã€ä»£ä»·è¯„ä¼°ä¸æ–‡åŒ–é€‚é…ï¼‰</summary>
                    <div class="details-content">

                        <!-- ä¾æ®ï¼šè¯­ä¹‰æ ‡è¯† -->
                        {% if data.rational_advice.get('evidence') %}
                        <p><span class="field-label">å»ºè®®ä¾æ®ï¼ˆåŠ¨æœºè¯­ä¹‰æ ‡è¯†ï¼‰ï¼š</span>
                            <code>{{ data.rational_advice.evidence | join(', ') }}</code>
                        </p>
                        {% endif %}

                        <!-- å®‰å…¨ä¼˜å…ˆå¹²é¢„ -->
                        {% if data.rational_advice.get('safety_first_intervention') %}
                        <h4 style="color: #c0392b; margin-top: 16px;">âš ï¸ å®‰å…¨ä¼˜å…ˆå¹²é¢„ï¼ˆç«‹å³æ‰§è¡Œï¼‰</h4>
                        <ul class="advice-list" style="background: #fff5f5; padding: 10px; border-left: 3px solid #e74c3c;">
                            {% for item in data.rational_advice.safety_first_intervention %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- ç³»ç»Ÿæ æ†ç‚¹ -->
                        {% if data.rational_advice.get('systemic_leverage_point') %}
                        <h4 style="margin-top: 16px;">ğŸ¯ ç³»ç»Ÿæ æ†ç‚¹ï¼ˆå…³é”®çªç ´å£ï¼‰</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.systemic_leverage_point %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- åˆ†é˜¶æ®µç­–ç•¥ -->
                        {% if data.rational_advice.get('incremental_strategy') %}
                        <h4 style="margin-top: 16px;">ğŸ“ˆ åˆ†é˜¶æ®µç­–ç•¥ï¼ˆä½é£é™©æ¸è¿›ï¼‰</h4>
                        <div class="advice-list" style="margin-bottom: 16px;">
                            {% for step in data.rational_advice.incremental_strategy %}
                            <div style="border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin-bottom: 12px; background: #fafafa;">
                                <p><strong>ğŸ”¹ è¡ŒåŠ¨ï¼š</strong>{{ step.action }}</p>
                                {% if step.timing_or_condition %}
                                <p><strong>ğŸ•’ æ—¶æœº/æ¡ä»¶ï¼š</strong>{{ step.timing_or_condition }}</p>
                                {% endif %}
                                {% if step.required_resource %}
                                <p><strong>ğŸ“¦ æ‰€éœ€èµ„æºï¼š</strong>{{ step.required_resource }}</p>
                                {% endif %}
                                {% if step.potential_risk %}
                                <p><strong>âš ï¸ æ½œåœ¨é£é™©ï¼š</strong>{{ step.potential_risk }}</p>
                                {% endif %}
                                {% if step.contingency_response %}
                                <p><strong>ğŸ›¡ï¸ åº”å¯¹æªæ–½ï¼š</strong>{{ step.contingency_response }}</p>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- å›é€€è®¡åˆ’ï¼ˆç»“æ„åŒ–ï¼‰ -->
                        {% if data.rational_advice.get('fallback_plan') %}
                        <h4 style="margin-top: 16px; color: #8e44ad;">ğŸ›¡ï¸ å›é€€è®¡åˆ’ï¼ˆé«˜é£é™©è§¦å‘æ—¶çš„æœ€å°å®‰å…¨æªæ–½ï¼‰</h4>
                        <div class="advice-list" style="background: #f9f0ff; padding: 10px; border-left: 3px solid #9b59b6;">
                            {% for fp in data.rational_advice.fallback_plan %}
                            <div style="margin-bottom: 10px; padding: 8px; background: white; border-radius: 4px;">
                                <p><strong>ğŸš¨ è§¦å‘æ¡ä»¶ï¼š</strong>{{ fp.trigger_condition }}</p>
                                <p><strong>ğŸ”„ å›é€€è¡ŒåŠ¨ï¼š</strong>{{ fp.fallback_action }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- é•¿æœŸè„±ç¦»è·¯å¾„ -->
                        {% if data.rational_advice.get('long_term_exit_path') %}
                        <h4 style="margin-top: 16px;">ğŸšª é•¿æœŸè„±ç¦»è·¯å¾„ï¼ˆå¯æŒç»­é€€å‡ºï¼‰</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.long_term_exit_path %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- ç°æœ‰æ”¯æŒå†è¯ é‡Š -->
                        {% if data.rational_advice.get('available_social_support_reinterpretation') %}
                        <h4 style="margin-top: 16px;">ğŸ¤ ç°æœ‰æ”¯æŒçš„é‡æ–°æ¿€æ´»</h4>
                        <ul class="advice-list">
                            {% for item in data.rational_advice.available_social_support_reinterpretation %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}

                        <!-- åˆ©ç›Šç›¸å…³æ–¹ä»£ä»·è¯„ä¼° -->
                        {% if data.rational_advice.get('stakeholder_tradeoffs') %}
                        <details class="details-block" style="margin-top: 16px;">
                            <summary>âš–ï¸ åˆ©ç›Šç›¸å…³æ–¹ä»£ä»·è¯„ä¼°</summary>
                            <div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 0.95em;">
                                {% if data.rational_advice.stakeholder_tradeoffs.get('victim_cost') %}
                                <p><span class="field-label">ä½ä½è€…é£é™©ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.victim_cost | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('oppressor_loss') %}
                                <p><span class="field-label">é«˜ä½è€…æŸå¤±ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.oppressor_loss | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('system_stability') %}
                                <p><span class="field-label">ç³»ç»Ÿç¨³å®šæ€§å½±å“ï¼š</span>{{ data.rational_advice.stakeholder_tradeoffs.system_stability | join('; ') }}</p>
                                {% endif %}
                                {% if data.rational_advice.stakeholder_tradeoffs.get('evidence') %}
                                <p><span class="field-label">è¯„ä¼°ä¾æ®ï¼ˆè¯­ä¹‰æ ‡è¯†ï¼‰ï¼š</span>
                                    {% for frag in data.rational_advice.stakeholder_tradeoffs.evidence %}
                                    <code>{{ frag }}</code>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                {% endif %}
                            </div>
                        </details>
                        {% endif %}

                    </div>
                </details>
            </div>
        </div>
        {% endif %}

        {% if data.analysis and data.analysis.suggestion %}
            <section class="suggestion-section">
                <h3>17. ç”¨æˆ·è¾“å…¥å†…å®¹è§£è¯»</h3>
                {% if data.analysis.suggestion.success %}
                    <div class="suggestion-content">{{ data.analysis.suggestion.content }}</div>
                {% else %}
                    <div class="suggestion-error">
                      <em>{{ data.analysis.suggestion.content }}</em>
                    </div>
                {% endif %}
            </section>
        {% endif %}

        <!-- è‹¥æ— ä»»ä½•æ•°æ® -->
        {% if not data or (data|length == 0) %}
        <p class="empty-section">æš‚æ— åˆ†ææ•°æ®ã€‚</p>
        {% endif %}
    </div>

    <!-- åˆ†äº«é€‰é¡¹ -->
    <div class="share-options">
        <h3>åˆ†äº«è¿™ä»½æŠ¥å‘Šï¼š</h3>
        <button id="btn-export-md" class="share-btn" onclick="saveAsMarkdown()">
            ğŸ’¾ å¯¼å‡ºä¸º Markdown
        </button>
        <button id="btn-generate-pdf" class="share-btn" onclick="generatePDF()">
            ğŸ–¨ï¸ ç”ŸæˆPDFæŠ¥å‘Š
        </button>
        <button id="btn-copy-text" class="share-btn" onclick="copyReportText()">
            ğŸ“‹ å¤åˆ¶æŠ¥å‘Šæ–‡æœ¬
        </button>
    </div>

    <!-- å›¾æ ‡ -->
    <div id="scroll-controls" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 1000;
    ">
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
                title="å›åˆ°é¡¶éƒ¨"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–²
        </button>
        <button onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})"
                title="æ»šåŠ¨åˆ°åº•"
                style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: #666; transition: transform 0.3s ease, color 0.3s ease;"
                onmouseover="this.style.transform='scale(1.2)'; this.style.color='#000';"
                onmouseout="this.style.transform='scale(1)'; this.style.color='#666';">
            â–¼
        </button>
    </div>

    <script>
        var TurndownService = (function () {
          'use strict';

          function extend (destination) {
            for (var i = 1; i < arguments.length; i++) {
              var source = arguments[i];
              for (var key in source) {
                if (source.hasOwnProperty(key)) destination[key] = source[key];
              }
            }
            return destination
          }

          function repeat (character, count) {
            return Array(count + 1).join(character)
          }

          function trimLeadingNewlines (string) {
            return string.replace(/^\n*/, '')
          }

          function trimTrailingNewlines (string) {
            // avoid match-at-end regexp bottleneck, see #370
            var indexEnd = string.length;
            while (indexEnd > 0 && string[indexEnd - 1] === '\n') indexEnd--;
            return string.substring(0, indexEnd)
          }

          var blockElements = [
            'ADDRESS', 'ARTICLE', 'ASIDE', 'AUDIO', 'BLOCKQUOTE', 'BODY', 'CANVAS',
            'CENTER', 'DD', 'DIR', 'DIV', 'DL', 'DT', 'FIELDSET', 'FIGCAPTION', 'FIGURE',
            'FOOTER', 'FORM', 'FRAMESET', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'HEADER',
            'HGROUP', 'HR', 'HTML', 'ISINDEX', 'LI', 'MAIN', 'MENU', 'NAV', 'NOFRAMES',
            'NOSCRIPT', 'OL', 'OUTPUT', 'P', 'PRE', 'SECTION', 'TABLE', 'TBODY', 'TD',
            'TFOOT', 'TH', 'THEAD', 'TR', 'UL'
          ];

          function isBlock (node) {
            return is(node, blockElements)
          }

          var voidElements = [
            'AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT',
            'KEYGEN', 'LINK', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR'
          ];

          function isVoid (node) {
            return is(node, voidElements)
          }

          function hasVoid (node) {
            return has(node, voidElements)
          }

          var meaningfulWhenBlankElements = [
            'A', 'TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TH', 'TD', 'IFRAME', 'SCRIPT',
            'AUDIO', 'VIDEO'
          ];

          function isMeaningfulWhenBlank (node) {
            return is(node, meaningfulWhenBlankElements)
          }

          function hasMeaningfulWhenBlank (node) {
            return has(node, meaningfulWhenBlankElements)
          }

          function is (node, tagNames) {
            return tagNames.indexOf(node.nodeName) >= 0
          }

          function has (node, tagNames) {
            return (
              node.getElementsByTagName &&
              tagNames.some(function (tagName) {
                return node.getElementsByTagName(tagName).length
              })
            )
          }

          var rules = {};

          rules.paragraph = {
            filter: 'p',

            replacement: function (content) {
              return '\n\n' + content + '\n\n'
            }
          };

          rules.lineBreak = {
            filter: 'br',

            replacement: function (content, node, options) {
              return options.br + '\n'
            }
          };

          rules.heading = {
            filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],

            replacement: function (content, node, options) {
              var hLevel = Number(node.nodeName.charAt(1));

              if (options.headingStyle === 'setext' && hLevel < 3) {
                var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);
                return (
                  '\n\n' + content + '\n' + underline + '\n\n'
                )
              } else {
                return '\n\n' + repeat('#', hLevel) + ' ' + content + '\n\n'
              }
            }
          };

          rules.blockquote = {
            filter: 'blockquote',

            replacement: function (content) {
              content = content.replace(/^\n+|\n+$/g, '');
              content = content.replace(/^/gm, '> ');
              return '\n\n' + content + '\n\n'
            }
          };

          rules.list = {
            filter: ['ul', 'ol'],

            replacement: function (content, node) {
              var parent = node.parentNode;
              if (parent.nodeName === 'LI' && parent.lastElementChild === node) {
                return '\n' + content
              } else {
                return '\n\n' + content + '\n\n'
              }
            }
          };

          rules.listItem = {
            filter: 'li',

            replacement: function (content, node, options) {
              content = content
                .replace(/^\n+/, '') // remove leading newlines
                .replace(/\n+$/, '\n') // replace trailing newlines with just a single one
                .replace(/\n/gm, '\n    '); // indent
              var prefix = options.bulletListMarker + '   ';
              var parent = node.parentNode;
              if (parent.nodeName === 'OL') {
                var start = parent.getAttribute('start');
                var index = Array.prototype.indexOf.call(parent.children, node);
                prefix = (start ? Number(start) + index : index + 1) + '.  ';
              }
              return (
                prefix + content + (node.nextSibling && !/\n$/.test(content) ? '\n' : '')
              )
            }
          };

          rules.indentedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'indented' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              return (
                '\n\n    ' +
                node.firstChild.textContent.replace(/\n/g, '\n    ') +
                '\n\n'
              )
            }
          };

          rules.fencedCodeBlock = {
            filter: function (node, options) {
              return (
                options.codeBlockStyle === 'fenced' &&
                node.nodeName === 'PRE' &&
                node.firstChild &&
                node.firstChild.nodeName === 'CODE'
              )
            },

            replacement: function (content, node, options) {
              var className = node.firstChild.getAttribute('class') || '';
              var language = (className.match(/language-(\S+)/) || [null, ''])[1];
              var code = node.firstChild.textContent;

              var fenceChar = options.fence.charAt(0);
              var fenceSize = 3;
              var fenceInCodeRegex = new RegExp('^' + fenceChar + '{3,}', 'gm');

              var match;
              while ((match = fenceInCodeRegex.exec(code))) {
                if (match[0].length >= fenceSize) {
                  fenceSize = match[0].length + 1;
                }
              }

              var fence = repeat(fenceChar, fenceSize);

              return (
                '\n\n' + fence + language + '\n' +
                code.replace(/\n$/, '') +
                '\n' + fence + '\n\n'
              )
            }
          };

          rules.horizontalRule = {
            filter: 'hr',

            replacement: function (content, node, options) {
              return '\n\n' + options.hr + '\n\n'
            }
          };

          rules.inlineLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'inlined' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              return '[' + content + '](' + href + title + ')'
            }
          };

          rules.referenceLink = {
            filter: function (node, options) {
              return (
                options.linkStyle === 'referenced' &&
                node.nodeName === 'A' &&
                node.getAttribute('href')
              )
            },

            replacement: function (content, node, options) {
              var href = node.getAttribute('href');
              var title = cleanAttribute(node.getAttribute('title'));
              if (title) title = ' "' + title + '"';
              var replacement;
              var reference;

              switch (options.linkReferenceStyle) {
                case 'collapsed':
                  replacement = '[' + content + '][]';
                  reference = '[' + content + ']: ' + href + title;
                  break
                case 'shortcut':
                  replacement = '[' + content + ']';
                  reference = '[' + content + ']: ' + href + title;
                  break
                default:
                  var id = this.references.length + 1;
                  replacement = '[' + content + '][' + id + ']';
                  reference = '[' + id + ']: ' + href + title;
              }

              this.references.push(reference);
              return replacement
            },

            references: [],

            append: function (options) {
              var references = '';
              if (this.references.length) {
                references = '\n\n' + this.references.join('\n') + '\n\n';
                this.references = []; // Reset references
              }
              return references
            }
          };

          rules.emphasis = {
            filter: ['em', 'i'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.emDelimiter + content + options.emDelimiter
            }
          };

          rules.strong = {
            filter: ['strong', 'b'],

            replacement: function (content, node, options) {
              if (!content.trim()) return ''
              return options.strongDelimiter + content + options.strongDelimiter
            }
          };

          rules.code = {
            filter: function (node) {
              var hasSiblings = node.previousSibling || node.nextSibling;
              var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;

              return node.nodeName === 'CODE' && !isCodeBlock
            },

            replacement: function (content) {
              if (!content) return ''
              content = content.replace(/\r?\n|\r/g, ' ');

              var extraSpace = /^`|^ .*?[^ ].* $|`$/.test(content) ? ' ' : '';
              var delimiter = '`';
              var matches = content.match(/`+/gm) || [];
              while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';

              return delimiter + extraSpace + content + extraSpace + delimiter
            }
          };

          rules.image = {
            filter: 'img',

            replacement: function (content, node) {
              var alt = cleanAttribute(node.getAttribute('alt'));
              var src = node.getAttribute('src') || '';
              var title = cleanAttribute(node.getAttribute('title'));
              var titlePart = title ? ' "' + title + '"' : '';
              return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''
            }
          };

          function cleanAttribute (attribute) {
            return attribute ? attribute.replace(/(\n+\s*)+/g, '\n') : ''
          }

          /**
           * Manages a collection of rules used to convert HTML to Markdown
           */

          function Rules (options) {
            this.options = options;
            this._keep = [];
            this._remove = [];

            this.blankRule = {
              replacement: options.blankReplacement
            };

            this.keepReplacement = options.keepReplacement;

            this.defaultRule = {
              replacement: options.defaultReplacement
            };

            this.array = [];
            for (var key in options.rules) this.array.push(options.rules[key]);
          }

          Rules.prototype = {
            add: function (key, rule) {
              this.array.unshift(rule);
            },

            keep: function (filter) {
              this._keep.unshift({
                filter: filter,
                replacement: this.keepReplacement
              });
            },

            remove: function (filter) {
              this._remove.unshift({
                filter: filter,
                replacement: function () {
                  return ''
                }
              });
            },

            forNode: function (node) {
              if (node.isBlank) return this.blankRule
              var rule;

              if ((rule = findRule(this.array, node, this.options))) return rule
              if ((rule = findRule(this._keep, node, this.options))) return rule
              if ((rule = findRule(this._remove, node, this.options))) return rule

              return this.defaultRule
            },

            forEach: function (fn) {
              for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);
            }
          };

          function findRule (rules, node, options) {
            for (var i = 0; i < rules.length; i++) {
              var rule = rules[i];
              if (filterValue(rule, node, options)) return rule
            }
            return void 0
          }

          function filterValue (rule, node, options) {
            var filter = rule.filter;
            if (typeof filter === 'string') {
              if (filter === node.nodeName.toLowerCase()) return true
            } else if (Array.isArray(filter)) {
              if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true
            } else if (typeof filter === 'function') {
              if (filter.call(rule, node, options)) return true
            } else {
              throw new TypeError('`filter` needs to be a string, array, or function')
            }
          }

          /**
           * The collapseWhitespace function is adapted from collapse-whitespace
           * by Luc Thevenard.
           *
           * The MIT License (MIT)
           *
           * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>
           *
           * Permission is hereby granted, free of charge, to any person obtaining a copy
           * of this software and associated documentation files (the "Software"), to deal
           * in the Software without restriction, including without limitation the rights
           * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
           * copies of the Software, and to permit persons to whom the Software is
           * furnished to do so, subject to the following conditions:
           *
           * The above copyright notice and this permission notice shall be included in
           * all copies or substantial portions of the Software.
           *
           * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
           * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
           * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
           * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
           * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
           * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
           * THE SOFTWARE.
           */

          /**
           * collapseWhitespace(options) removes extraneous whitespace from an the given element.
           *
           * @param {Object} options
           */
          function collapseWhitespace (options) {
            var element = options.element;
            var isBlock = options.isBlock;
            var isVoid = options.isVoid;
            var isPre = options.isPre || function (node) {
              return node.nodeName === 'PRE'
            };

            if (!element.firstChild || isPre(element)) return

            var prevText = null;
            var keepLeadingWs = false;

            var prev = null;
            var node = next(prev, element, isPre);

            while (node !== element) {
              if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE
                var text = node.data.replace(/[ \r\n\t]+/g, ' ');

                if ((!prevText || / $/.test(prevText.data)) &&
                    !keepLeadingWs && text[0] === ' ') {
                  text = text.substr(1);
                }

                // `text` might be empty at this point.
                if (!text) {
                  node = remove(node);
                  continue
                }

                node.data = text;

                prevText = node;
              } else if (node.nodeType === 1) { // Node.ELEMENT_NODE
                if (isBlock(node) || node.nodeName === 'BR') {
                  if (prevText) {
                    prevText.data = prevText.data.replace(/ $/, '');
                  }

                  prevText = null;
                  keepLeadingWs = false;
                } else if (isVoid(node) || isPre(node)) {
                  // Avoid trimming space around non-block, non-BR void elements and inline PRE.
                  prevText = null;
                  keepLeadingWs = true;
                } else if (prevText) {
                  // Drop protection if set previously.
                  keepLeadingWs = false;
                }
              } else {
                node = remove(node);
                continue
              }

              var nextNode = next(prev, node, isPre);
              prev = node;
              node = nextNode;
            }

            if (prevText) {
              prevText.data = prevText.data.replace(/ $/, '');
              if (!prevText.data) {
                remove(prevText);
              }
            }
          }

          /**
           * remove(node) removes the given node from the DOM and returns the
           * next node in the sequence.
           *
           * @param {Node} node
           * @return {Node} node
           */
          function remove (node) {
            var next = node.nextSibling || node.parentNode;

            node.parentNode.removeChild(node);

            return next
          }

          /**
           * next(prev, current, isPre) returns the next node in the sequence, given the
           * current and previous nodes.
           *
           * @param {Node} prev
           * @param {Node} current
           * @param {Function} isPre
           * @return {Node}
           */
          function next (prev, current, isPre) {
            if ((prev && prev.parentNode === current) || isPre(current)) {
              return current.nextSibling || current.parentNode
            }

            return current.firstChild || current.nextSibling || current.parentNode
          }

          /*
           * Set up window for Node.js
           */

          var root = (typeof window !== 'undefined' ? window : {});

          /*
           * Parsing HTML strings
           */

          function canParseHTMLNatively () {
            var Parser = root.DOMParser;
            var canParse = false;

            // Adapted from https://gist.github.com/1129031
            // Firefox/Opera/IE throw errors on unsupported types
            try {
              // WebKit returns null on unsupported types
              if (new Parser().parseFromString('', 'text/html')) {
                canParse = true;
              }
            } catch (e) {}

            return canParse
          }

          function createHTMLParser () {
            var Parser = function () {};

            {
              if (shouldUseActiveX()) {
                Parser.prototype.parseFromString = function (string) {
                  var doc = new window.ActiveXObject('htmlfile');
                  doc.designMode = 'on'; // disable on-page scripts
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              } else {
                Parser.prototype.parseFromString = function (string) {
                  var doc = document.implementation.createHTMLDocument('');
                  doc.open();
                  doc.write(string);
                  doc.close();
                  return doc
                };
              }
            }
            return Parser
          }

          function shouldUseActiveX () {
            var useActiveX = false;
            try {
              document.implementation.createHTMLDocument('').open();
            } catch (e) {
              if (window.ActiveXObject) useActiveX = true;
            }
            return useActiveX
          }

          var HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();

          function RootNode (input, options) {
            var root;
            if (typeof input === 'string') {
              var doc = htmlParser().parseFromString(
                // DOM parsers arrange elements in the <head> and <body>.
                // Wrapping in a custom element ensures elements are reliably arranged in
                // a single element.
                '<x-turndown id="turndown-root">' + input + '</x-turndown>',
                'text/html'
              );
              root = doc.getElementById('turndown-root');
            } else {
              root = input.cloneNode(true);
            }
            collapseWhitespace({
              element: root,
              isBlock: isBlock,
              isVoid: isVoid,
              isPre: options.preformattedCode ? isPreOrCode : null
            });

            return root
          }

          var _htmlParser;
          function htmlParser () {
            _htmlParser = _htmlParser || new HTMLParser();
            return _htmlParser
          }

          function isPreOrCode (node) {
            return node.nodeName === 'PRE' || node.nodeName === 'CODE'
          }

          function Node (node, options) {
            node.isBlock = isBlock(node);
            node.isCode = node.nodeName === 'CODE' || node.parentNode.isCode;
            node.isBlank = isBlank(node);
            node.flankingWhitespace = flankingWhitespace(node, options);
            return node
          }

          function isBlank (node) {
            return (
              !isVoid(node) &&
              !isMeaningfulWhenBlank(node) &&
              /^\s*$/i.test(node.textContent) &&
              !hasVoid(node) &&
              !hasMeaningfulWhenBlank(node)
            )
          }

          function flankingWhitespace (node, options) {
            if (node.isBlock || (options.preformattedCode && node.isCode)) {
              return { leading: '', trailing: '' }
            }

            var edges = edgeWhitespace(node.textContent);

            // abandon leading ASCII WS if left-flanked by ASCII WS
            if (edges.leadingAscii && isFlankedByWhitespace('left', node, options)) {
              edges.leading = edges.leadingNonAscii;
            }

            // abandon trailing ASCII WS if right-flanked by ASCII WS
            if (edges.trailingAscii && isFlankedByWhitespace('right', node, options)) {
              edges.trailing = edges.trailingNonAscii;
            }

            return { leading: edges.leading, trailing: edges.trailing }
          }

          function edgeWhitespace (string) {
            var m = string.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);
            return {
              leading: m[1], // whole string for whitespace-only strings
              leadingAscii: m[2],
              leadingNonAscii: m[3],
              trailing: m[4], // empty for whitespace-only strings
              trailingNonAscii: m[5],
              trailingAscii: m[6]
            }
          }

          function isFlankedByWhitespace (side, node, options) {
            var sibling;
            var regExp;
            var isFlanked;

            if (side === 'left') {
              sibling = node.previousSibling;
              regExp = / $/;
            } else {
              sibling = node.nextSibling;
              regExp = /^ /;
            }

            if (sibling) {
              if (sibling.nodeType === 3) {
                isFlanked = regExp.test(sibling.nodeValue);
              } else if (options.preformattedCode && sibling.nodeName === 'CODE') {
                isFlanked = false;
              } else if (sibling.nodeType === 1 && !isBlock(sibling)) {
                isFlanked = regExp.test(sibling.textContent);
              }
            }
            return isFlanked
          }

          var reduce = Array.prototype.reduce;
          var escapes = [
            [/\\/g, '\\\\'],
            [/\*/g, '\\*'],
            [/^-/g, '\\-'],
            [/^\+ /g, '\\+ '],
            [/^(=+)/g, '\\$1'],
            [/^(#{1,6}) /g, '\\$1 '],
            [/`/g, '\\`'],
            [/^~~~/g, '\\~~~'],
            [/\[/g, '\\['],
            [/\]/g, '\\]'],
            [/^>/g, '\\>'],
            [/_/g, '\\_'],
            [/^(\d+)\. /g, '$1\\. ']
          ];

          function TurndownService (options) {
            if (!(this instanceof TurndownService)) return new TurndownService(options)

            var defaults = {
              rules: rules,
              headingStyle: 'setext',
              hr: '* * *',
              bulletListMarker: '*',
              codeBlockStyle: 'indented',
              fence: '```',
              emDelimiter: '_',
              strongDelimiter: '**',
              linkStyle: 'inlined',
              linkReferenceStyle: 'full',
              br: '  ',
              preformattedCode: false,
              blankReplacement: function (content, node) {
                return node.isBlock ? '\n\n' : ''
              },
              keepReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + node.outerHTML + '\n\n' : node.outerHTML
              },
              defaultReplacement: function (content, node) {
                return node.isBlock ? '\n\n' + content + '\n\n' : content
              }
            };
            this.options = extend({}, defaults, options);
            this.rules = new Rules(this.options);
          }

          TurndownService.prototype = {
            /**
             * The entry point for converting a string or DOM node to Markdown
             * @public
             * @param {String|HTMLElement} input The string or DOM node to convert
             * @returns A Markdown representation of the input
             * @type String
             */

            turndown: function (input) {
              if (!canConvert(input)) {
                throw new TypeError(
                  input + ' is not a string, or an element/document/fragment node.'
                )
              }

              if (input === '') return ''

              var output = process.call(this, new RootNode(input, this.options));
              return postProcess.call(this, output)
            },

            /**
             * Add one or more plugins
             * @public
             * @param {Function|Array} plugin The plugin or array of plugins to add
             * @returns The Turndown instance for chaining
             * @type Object
             */

            use: function (plugin) {
              if (Array.isArray(plugin)) {
                for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);
              } else if (typeof plugin === 'function') {
                plugin(this);
              } else {
                throw new TypeError('plugin must be a Function or an Array of Functions')
              }
              return this
            },

            /**
             * Adds a rule
             * @public
             * @param {String} key The unique key of the rule
             * @param {Object} rule The rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            addRule: function (key, rule) {
              this.rules.add(key, rule);
              return this
            },

            /**
             * Keep a node (as HTML) that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            keep: function (filter) {
              this.rules.keep(filter);
              return this
            },

            /**
             * Remove a node that matches the filter
             * @public
             * @param {String|Array|Function} filter The unique key of the rule
             * @returns The Turndown instance for chaining
             * @type Object
             */

            remove: function (filter) {
              this.rules.remove(filter);
              return this
            },

            /**
             * Escapes Markdown syntax
             * @public
             * @param {String} string The string to escape
             * @returns A string with Markdown syntax escaped
             * @type String
             */

            escape: function (string) {
              return escapes.reduce(function (accumulator, escape) {
                return accumulator.replace(escape[0], escape[1])
              }, string)
            }
          };

          /**
           * Reduces a DOM node down to its Markdown string equivalent
           * @private
           * @param {HTMLElement} parentNode The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function process (parentNode) {
            var self = this;
            return reduce.call(parentNode.childNodes, function (output, node) {
              node = new Node(node, self.options);

              var replacement = '';
              if (node.nodeType === 3) {
                replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);
              } else if (node.nodeType === 1) {
                replacement = replacementForNode.call(self, node);
              }

              return join(output, replacement)
            }, '')
          }

          /**
           * Appends strings as each rule requires and trims the output
           * @private
           * @param {String} output The conversion output
           * @returns A trimmed version of the ouput
           * @type String
           */

          function postProcess (output) {
            var self = this;
            this.rules.forEach(function (rule) {
              if (typeof rule.append === 'function') {
                output = join(output, rule.append(self.options));
              }
            });

            return output.replace(/^[\t\r\n]+/, '').replace(/[\t\r\n\s]+$/, '')
          }

          /**
           * Converts an element node to its Markdown equivalent
           * @private
           * @param {HTMLElement} node The node to convert
           * @returns A Markdown representation of the node
           * @type String
           */

          function replacementForNode (node) {
            var rule = this.rules.forNode(node);
            var content = process.call(this, node);
            var whitespace = node.flankingWhitespace;
            if (whitespace.leading || whitespace.trailing) content = content.trim();
            return (
              whitespace.leading +
              rule.replacement(content, node, this.options) +
              whitespace.trailing
            )
          }

          /**
           * Joins replacement to the current output with appropriate number of new lines
           * @private
           * @param {String} output The current conversion output
           * @param {String} replacement The string to append to the output
           * @returns Joined output
           * @type String
           */

          function join (output, replacement) {
            var s1 = trimTrailingNewlines(output);
            var s2 = trimLeadingNewlines(replacement);
            var nls = Math.max(output.length - s1.length, replacement.length - s2.length);
            var separator = '\n\n'.substring(0, nls);

            return s1 + separator + s2
          }

          /**
           * Determines whether an input can be converted
           * @private
           * @param {String|HTMLElement} input Describe this parameter
           * @returns Describe what it returns
           * @type String|Object|Array|Boolean|Number
           */

          function canConvert (input) {
            return (
              input != null && (
                typeof input === 'string' ||
                (input.nodeType && (
                  input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11
                ))
              )
            )
          }

          return TurndownService;

        }());
    </script>

    <script>
        const REPORT_TITLE = {{ data.meta.title | default('æ–‡æœ¬å¤šæ¨¡æ€æ„ŸçŸ¥åˆ†ææŠ¥å‘Š') | tojson }}

        function saveAsMarkdown() {
            if (typeof TurndownService !== 'function') {
                alert('âŒ Markdown è½¬æ¢å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚');
                return;
            }

            const reportEl = document.querySelector('.report');
            if (!reportEl) {
                alert('âŒ æœªæ‰¾åˆ° .report å…ƒç´ ');
                return;
            }

            // å…‹éš†å¹¶æ¸…ç†
            const clone = reportEl.cloneNode(true);
            clone.querySelectorAll('script, style, .no-export').forEach(el => el.remove());

            // è½¬æ¢
            const turndownService = new TurndownService({
                headingStyle: 'atx',
                bulletListMarker: '-',
                codeBlockStyle: 'fenced'
            });
            let markdown = turndownService.turndown(clone.innerHTML);

            // æ¸…ç†å¤šä½™ç©ºè¡Œ
            markdown = markdown.replace(/\n{3,}/g, '\n\n').trim();

            // ç”Ÿæˆå®‰å…¨æ–‡ä»¶å
            const safeName = REPORT_TITLE
                .replace(/[<>:"/\\|?*\x00-\x1F]/g, '_')
                .replace(/\s+/g, '_')
                .substring(0, 60) || 'report';

            // ä¸‹è½½
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${safeName}.md`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copyReportText() {
            const el = document.querySelector('.report');
            if (!el) {
                alert('âŒ æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚');
                return;
            }
            const text = el.innerText;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('âœ… æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶ï¼ˆä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼‰ï¼');
            } catch (err) {
                alert('âŒ è¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æœ¬ã€‚');
            }
            document.body.removeChild(textarea);
        }

        function generatePDF() {
            window.print(); // è§¦å‘æ‰“å°ï¼Œç”¨æˆ·å¯é€‰æ‹©â€œå¦å­˜ä¸ºPDFâ€
        }
    </script>
</body>
</html>